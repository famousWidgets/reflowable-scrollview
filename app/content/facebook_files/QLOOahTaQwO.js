/*!CK:2995037056!*//*1399947066,178154293*/

if (self.CavalryLogger) { CavalryLogger.start_js(["aDnNl"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){e.exports={ACTION_EDUCATE:"educate",ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};});
__d("ChatSidebarSections",[],function(a,b,c,d,e,f){e.exports={MORE_ONLINE_FRIENDS:"more_online_friends",MORE_ONLINE_COWORKERS:"more_online_coworkers",OFFLINE_USERS:"offline_users",ORDERED_LIST:"ordered_list",ORDERED_COWORKERS:"ordered_coworkers",TYPEAHEAD:"typeahead"};});
__d("GenderConst",[],function(a,b,c,d,e,f){e.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};});
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};});
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};});
__d("MessagesViewerSetID",[],function(a,b,c,d,e,f){e.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};});
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads"};});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f,g,h,i){function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("SystemEvents",["Arbiter","CurrentUser","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){var l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.getID(),q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});e.exports=l;});
__d("ChannelSubdomain",["Event","JSLogger","Run","setTimeoutAcrossTransitions","LogHistory","WebStorage"],function(a,b,c,d,e,f,g,h,i,j){var k=b('LogHistory').getInstance('channel'),l=b('WebStorage').getLocalStorage(),m=h.create('channel'),n='channel_sub:',o=7,p=100*1000,q=null,r;function s(){if(r){clearTimeout(r);r=null;}if(l&&q!=null)l.removeItem(n+q);q=null;}function t(u,v,w){var x=(u-1)*o;if(w){if(r)clearTimeout(r);q=r=null;}if(v==null)v=Math.floor(Math.random()*x);if(q==null)if(l){var y=[];for(var z=0;z<l.length;z++){var aa=l.key(z);if(aa.indexOf(n)===0){var ba=parseInt(aa.substr(n.length),10);y[ba]=parseInt(l.getItem(aa),10);}}var ca=Date.now()-p;for(z=0;z<x;z++){var da=(z+v)%x;if(!y[da]||y[da]<ca){q=da;break;}}if(q!=null){var ea=function(){try{l.setItem(n+q,Date.now());}catch(fa){k.warn('subdomain set failed',fa.message);}r=j(ea,p/2);};ea();}else{k.warn('no channel subdomain',y);m.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',s);}else i.onUnload(s);}else q=v;return q==null?null:q%o;}e.exports={allocate:t,clear:s};});
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants","UserAgent","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.create('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new j(aa).setDomain(ba+z.host+'.facebook.com').setPort(z.port).setSecure(j().isSecure());return ca;}function s(z){var aa={partition:z.partition,cb:q()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=r(z,'/p').setQueryData(aa);p.log('start_p',{uri:ba.toString()});var ca=new i('GET',ba);if(i.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){p.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function t(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){p.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){s(z);ea(false);};var fa=o(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:q()};if(z.sticky_token)ga.sticky_token=z.sticky_token;da=Date.now();ca.src=r(z,'/ping').setQueryData(ga);return ca;}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)p.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:q(),idle:ea,cap:0};if(z.sticky_token)fa.sticky_token=z.sticky_token;if('trace_id' in z)fa.traceid=z.trace_id;if(z.userActive>0&&ea<60)fa.state='active';if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.webrtcSupport&&(n.chrome()>=24||n.firefox()>=22))fa.cap=m.CAPABILITY_VOIP;var ga=r(z,'/pull').setQueryData(fa),ha=new i('GET',ga);if(i.supportsCORS())ha.xhr.withCredentials=true;ha.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ha.onJSON=aa;ha.onSuccess=ba;ha.onError=function(){var ia=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ja=ia?ba:ca;return ja&&ja.apply(this,arguments);};ha.send();z.inStreaming=z.streamingCapable;return ha;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}g(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')o(h(this.manager,'exitState',{status:m.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=t(aa,h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(ba,'_processTransportData',aa.stateId),h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});function x(z){p.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(x.prototype,{logName:'iframe',_initIframe:function(z){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(z){this._iframeURI=r(z,z.path);if(z.bustIframe){var aa={partition:z.partition,cb:q()};this._iframeURI.setQueryData(aa);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ba){p.error('iframe_uri_set_error',ba);this.exitState({status:m.ERROR,stateId:z.stateId},ba+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:m.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}g(y.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var aa=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,aa);this.exitState({status:m.OK,stateId:1e+06});}catch(z){p.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=t(aa,h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(this,'_processTransportData',aa.stateId),h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});e.exports={getURI:r,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y};});
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","PresencePrivacyInitialData","JSLogger","PresenceUtil","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=n({},k.privacyData),v=k.visibility,w=n({},k.privacyData),x=v,y=k.onlinePolicy,z=y,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=n(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==j.getID()){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);n(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(m!=null){var sa=qa.getData();sa.window_id=m.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=j.getID()){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===m.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}n(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},allows:function(qa){if(this.getVisibility()===da.OFFLINE)return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed');ca().log('initialized',{visibility:v,policy:y});g.subscribe(i.getArbiterType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof(sa)!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}.bind(this));a.PresencePrivacy=e.exports=da;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f,g,h,i){var j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};a.ChatVisibility=e.exports=j;},3);
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;});
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","FBAjaxRequest","ISB","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","SystemEvents","URI","UserActivity","copyProperties","createArrayFrom","setIntervalAcrossTransitions","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){var ea,fa=s.create('channel'),ga=null;function ha(sa){ga=sa;}var ia={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ja={userActive:n.isOnline()?Date.now():0,sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},ka=1,la={},ma=0;function na(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function oa(){var sa={};if(ea.getConfig('host'))sa[ea.getConfig('user_channel')]=ea.getConfig('seq',0);return sa;}function pa(){var sa=Date.now(),ta=Date.now(),ua={total:0},va='idle',wa=false;x.subscribe([x.USER,x.ONLINE,x.TIME_TRAVEL],function(za,ab){ra(true);ta=null;ea.lastPullTime=Date.now();var bb;switch(za){case x.USER:bb=x.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case x.ONLINE:bb=ab?j.SYS_ONLINE:j.SYS_OFFLINE;break;case x.TIME_TRAVEL:bb=j.SYS_TIMETRAVEL;break;}ea.exitState({status:bb,stateId:ka});});var xa=function(za,ab){var bb=Date.now(),cb;if(ab){sa=bb;cb=ab.nextState||ab.state;}else cb=va;x.checkTimeTravel();if(ta){var db=Math.round((bb-ta)/1000);if(db>0){ua[va]=(ua[va]||0)+db;ua.total+=db;}}va=cb;ta=bb;if(!za){ua.lastSuccessTime=na();ua.online=x.isOnline();fa.log('rollup',ua);}};h.subscribe(j.ON_ENTER_STATE,xa);ca(xa,60000);h.subscribe(s.DUMP_EVENT,function(za,ab){ab.channelRollup=ua;});var ya=function(){if(ea.isShutdown()||ea.shouldIdle())return;x.checkTimeTravel();var za=Date.now()-(ea.lastPullTime||p.start);if(!wa&&za>ja.STALL_THRESHOLD){var ab=na();fa.error('stall',{lastSuccessTime:ab,rollupState:va});wa=true;}var bb=Date.now()-sa;if(ea.state=='pull'&&bb>ja.JUMPSTART_THRESHOLD){sa=null;fa.warn('jumpstart',{state:ea.state,dormant:bb});ea.enterState('init');}};ca(ya,10000);}function qa(){var sa=Date.now(),ta=1;function ua(){da(ua,ta*1000);var za=ea.state;if(za=='idle'&&ea.shouldIdle())return;fa.bump('conn_t',ta);if(za=='pull')fa.bump('conn_t_pull',ta);}ua();var va=[15,30,60,120,240],wa=false,xa=false;function ya(za){da(function(){fa.rate('pullenter_'+za,wa);fa.rate('pullexit_'+za,xa);},za*1000);}while(va.length)ya(va.shift());h.subscribe(j.ON_ENTER_STATE,function(za,ab){if(ab.state=='pull')wa=true;sa=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(za,ab){if(ab.state!='pull'||!sa)return;var bb='other';if(ab.status==j.OK){xa=true;bb='ok';}else if(ab.xhr&&ab.xhr.errorType){bb=/ar:(\w+)/.test(ab.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ab.status))return;var cb=(Date.now()-sa)/1000;if(cb<0){return;}else if(cb>3600)cb=3600;fa.bump('conn_num');fa.bump('conn_exit',cb);fa.bump('conn_num_'+bb);fa.bump('conn_exit_'+bb,cb);});}function ra(sa){if(sa){ma=0;la={};}else ma++;}ea={state:'idle',nextState:null,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:ha,init:function(sa){this.init=function(){};if(typeof(z)!='undefined'){z.subscribe(function(){if(n.isOnline())ja.userActive=Date.now();}.bind(this));}else fa.error('user_activity_undefined');u.register('ch',oa);var ta=this.getConfig('max_conn',2);ja.subdomain=l.allocate(ta);this._transportRate=new t(30000);var ua=(g.supportsCORS()&&!ja.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[ua](this);if(sa)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,wa){wa.transportRate=this._transportRate.tally();wa.transportType=ua;wa.transportVersion=2;}.bind(this));pa();qa();if(ea.getConfig('tryStreaming')&&ea.getConfig('host')&&g.supportsCORS()&&!ja.forceIframe){var va=ja.MIN_INIT_PROBE_DELAY+Math.random()*ja.INIT_PROBE_DELAY_RANDOMIZE_RANGE;da(this._probeTest,va);}},configure:function(){var sa=ba(arguments);fa.log('configure',sa);sa.forEach(aa.bind(null,ja));h.inform(j.ON_CONFIG,this);},getConfig:function(sa,ta){return sa in ja?ja[sa]:ta;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(x.isPageOwner()&&x.isOnline());},_sendIframeError:function(sa){var ta=new i().setURI('/ajax/presence/reconnect.php').setData({reason:sa,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ta.specifiesWriteRequiredParams()&&ta.send();},_getDelay:function(){var sa=Math.min(ja.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ma-1)),ja.MAX_RETRY_INTERVAL);return Math.floor(sa*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)fa.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(sa){this._inEnterState=false;throw sa;}},_enterState:function(sa){var ta=0,ua=ba(arguments);if(this.isShutdown())return;if(sa!='idle!'&&this.shouldIdle())return;ka++;ja.stateId=ka;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(sa)){var va=this._transportRate.tally().timeAverage,wa=ea.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(va>=wa){if(!this._throttled){this._throttled=true;fa.warn('throttled');}fa.bump('throttle');ta=1000/wa;}}else if(!(/#$/.test(sa)))ta=this._getDelay();sa=sa.replace(/\W*$/,'');if(!ia[sa])throw new Error('invalid state:'+sa);var xa;if(ta<=0){xa={state:sa};this._transportRate.add(1);this.state=sa;var ya=this['_enter_'+this.state];if(ya){ua.shift();ya.apply(this,ua);}if(/init|idle|pull|ping/.test(this.state)){if(ja.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ja);if(this.state=='ping'){xa.url=m.getURI(ja).toString();xa.port=ja.port||'undefined';}}}else{this.state='idle';this.nextState=sa;xa={state:this.state,delay:ta,nextState:sa};ua[0]=sa+'#';this._deferredTransition=da((function(){this._deferredTransition=null;this.enterState.apply(this,ua);}).bind(this),ta);}if(/pull/.test(sa)){xa.client_id=ja.sessionID;xa.streaming=ja.inStreaming;}fa.log('enter_'+this.state,xa);h.inform(j.ON_ENTER_STATE,xa);},exitState:function(sa,ta){var ua=sa.stateId,va=sa.status;if(this.isShutdown()||ua<ka)return;var wa=ba(arguments),xa=this.state;wa[0]=sa.status;var ya={state:xa,status:va};if(/pull/.test(xa)){ya.client_id=ja.sessionID;ya.streaming=ja.inStreaming;}if(/ping/.test(xa)&&va!=j.OK)ya.url=m.getURI(ja).toString();if(this.nextState)ya.nextState=this.nextState;if(ta&&ta.errorType){ya.xhr=ta.toJSON?ta.toJSON():ta;delete ya.xhr.json;}if(ta&&ta.json){if(ta.json.t)ya.t=ta.json.t;if(ta.json.reason)ya.reason=ta.json.reason;if(ta.json.seq)ya.seq=ta.json.seq;}fa.log('exit_'+xa,ya);h.inform(j.ON_EXIT_STATE,ya);var za=this['_exit_'+xa];if(za)va=za.apply(this,wa)||va;if(va!=j.OK){ra();la[xa]=(la[xa]||0)+1;}var ab=ia[this.nextState||xa][va]||ia._all[va],bb=ab&&ab.replace(/!*$/,'');if(!bb){fa.error('terminal_transition',ya);this._shutdownHint=j.HINT_INVALID_STATE;ab='shutdown!';}this._lastState=xa;this._lastStatus=va;this.enterState(ab);},_processTransportData:function(sa,ta){var ua=ta.json,va=ua.t;if('s' in ua){ua.seq=ua.s;delete ua.s;}if(ua.u&&ja.user&&ua.u!=ja.user){fa.warn('misguided_msg',{user:ja.user,target:ua.u});this._reportProxyMisguidedMsg(ua.u,ja.user);return;}var wa=ja.seq;if('seq' in ua){ja.seq=ua.seq;v.doSync();}switch(va){case 'continue':if(ja.inStreaming&&this.heartbeats.length<1){ja.streamingCapable=false;fa.log('switch_to_longpoll');da(this._probeTest,ja.PROBE_DELAY);}ra(true);if(!ja.inStreaming||ja.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:sa});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(ua.reason||0),stateId:sa},ta);break;case 'lb':var xa=ua.lb_info;if(xa){ja.host=xa.vip;ja.sticky_token=xa.sticky;}else fa.error('bad lb info');break;case 'test_streaming':da(this._probeTest,500);break;case 'fullReload':u.clear();fa.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:sa},ta);break;case 'msg':var ya,za,ab,bb;ra(true);if('tr' in ua)ja.trace_id=ua.tr;za=ua.ms;ab=ja.seq-za.length;for(ya=0;ya<za.length;ya++,ab++)if(ab>=wa){bb=za[ya];if(bb.type){if(bb.type==='messaging'){var cb={type:'messaging',event:bb.event};if(bb.message){cb.inbox_unread=bb.unread_counts&&bb.unread_counts.inbox;cb.tid=bb.message.tid;cb.mid=bb.message.mid;}fa.debug('message',cb);}else if(bb.type==='m_messaging'){fa.debug('message',{type:'m_messaging',tid:bb.tid,mid:bb.uuid});}else fa.debug('message',{type:bb.type});h.inform(j.getArbiterType(bb.type),{obj:bb});}}else fa.warn('seq_regression',{seq:ab,last_seq:wa,messages:za.length});break;case 'heartbeat':if(ja.inStreaming){var db=Date.now();if(this.heartbeats.length>0){var eb=db-this.heartbeats[this.heartbeats.length-1];fa.log('heartbeat_interval',{client_id:ja.sessionID,interval:eb});}this.heartbeats.push(db);}break;default:fa.error('unknown_msg_type',{type:va});break;}},_enter_init:function(){if(la.init>=ea.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ka}),0);this._initTimer=da(this.exitState.bind(this,{status:j.ERROR,stateId:ka},'timeout'),ja.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(sa){var ta=ka;if(!w.hasUserCookie()){fa.warn('no_user_cookie');setTimeout(function(){ea._shutdownHint=j.HINT_AUTH;ea.exitState({status:j.ERROR_SHUTDOWN,stateId:ta});},0);return;}var ua={reason:sa,fb_dtsg:o.getToken()};if(r.token)ua.fb_isb=r.token;if(ga)ga(ua);var va=new q('GET','/ajax/presence/reconnect.php',ua);va.onSuccess=(function(){ea.configure(va.json);u.store();this.exitState({status:j.OK,stateId:ta});}).bind(this);va.onError=(function(){var wa=va.json&&va.json.error;if(va.errorType==g.TRANSPORT_ERROR||va.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(wa&&wa==1356007){this._shutdownHint=j.HINT_MAINT;}else if(wa==1357001||wa==1357004||wa==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:ta},va);}).bind(this);va.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(sa){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(sa==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(sa){if(sa==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(sa){if(sa==j.OK){var ta=Date.now()-(this.lastPullTime||p.start);if(ta>ja.STALL_THRESHOLD)return j.ERROR_STALE;}},_reportProxyMisguidedMsg:function(sa,ta){var ua=Date.now();if(ua-this.lastReportOnMisguidedMsgTime<=ja.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=ua;var va={received_uid:sa,expected_uid:ta};if(ja.sticky_token)va.sticky_token=ja.sticky_token;var wa=new y('/err_misguided_msg').setDomain(ja.host+'.facebook.com').setPort(ja.port).setSecure(y().isSecure()).setQueryData(va),xa=new g('GET',wa);if(g.supportsCORS())xa.xhr.withCredentials=true;xa.onSuccess=function(ya){};xa.onError=function(ya){};xa.onJSON=function(ya,za){};xa.send();},_probeTest:function(){ja.streamingCapable=false;var sa=[],ta={mode:'stream',format:'json'};if(ja.sticky_token)ta.sticky_token=ja.sticky_token;var ua=new y('/probe').setDomain(ja.host+'.facebook.com').setPort(ja.port).setSecure(y().isSecure()).setQueryData(ta),va=new g('GET',ua);va.onJSON=function(wa,xa){if(wa&&wa.json&&wa.json.t==='heartbeat'){sa.push(Date.now());if(sa.length>=2){var ya=sa[1]-sa[0];if(ya>=ja.PROBE_HEARTBEATS_INTERVAL_LOW&&ya<=ja.PROBE_HEARTBEATS_INTERVAL_HIGH){ja.streamingCapable=true;fa.log('switch_to_streaming');}fa.log('probe_ok',{time:ya});}}};va.onSuccess=function(wa){if(sa.length!=2){ja.streamingCapable=false;fa.error('probe_error',{error:'beats.length = '+sa.length});}};va.onError=function(wa){ja.streamingCapable=false;fa.error('probe_error',wa);};fa.log('probe_request');va.send();}};e.exports=ea;if(k.channelConfig){ea.configure(k.channelConfig);if(/shutdown/.test(k.state))ea._shutdownHint=j[k.reason];ea.init(k.state,k.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n.create('channel_connection'),q=null,r=null,s=null,t=null,u=0,v=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function w(){if(r){clearTimeout(r);r=null;}}function x(){w();p.log('unmute_warning');v.inform(v.UNMUTE_WARNING);}function y(ca){w();r=o(x,ca);p.log('mute_warning',{time:ca});v.inform(v.MUTE_WARNING);}function z(){if(s){clearTimeout(s);s=null;}}function aa(ca,da){z();if(ca===l.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(t!==v.CONNECTED){p.log('connected');var ea=!t;t=v.CONNECTED;u=0;v.inform(v.CONNECTED,{init:ea});}}else if(ca===l.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||(!da.nextState&&da.state==='idle'))){s=o(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=(da.delay||0);p.log('reconnecting',{delay:fa});if(v.disconnected())p.log('reconnecting_ui',{delay:fa});t=v.RECONNECTING;(da.state==='idle')&&u++;if(u>1){v.inform(v.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')aa(ca,da);},500);}else if(ca===l.ON_SHUTDOWN){p.log('shutdown',{reason:da.reason});t=v.SHUTDOWN;u=0;v.inform(v.SHUTDOWN,da.reason);}}function ba(ca){if(m.state==='ping'||m.isShutdown())return;p.log('reconnect',{now:ca});v.inform(v.RECONNECTING,0);if(!!ca){if(q!==null){clearTimeout(q);q=null;}m.enterState('ping!');}else if(!q)q=o(function(){m.enterState('ping!');q=null;},i.get('channel_manual_reconnect_defer_msec'));}if(m.isShutdown()){aa(l.ON_SHUTDOWN,m._shutdownHint);}else aa(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],aa);k.subscribe(k.TIME_TRAVEL,function(){ba();y(i.get('mute_warning_time_msec'));});j.onBeforeUnload(z,false);h(v,{disconnected:function(){return t===v.SHUTDOWN||(t===v.RECONNECTING&&!r&&u>1);},isShutdown:function(){return t===v.SHUTDOWN;},reconnect:ba,unmuteWarning:x});e.exports=v;});
__d("AvailableListConstants",["fbt"],function(a,b,c,d,e,f,g){var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',ACTIVE_ON_WEB:"Web",ACTIVE_ON_MOBILE:"Mobile",LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline',legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};a.AvailableListConstants=e.exports=h;});
__d("LastMobileActiveTimes",["ServerTime","tx"],function(a,b,c,d,e,f,g,h){var i={};function j(n){if(!n||n<0)return '';var o=(g.get()/1000)-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",{count:1});}else if(p<60){return h._("{count}m",{count:p});}else if(q<24){return h._("{count}h",{count:q});}else if(r<3){return h._("{count}d",{count:r});}else return '';}function k(n,o){i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));}};e.exports=m;});
__d("Poller",["ArbiterMixin","AsyncRequest","Cookie","CurrentUser","copyProperties","emptyFunction","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(u){"use strict";this._config=k({clearOnQuicklingEvents:true,setupRequest:l,interval:null,maxRequests:Infinity,dontStart:false},u);if(!this._config.dontStart)this.start();}r.prototype.start=function(){"use strict";if(this._polling)return this;this._requests=0;this.request();return this;};r.prototype.stop=function(){"use strict";this._cancelRequest();return this;};r.prototype.mute=function(){"use strict";this._muted=true;return this;};r.prototype.resume=function(){"use strict";if(this._muted){this._muted=false;if(!this._handle&&this._polling)return this.request();}return this;};r.prototype.skip=function(){"use strict";this._skip=true;return this;};r.prototype.reset=function(){"use strict";return this.stop().start();};r.prototype.request=function(){"use strict";this._cancelRequest();this._polling=true;if(!t())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var u=new h(),v=false;u.setInitialHandler(function(){return !v;});this._cancelRequest=function(){v=true;this._cleanup();}.bind(this);u.setFinallyHandler(s.bind(this));u.setInitialHandler=l;u.setFinallyHandler=l;this._config.setupRequest(u,this);if(this._skip){this._skip=false;setTimeout(s.bind(this),0);}else u.send();return this;};r.prototype.isPolling=function(){"use strict";return this._polling;};r.prototype.isMuted=function(){"use strict";return this._muted;};r.prototype.setInterval=function(u){"use strict";if(u){this._config.interval=u;this.start();}};r.prototype.getInterval=function(){"use strict";return this._config.interval;};r.prototype._cleanup=function(){"use strict";if(this._handle)clearTimeout(this._handle);this._handle=null;this._cancelRequest=l;this._polling=false;};r.prototype._done=function(){"use strict";this._cleanup();this.inform('done',{sender:this});return this;};r.MIN_INTERVAL=2000;k(r.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:l});function s(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var u=this._config.interval;u=typeof u==='function'?u(this._requests):u;u=(u>r.MIN_INTERVAL)?u:r.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=setTimeout(this.request.bind(this),u);}else this._handle=n(this.request.bind(this),u);}else this._done();}function t(){return j.getID()==i.get('c_user');}e.exports=r;});
__d("PresenceStatus",["AvailableListConstants","ChatConfig","ChatVisibility","CurrentUser","LastMobileActiveTimes","PresencePrivacy","ServerTime","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={},p={},q={},r={},s={},t={},u={resetPresenceData:function(){o={};t={};s={};r={};},reset:function(){u.resetPresenceData();p={};q={};},get:function(v){if(v==j.getID())return i.isOnline()?g.ACTIVE:g.OFFLINE;var w=g.OFFLINE;if(v in o)w=o[v];if(w==g.OFFLINE)if(p[v])w=g.MOBILE;if(!l.allows(v))w=g.OFFLINE;return w;},getDetailedActivePresence:function(v){if(!h.get('sidebar_mobile_web_presence'))return null;var w=t[v];if(!w)return g.ACTIVE_ON_WEB;var x=w[g.WEB_STATUS],y=w[g.FB_APP_STATUS],z=w[g.MESSENGER_STATUS],aa=w[g.OTHER_STATUS];if(y===g.STATUS_ACTIVE||z===g.STATUS_ACTIVE){return g.ACTIVE_ON_MOBILE;}else if(x===g.STATUS_ACTIVE||aa===g.STATUS_ACTIVE){return g.ACTIVE_ON_WEB;}else return null;},isBirthday:function(v){return q[v];},getGroup:function(v){if(!h.get('chat_group_presence',0))return g.OFFLINE;return v.some(function(w){if(w==j.getID())return false;return (u.get(w)===g.ACTIVE);})?g.ACTIVE:g.OFFLINE;},set:function(v,w,x,y,z){if(v==j.getID())return false;switch(w){case g.OFFLINE:case g.IDLE:case g.ACTIVE:case g.MOBILE:break;default:return false;}var aa=u.get(v),ba=aa!=w;if(ba&&aa==g.ACTIVE){var ca={};ca[v]=m.get();k.update(ca);}if(x){r[v]=m.get();s[v]=y;}o[v]=w;if(z)t[v]=z;return ba;},setMobileFriends:function(v){p=n(v);},setBirthdayFriends:function(v){q=n(v);},getOnlineIDs:function(){var v,w=[];for(v in o)if(u.get(v)===g.ACTIVE)w.push(v);return w;},getAvailableIDs:function(){var v=u.getOnlineIDs(),w;for(w in p){if(o[w])continue;v.push(w);}return v;},getOnlineCount:function(){return u.getOnlineIDs().length;},getPresenceStats:function(){var v=0,w=0,x=0,y=0,z=0;for(var aa in o){v+=1;switch(u.get(aa)){case g.OFFLINE:w+=1;break;case g.IDLE:x+=1;break;case g.ACTIVE:y+=1;break;case g.MOBILE:z+=1;break;default:break;}}return {total:v,offline:w,idle:x,active:y,mobile:z};},getDebugInfo:function(v){return {id:v,presence:o[v],overlaySource:s[v],overlayTime:r[v],mobile:p[v]};}};e.exports=u;});
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelConnection","ChatContexts","ChatVisibility","CurrentUser","JSLogger","LastMobileActiveTimes","Poller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=5,y='/ajax/chat/buddy_list.php',z=1800000,aa=h.pollInterval,ba=h.lazyPollInterval,ca=h.lazyThreshold,da=n.create('available_list'),ea='presence_poller';i.setEntitySample(ea,.01);function fa(ga){"use strict";this.$PresencePoller0=ga;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=new p({interval:aa,setupRequest:this.$PresencePoller4.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(l.isOnline()){this.$PresencePoller5=Date.now();this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=h.updateTime;}else{this.$PresencePoller5=0;this.$PresencePoller8=0;this.$PresencePoller6=0;this.$PresencePoller7=0;}this.$PresencePoller9=0;this.$PresencePollera('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends,h.birthdayFriends);u.subscribe(function(ha,ia){if(ia.idleness>aa)this.forceUpdate();}.bind(this));q.subscribe('privacy-user-presence-changed',function(){this.forceUpdate();}.bind(this));}fa.prototype.start=function(){"use strict";setTimeout(this.$PresencePoller3.start.bind(this.$PresencePoller3),0);};fa.prototype.restart=function(){"use strict";if(this.$PresencePoller3.isMuted()){this.$PresencePoller3.resume();this.forceUpdate();}};fa.prototype.stop=function(){"use strict";this.$PresencePoller3.mute();};fa.prototype.forceUpdate=function(){"use strict";this.$PresencePoller3.request();};fa.prototype.getIsUserIdle=function(){"use strict";return this.$PresencePoller1;};fa.prototype.getWebChatNotification=function(){"use strict";return this.$PresencePoller2;};fa.prototype.getCallback=function(){"use strict";return this.$PresencePoller0;};fa.prototype.$PresencePollerb=function(){"use strict";return w(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};fa.prototype.$PresencePollera=function(ga,ha,ia,ja,ka,la){"use strict";this.$PresencePoller8=ha;if(!Array.isArray(ia)){r.resetPresenceData();for(var ma in ia)r.set(ma,ia[ma].a,false,ga,ia[ma].p);}if(ja)o.update(ja);if(ka)r.setMobileFriends(ka);if(la)r.setBirthdayFriends(la);this.$PresencePollerb();};fa.prototype.$PresencePoller4=function(ga){"use strict";if(j.isShutdown()||!l.isOnline()){this.$PresencePoller3.skip();i.bumpEntityKey(ea,'skip.offline');return;}if(Date.now()-this.$PresencePoller5<aa){this.$PresencePoller3.skip();i.bumpEntityKey(ea,'skip.recent');return;}i.bumpEntityKey(ea,'request');this.$PresencePoller5=Date.now();var ha=Date.now()-this.$PresencePoller7,ia=t.getCachedProfileIDs().join(",");ga.setHandler(this.$PresencePollerc.bind(this)).setErrorHandler(this.$PresencePollerd.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:m.getID(),cached_user_info_ids:ia,fetch_mobile:(ha>z)}).setURI(y).setAllowCrossPageTransition(true);};fa.prototype.$PresencePollerc=function(ga){"use strict";var ha=ga.getPayload(),ia=ha.buddy_list;if(!ia){this.$PresencePollerd(ga);return;}i.bumpEntityKey(ea,'response');this.$PresencePollere();this.$PresencePoller6=Date.now();s.update(ha.time);if(ia.mobile_friends)this.$PresencePoller7=Date.now();this.$PresencePoller9=0;this.$PresencePollerf();var ja=ia.userInfos;if(ja)t.setMulti(ja);var ka=ia.chatContexts;ka&&k.update(ka);this.$PresencePoller1=ia.userIsIdle;if(ia.chatNotif!==undefined){this.$PresencePoller2=ia.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollera('buddy_list_poller',ha.time,ia.nowAvailableList,ia.last_active_times,ia.mobile_friends,ia.todays_birthdays);};fa.prototype.$PresencePollerd=function(ga){"use strict";i.bumpEntityKey(ea,'error');if(ga.getError()==1356007)return;this.$PresencePoller9++;if(this.$PresencePoller9>=x)this.$PresencePoller0(g.ON_UPDATE_ERROR);};fa.prototype.$PresencePollerf=function(){"use strict";var ga=u.isActive(ca)?aa:ba;i.bumpEntityKey(ea,'period.'+ga);this.$PresencePoller3.setInterval(ga);};fa.prototype.$PresencePollere=function(){"use strict";var ga=Date.now(),ha=ga-this.$PresencePoller6;da.log('buddylist_presence_stats',v({duration:ha},r.getPresenceStats()));};e.exports=fa;});
__d("TypingDetector",["ArbiterMixin","Event","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,g,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();h.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=h.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),o-p+10);}}});e.exports=n;});
__d("AvailableList",["Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","ChannelConnection","ChannelConstants","ChatConfig","JSLogger","PresencePoller","PresencePrivacy","PresenceStatus","ShortProfiles","TypingDetector","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=t({},j,h);w.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(fa,ga){g.inform(fa,ga);});var x=u(function(){w.inform(j.ON_AVAILABILITY_CHANGED);},0);function y(fa,ga,ha,ia){var ja=q.set(fa,ga,ha,ia);if(ja)x();}function z(fa){var ga=fa.payload.availability||{};for(var ha in ga)y(ha,ga[ha],true,'mercury_tabs');}function aa(){ea.restart();}function ba(){ea.stop();}function ca(fa){var ga=w.getDebugInfo(fa),ha=(ga.presence==j.ACTIVE),ia=new i('/ajax/mercury/tabs_presence.php').setData({target_id:fa,to_online:ha,presence_source:ga.overlaySource,presence_time:ga.overlayTime}).setHandler(z).setErrorHandler(v).setAllowCrossPageTransition(true).send();}function da(fa,ga){ga.chat_config=m.getDebugInfo();ga.available_list_debug_info={};w.getAvailableIDs().forEach(function(ha){ga.available_list_debug_info[ha]=w.getDebugInfo(ha);});ga.available_list_poll_interval=w._poller&&w._poller.getInterval();}var ea=new o(function(event){w.inform(event);});t(w,{get:function(fa){return q.get(fa);},updateForID:function(fa){ca(fa);},getWebChatNotification:function(){return ea.getWebChatNotification();},isUserIdle:function(){return ea.getIsUserIdle();},isReady:function(){return true;},set:function(fa,ga,ha){y(fa,ga,true,ha);},update:function(){ea.forceUpdate();},isIdle:function(fa){return w.get(fa)==j.IDLE;},getOnlineIDs:function(){return q.getOnlineIDs();},getAvailableIDs:function(){return q.getAvailableIDs();},getOnlineCount:function(){return q.getOnlineCount();},getDebugInfo:function(fa){var ga=q.getDebugInfo(fa),ha=r.getNow(fa);if(ha)ga.name=ha.name;return ga;}});ea.start();g.subscribe(n.DUMP_EVENT,da);g.subscribe('chat-visibility/go-online',aa);g.subscribe('chat-visibility/go-offline',ba);p.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],x);k.subscribe([k.CONNECTED,k.RECONNECTING,k.SHUTDOWN,k.MUTE_WARNING,k.UNMUTE_WARNING],x);g.subscribe(l.getArbiterType('buddylist_overlay'),function(fa,ga){var ha=ga.obj.overlay;for(var ia in ha)w.set(ia,ha[ia].a,ha[ia].s||'channel');});g.subscribe([l.getArbiterType('typ'),l.getArbiterType('ttyp')],function(fa,ga){var ha=ga.obj;if(ha.st===s.TYPING){var ia=ha.from;w.set(ia,j.ACTIVE,'channel-typing');}});a.AvailableList=e.exports=w;});
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;});
__d("Chat",["Arbiter"],function(a,b,c,d,e,f,g){var h={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(k,l){g.subscribe(h[k],function(event,m){l(m);});}var j={openBuddyList:function(){i('buddyListNub',function(k){k.show();i('sidebar',function(l){l.enable();});});},closeBuddyList:function(){i('buddyListNub',function(k){k.hide();});},toggleSidebar:function(){i('sidebar',function(k){k.toggle();});}};a.Chat=e.exports=j;},3);
__d("ChatHovercard",["Arbiter","AsyncLoader","Hovercard","JSLogger","debounce"],function(a,b,c,d,e,f,g,h,i,j,k){var l=5,m=new h('/ajax/chat/hovercard/sidebar.php','hover'),n=j.create('chat_hovercard');g.subscribe('Hovercard/dirty',m.reset.bind(m));function o(s,t){m.get(s,function(u){setTimeout(function(){if(!u){n.error('fetch_failure',{id:s});return;}var v=i.getDialog(u);if(!v){n.error('no_hovercard',{id:s,endpoint:u});return;}if(s==t.getActiveID())t.showHovercard(s,v);},0);});}function p(s,t){var u=[];function v(y){if(y>=0&&y<s.length)u.push(s[y]);}var w=s.indexOf(t);if(w>-1){v(w);for(var x=1;x<l;x++){v(w+x);v(w-x);}}return u.filter(function(y){return y;});}function q(s,t){var u=t.getActiveID();if(u){var v=s.getShowingUsers(),w=p(v,u);m.get(w,function(){});}}function r(s){var t=s.getHoverController();t.registerDefault(o);t.subscribe('hover',k(q.bind(null,s,t),100));}e.exports=r;});
__d("ChatImpressionLogger",["AsyncSignal","AvailableList","ChatConfig","ChatVisibility","Poller","PresencePrivacy","PresenceStatus","debounceAcrossTransitions","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=null;function q(){return p.getCachedSortedList().toString();}function r(){var u=[],v=p.getCachedSortedList();for(var w=0;w<v.length;w++)u[w]=h.get(v[w]);return u.toString();}function s(u){u.setURI('/ajax/chat/imps_logging.php').setData({list_availability:r(),sorted_list:q(),source:'periodical_imps'});}var t={init:function(u){p=u;var v=i.get('chat_impression_logging_periodical',0);if(v){var w=i.get('periodical_impression_logging_config.interval'),x=new k({interval:w,setupRequest:s,clearOnQuicklingEvents:false,dontStart:true});l.subscribe('privacy-user-presence-changed',n(function(){if(j.isOnline()){x.start();}else x.stop();}));}this.init=function(){};},logImpression:function(u,v,w){var x=i.get('chat_impression_logging_with_click'),y={list_availability:x?r():'',sorted_list:x?q():'',source:u,target:v,target_presence:m.get(v),viewport_width:document.body.clientWidth};new g('/ajax/chat/ct.php',o(y,w)).send();}};e.exports=t;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryConstants').ChatNotificationConstants,m=b('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;});
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","KeyedCallbackManager","MercuryActionStatus","MercuryActionTypeConstants","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySendLogger","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","ReportState","MercuryServerRequests","StickerMacros","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","invariant","isNode","randomInt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){'use strict';function oa(gb,hb){var ib=hb;if(gb._localIdsMap[hb])ib=gb._localIdsMap[hb];return gb._messages[ib];}var pa=new j();function qa(gb,hb){if(hb.status===undefined)hb.status=k.UNSENT;hb.timestamp_absolute="Today";hb.message_id=hb.message_id||gb.generateNewClientMessageID(hb.timestamp);var ib=z.getIDForUser(gb._fbid);hb.specific_to_list=hb.specific_to_list||[];if(hb.specific_to_list.length&&hb.specific_to_list.indexOf(ib)===-1)hb.specific_to_list.push(ib);if(!hb.thread_id){if(hb.specific_to_list.length==1){hb.thread_id='user:'+gb._fbid;}else if(hb.specific_to_list.length==2){var jb=hb.specific_to_list[0]==ib?hb.specific_to_list[1]:hb.specific_to_list[0];if(p.tokenize(jb).type=='email'){hb.thread_id=o.PENDING_THREAD_ID;}else hb.thread_id=gb._threads.getThreadIDForParticipant(jb);}hb.thread_id=hb.thread_id||'root:'+hb.message_id;}if(!hb.specific_to_list.length){var kb=gb._serverRequests.tokenizeThreadID(hb.thread_id);if(kb.type=='user')hb.specific_to_list=['fbid:'+kb.value,ib];}}function ra(gb,hb,ib,jb){var kb=cb(ib)?[s.CHAT]:[],lb=Date.now(),mb=ja(new Date(lb),'g:ia'),nb={action_type:hb,thread_id:jb,author:z.getIDForUser(gb._fbid),author_email:null,coordinates:null,timestamp:lb,timestamp_absolute:(new Date(lb)).toLocaleDateString(),timestamp_relative:mb,timestamp_time_passed:x.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:ib,source_tags:kb};return nb;}function sa(gb){switch(gb){case t.UNKNOWN:case t.SERVER_INITIAL_DATA:case t.SERVER_FETCH_THREAD_INFO:case t.SERVER_THREAD_SYNC:return true;}return false;}function ta(gb){return gb&&gb.substr(0,6)==='server';}function ua(gb,hb){if(!gb._threadsToMessages[hb])gb._threadsToMessages[hb]=new ba(function(ib){return oa(gb,ib).timestamp;},function(ib,jb){return jb-ib;});return gb._threadsToMessages[hb];}function va(gb){var hb=[];return JSON.stringify(gb,function(ib,jb){if(typeof jb==='object'&&jb!==null){if(la(jb))return '<'+jb.nodeName+'>';if(hb.indexOf(jb)!==-1)return 'CIRCULAR';hb.push(jb);}return jb;});}ca.registerCallback('mercury-messages',function(){var gb={},hb={},ib=xa._getInstances();for(var jb in ib){gb[jb]={};for(var kb in ib[jb]._messages){var lb=ib[jb]._messages[kb];if(Object.keys(lb).length===0)continue;var mb=lb.thread_id;gb[jb][mb]=gb[jb][mb]||{};gb[jb][mb][lb.message_id]=JSON.parse(va(lb));}hb[jb]=ha({},ib[jb]._localIdsMap);}var nb={};nb.local_message_ids=hb;nb.messages=gb;return nb;});function wa(gb,hb,ib){hb.forEach(function(jb){var kb=ua(gb,jb);kb.setReachedEndOfArray();gb._threadInformer.reorderedMessages(jb,ib);});}function xa(gb){this._fbid=gb;this._serverRequests=da.getForFBID(this._fbid);this._threadInformer=fa.getForFBID(this._fbid);this._threads=ga.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(hb,ib){var jb=(ib.actions||[]).filter(function(lb){var mb=lb.action_type;return (lb.is_forward||lb.thread_id)&&(mb==l.LOG_MESSAGE||mb==l.USER_GENERATED_MESSAGE||mb==l.SEND_MESSAGE||mb==l.CLEAR_CHAT||mb==l.DELETE_THREAD||mb==l.DELETE_MESSAGES);}),kb=sa(ib.payload_source);if(ta(ib.payload_source))jb.forEach(function(lb){if(!lb.is_forward){var mb=this._threads.getThreadMetaNow(lb.thread_id);if(mb)lb.is_cleared=lb.timestamp<mb.chat_clear_time;}}.bind(this));this.handleUpdates(jb,kb,ib.payload_source,ib.from_client);if(ib.end_of_history)wa(this,ib.end_of_history,ib.payload_source);}.bind(this));}ha(xa.prototype,{getMessagesFromIDs:function(gb){return (gb||[]).map(oa.bind(null,this)).filter(function(hb){return hb;});},hasLoadedNMessages:function(gb,hb){var ib=ua(this,gb);return ib.hasReachedEndOfArray()||ib.getCurrentArraySize()>=hb;},hasLoadedExactlyNMessages:function(gb,hb){var ib=ua(this,gb);return ib.getCurrentArraySize()==hb;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(gb,hb,ib,jb,kb,lb){var mb=ua(this,gb),nb=function(tb){jb(ya(this,tb));}.bind(this),ob=mb.executeOrEnqueue(hb,ib,nb),pb=mb.getUnavailableResources(ob),qb=this._failedHistoryFetchThreads[gb];if(pb.length&&!qb){var rb=(this._titanMessagesCount[gb]||0)-(this._localTitanMessagesCount[gb]||0),sb=pb.length+(this._localTitanMessagesCount[gb]||0);this._serverRequests.fetchThreadMessages(gb,rb,sb,kb,lb);}else this._failedHistoryFetchThreads[gb]=false;return ob;},getThreadMessagesSinceTimestamp:function(gb,hb){var ib=ua(this,gb),jb=ib.getElementsUntil(hb);return ya(this,jb);},hasLoadedAllMessages:function(gb){return ua(this,gb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(gb){var hb=ua(this,gb).getAllResources();return ya(this,hb);},unsubscribe:function(gb,hb){m.isThreadID(hb);var ib=ua(this,hb);ib.unsubscribe(gb);},addAttachmentData:function(gb,hb,ib){var jb=oa(this,gb);if(jb){var kb=jb.attachments.indexOf(hb);if(kb!=-1){jb.attachments[kb]=ib;this._threadInformer.updatedMessage(jb.thread_id,jb.message_id,'attach');}}else{if(!this._attachmentData[gb])this._attachmentData[gb]=[];this._attachmentData[gb].push({attach_key:hb,data:ib});}},shouldSortOutOfOrderMessages:function(gb,hb,ib){if(gb==t.CLIENT_CHANNEL_MESSAGE){var jb=this.getThreadMessagesSinceTimestamp(hb,ib);if(jb.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},handleUpdates:function(gb,hb,ib,jb){var kb,lb={},mb={};for(var nb=0;nb<gb.length;nb++){var ob=gb[nb];if(ob.is_forward||ib==t.SERVER_SEARCH){if(!this._messages[ob.message_id]){this._messages[ob.message_id]=ob;db(this,ob);}continue;}if(ob.client_state===r.SEND_TO_SERVER){this._messages[ob.message_id]=ob;db(this,ob);continue;}var pb=ob.action_type;if(pb==l.SEND_MESSAGE){var qb=ob.client_message_id;if(qb&&this._localIdsMap[qb]&&ob.status){if(ob.status==k.UNCONFIRMED){if(!mb[ob.thread_id])mb[ob.thread_id]=[];mb[ob.thread_id].push(ob.client_message_id);}else if(!lb[ob.thread_id])lb[ob.thread_id]=[];var rb=oa(this,ob.client_message_id),sb=rb.status;rb.status=ob.status;if(ob.status===k.SUCCESS||ob.error_data)rb.error_data=ob.error_data;if(ob.status==k.SUCCESS){this.updateLocalMessage(ob,ib);if(ob.client_thread_id==o.PENDING_THREAD_ID){rb.thread_id=ob.thread_id;lb[ob.thread_id].push(rb.message_id);pa.setResource(rb.message_id,rb.thread_id);}}if(typeof sb!='undefined'||ob.status==k.FAILED_UNKNOWN_REASON||ob.status==k.UNABLE_TO_CONFIRM||ob.status==k.SUCCESS||ob.status==k.ERROR)this._threadInformer.updatedMessage(ob.thread_id,oa(this,ob.client_message_id).message_id,ib);}continue;}else if(pb==l.DELETE_THREAD){ua(this,ob.thread_id).removeAllResources();continue;}else if(pb==l.DELETE_MESSAGES){var tb=ob.message_ids.map(function(ac){return oa(this,ac).message_id;}.bind(this));kb=ua(this,ob.thread_id);kb.removeResources(tb);this._threadInformer.reorderedMessages(ob.thread_id,ib);continue;}else if(pb==l.LOG_MESSAGE){if(ob.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[ob.thread_id]=true;}else if(pb==l.CLEAR_CHAT){var ub=ua(this,ob.thread_id).getAllResources();ub.map(oa.bind(null,this)).forEach(function(ac){ac.is_cleared=true;});continue;}var vb=oa(this,ob.message_id);if((ob.threading_id&&this._localIdsMap[ob.threading_id])||(vb&&!vb.is_forward))continue;if(!lb[ob.thread_id])lb[ob.thread_id]=[];lb[ob.thread_id].push(ob.message_id);this._messages[ob.message_id]=ob;db(this,ob);if(ob.threading_id&&ob.threading_id!=ob.message_id)y.addServerID(ob.threading_id,ob.message_id);hb=hb||this.shouldSortOutOfOrderMessages(ib,ob.thread_id,ob.timestamp);if(!hb)this._threadInformer.receivedMessage(ob);}for(var wb in lb){kb=ua(this,wb);var xb=kb.getAllResources(),yb=xb.filter(function(ac){var bc=this._messages[ac];return bc.action_type==l.LOG_MESSAGE&&bc.log_message_type==q.SERVER_ERROR;}.bind(this));kb.removeResources(yb);za(this,wb,lb[wb]);if(jb)ab(this,wb,lb[wb]);if(hb){kb.addResources(lb[wb]);this._threadInformer.reorderedMessages(wb,ib);}else kb.addResourcesWithoutSorting(lb[wb].reverse(),0);this._threadInformer.updatedThread(wb);}var zb=Object.keys(mb);if(zb.length)this._serverRequests.requestMessageConfirmation(mb);},sendMessage:function(gb,hb,ib){ea.stickerlize(gb);var event=u.CLIENT_SEND_ATTEMPTED;if(gb.status===k.RESENDING)event=u.CLIENT_RESEND_ATTEMPTED;var jb=false;if(p.isValid(gb.thread_id))jb=!p.isMultichat(gb.thread_id);setTimeout(function(){u.log(event,gb.message_id,{canonical:jb});},0);hb=hb||Function.prototype;qa(this,gb);this._localIdsMap[gb.message_id]=gb.message_id;if(gb.thread_id=='root:'+gb.message_id)ua(this,gb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(gb,ib);if(gb.thread_id==o.PENDING_THREAD_ID){this._messages[gb.message_id]=gb;return pa.executeOrEnqueue(gb.message_id,hb);}else hb(gb.thread_id);},isOutbound:function(gb){return gb.author==z.user;},isInbound:function(gb){return !this.isOutbound(gb);},isSending:function(gb){return (gb.status===k.UNSENT||gb.status===k.UNCONFIRMED||gb.status===k.UNABLE_TO_CONFIRM||gb.status===k.RESENDING);},isFirstMessage:function(gb){var hb=ua(this,gb.thread_id);if(hb.getCurrentArraySize()===0)return false;var ib=hb.getResourceAtIndex(hb.getCurrentArraySize()-1),jb=oa(this,ib).message_id,kb=oa(this,gb.message_id).message_id;return hb.hasReachedEndOfArray()&&jb==kb;},unsubscribeSend:function(gb){pa.unsubscribe(gb);},resendMessage:function(gb,hb){var ib=ha({},gb);ib.status=k.RESENDING;ib.timestamp=Date.now();ib.message_id=gb.message_id;this._messages[gb.message_id]=ib;var jb=ua(this,gb.thread_id);jb.resortResources([gb.message_id]);this.sendMessage(ib,null,hb);this._threadInformer.reorderedMessages(gb.thread_id,t.CLIENT_SEND_MESSAGE);},deleteMessages:function(gb,hb){if(hb.length){var ib=ua(this,gb),jb=ib.getCurrentArraySize()==hb.length&&ib.hasReachedEndOfArray();this._serverRequests.deleteMessages(gb,hb,jb);}},deleteLocalMessage:function(gb){if(this._localTitanMessagesCount[gb])this._localTitanMessagesCount[gb]--;},markMessagesSpam:function(gb,hb){if(hb.length){var ib=ua(this,gb),jb=ib.getCurrentArraySize()==hb.length&&ib.hasReachedEndOfArray();if(jb){this._serverRequests.markThreadSpam(gb);}else this._serverRequests.markMessagesSpam(gb,hb);}},updateLocalMessage:function(gb,hb){var ib=gb.message_id,jb=gb.client_message_id;this._localIdsMap[jb]=ib;this._messages[ib]=this._messages[jb];y.addServerID(jb,ib);this._messages[jb]={};var kb=oa(this,jb);if(gb.timestamp)kb.timestamp=gb.timestamp;if(gb.attachments&&gb.attachments.length){kb.raw_attachments=null;kb.attachments=gb.attachments;db(this,kb,ib);}if(gb.log_message_data)kb.log_message_data=gb.log_message_data;if(bb(kb))this._localTitanMessagesCount[kb.thread_id]--;},constructUserGeneratedMessageObject:function(gb,hb,ib,jb){var kb=ra(this,l.USER_GENERATED_MESSAGE,hb,ib);if(typeof gb=='string')gb=gb.replace(/^\s+/,'').replace(/\s+$/,'');kb.body=gb;kb.has_attachment=false;kb.html_body=false;kb.attachments=[];kb.specific_to_list=jb||[];return kb;},constructLogMessageObject:function(gb,hb,ib,jb){var kb=ra(this,l.LOG_MESSAGE,gb,hb);kb.log_message_type=ib;kb.log_message_data=jb;return kb;},generateNewClientMessageID:function(gb){var hb=gb+':'+(ma(0,4294967295)+1)+'-'+aa.getSessionID();return '<'+hb+'@mail.projektitan.com>';},getNumberLocalMessages:function(gb){return this._localTitanMessagesCount[gb]||0;},_uploadMessages:{},updateNewMessage:function(gb,hb,ib){if(ib.preview_attachments.length>0){gb.has_attachment=true;gb.preview_attachments=ib.preview_attachments;}gb.client_state=r.DO_NOT_SEND_TO_SERVER;gb.status=k.RESENDING;this._uploadMessages[hb]=gb;return gb;},updateMessageAfterUpload:function(gb,hb){var ib=this._uploadMessages[gb];ka(ib);ib.image_ids=hb.image_ids;ib.client_state=r.SEND_TO_SERVER;return ib;},clearUploadedMessage:function(gb){delete this._uploadMessages[gb];}});ha(xa,v,{addAttachmentData:function(gb,hb,ib,jb){jb=jb||i.getID();xa.getForFBID(jb).addAttachmentData(gb,hb,ib);}});function ya(gb,hb){var ib=hb.map(oa.bind(null,gb));return ib.reverse();}function za(gb,hb,ib){var jb=ib.filter(function(kb){return bb(oa(gb,kb));});if(!gb._titanMessagesCount[hb])gb._titanMessagesCount[hb]=0;gb._titanMessagesCount[hb]+=jb.length;}function ab(gb,hb,ib){var jb=ib.filter(function(kb){return bb(oa(gb,kb));});if(!gb._localTitanMessagesCount[hb])gb._localTitanMessagesCount[hb]=0;gb._localTitanMessagesCount[hb]+=jb.length;}function bb(gb){var hb=gb.action_type;if(hb==l.USER_GENERATED_MESSAGE)return true;switch(gb.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function cb(gb){switch(gb){case w.CHAT_WEB:case w.CHAT_JABBER:case w.CHAT_IPHONE:case w.CHAT_MEEBO:case w.CHAT_ORCA:case w.CHAT_TEST:case w.CHAT:case w.DESKTOP:return true;default:return false;}}function db(gb,hb,ib){ib=ib||hb.message_id;var jb=gb._attachmentData[ib];if(jb){jb.forEach(function(kb){var lb=hb.attachments.indexOf(kb.attach_key);if(lb!==-1)hb.attachments[lb]=kb.data;});delete gb._attachmentData[ib];}else if(!hb.is_forward&&eb(gb,hb)){gb._messagesNeedingAttachmentData[ib]=true;fb(gb);}}function eb(gb,hb){if(!hb||!hb.attachments)return false;for(var ib=0;ib<hb.attachments.length;ib++){var jb=hb.attachments[ib];if(typeof jb==='string'&&jb.indexOf(n.SHARE)===0)return true;}var kb=hb.forward_message_ids||[];for(ib=0;ib<kb.length;ib++){var lb=oa(gb,kb[ib]);if(eb(gb,lb))return true;}return false;}var fb=ia(function(gb){var hb={};for(var ib in gb._messagesNeedingAttachmentData){var jb=oa(gb,ib);if(eb(gb,jb))hb[ib]=true;}var kb=Object.keys(hb);if(kb.length){var lb={message_ids:kb};if(gb._fbid!=i.getID())lb.request_user_id=gb._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(lb).setAllowCrossPageTransition(true).send();}gb._messagesNeedingAttachmentData={};},0,this);e.exports=xa;});
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;});
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","PresenceInitialData","PresenceState","PresenceUtil","areJSONRepresentationsEqual","arrayContains","copyProperties","MercuryServerRequests","MercuryMessages","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryServerRequests').get(),t=b('MercuryMessages').get(),u=b('MercuryThreads').get(),v=b('MercuryTimestampTracker').get(),w=[],x=null,y=null,z=null,aa=null;function ba(){return parseInt(m.serverTime,10);}var ca=j.get('tab_max_load_age')||3600000,da=ba()-ca,ea=0,fa=20,ga=k.create('chat_tab_model'),ha=false;function ia(bb){var cb=n.verifyNumber(bb.uct2);if(!cb||typeof cb!=='number'){ga.warn('bad_cookie_version',bb.uct2);return null;}if(cb<ea||cb<da)return null;return cb;}function ja(bb){var cb=ia(bb);if(!cb){var db={};db.old_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.old_promoted=bb&&bb.lm2;db.old_time=bb&&bb.uct2;db.old_reason=bb&&bb.tr;db.old_window=bb&&bb.tw;var eb;if(y&&bb.t2)for(var fb=0;fb<bb.t2.length;fb++){var gb=bb.t2[fb];if(gb.i===y)eb=gb.r;}var hb=[];w.forEach(function(ib){if(!ib.fragile){var jb={i:ib.id,si:ib.server_id};if(ib.raised||(ib.id===y&&eb))jb.r=1;hb.push(jb);}});bb.t2=hb;bb.uct2=ea;bb.lm2=x;bb.tr=aa;bb.tw=o.getSessionID();db.new_tabs=JSON.stringify(bb.t2);db.new_promoted=bb.lm2;db.new_time=bb.uct2;db.new_reason=bb.tr;db.new_window=bb.tw;ga.debug('store',db);}return bb;}function ka(bb){if(bb){var cb=ia(bb);if(cb&&cb!==ea){var db={};db.old_tabs=JSON.stringify(w);db.old_promoted=x;db.old_time=ea;db.old_reason=aa;db.window_id=o.getSessionID();db.cookie_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.cookie_promoted=bb&&bb.lm2;db.cookie_time=bb&&bb.uct2;db.cookie_reason=bb&&bb.tr;db.cookie_window=bb&&bb.tw;ea=cb;aa='load';var eb=la(bb.t2,bb.lm2||null);db.load_result=eb;db.new_tabs=JSON.stringify(w);db.new_promoted=x;db.new_time=ea;db.new_reason=aa;var event='load';if(!ha)event+='_init';ga.log(event,db);return eb;}}return false;}function la(bb,cb){if(ma(bb,cb)){var db=w.filter(function(gb){return gb.fragile;}),eb={};x=null;w=bb.map(function(gb){var hb={id:gb.i,server_id:gb.si};if(hb.id==cb)x=hb.id;if(y==gb.i){var ib=ra(y);if(ib!=-1){hb.raised=w[ib].raised;return hb;}else return null;}if(gb.r)hb.raised=true;eb[hb.id]=hb;return hb;});w=w.filter(function(gb){return gb!=null;});if(z)for(var fb in z)if(!eb[fb]||!eb[fb].raised)delete z[fb];db=db.filter(function(gb){return !eb[gb.id];});w=w.concat(db);qa();return true;}return false;}function ma(bb,cb){if(cb!=x)return true;var db=w.filter(function(gb){return !gb.fragile;});if(bb.length!=db.length)return true;for(var eb=0,fb=bb.length;eb<fb;eb++){if(bb[eb].id===y)continue;if(!p(bb[eb],db[eb]))return true;}return false;}function na(bb,cb,db){var eb=ka(n.get());if(cb===undefined||cb>ea){if(bb()){eb=true;aa=db||null;pa(cb);}}else ga.error('rejected',{change_time:cb,state_time:ea});eb&&oa();}function oa(){if(ha)za.inform('chat/tabs-changed',za.get());}function pa(bb){if(bb===undefined)bb=Math.max(v.getLastUserMessageTimestamp()||1,ea+1);ea=bb;n.doSync();}function qa(bb){var cb=w.length-fa;if(cb>0)w=w.filter(function(db){return db.raised||db.id==bb||cb--<=0;});if(cb>0)w=w.filter(function(db){return db.id==x||db.id==bb||cb--<=0;});}function ra(bb){for(var cb=0;cb<w.length;cb++)if(w[cb].id==bb)return cb;return -1;}function sa(bb,cb){var db=u.getThreadMetaNow(bb);if(!db)return false;if(db.is_canonical_user){return va(bb,cb);}else{var eb=ta(bb);if(eb)s.getServerThreadID(bb,function(fb){if(xa(bb,fb)){pa();oa();}});return eb;}}function ta(bb){if(ra(bb)===-1){w.push({id:bb,fragile:true});ga.log('open_fragile_tab',{tabs:JSON.stringify(w),opened:bb,window_id:o.getSessionID()});return true;}return false;}function ua(bb){var cb=[];bb.forEach(function(db){var eb=ra(db);if(eb!==-1)cb.push(w[eb]);});w.forEach(function(db){if(!q(bb,db.id))cb.push(db);});na(function(){if(ma(cb,x)){w=cb;return true;}return false;});}function va(bb,cb){var db=ra(bb);if(db!=-1)if(w[db].fragile){w.splice(db,1);}else{cb&&(w[db].signatureID=cb);return true;}for(var eb=0;eb<=w.length;eb++)if(eb==w.length||w[eb].fragile){w.splice(eb,0,{id:bb,signatureID:cb});qa(bb);ga.log('open_tab',{tabs:JSON.stringify(w),opened:bb,window_id:o.getSessionID()});return true;}}function wa(bb){var cb=ra(bb);if(cb!=-1&&(!w[cb].raised||x!==bb)){w[cb].raised=true;x=bb;return true;}return false;}function xa(bb,cb){var db=ra(bb);if(db!=-1&&w[db].fragile){var eb=w[db];eb.fragile=false;eb.server_id=cb;var fb=[];w.forEach(function(gb){if(gb.id!=bb){if(eb&&gb.fragile){fb.push(eb);eb=null;}fb.push(gb);}});if(eb)fb.push(eb);w=fb;ga.log('make_permanent',{tabs:JSON.stringify(w),tab_id:bb,window_id:o.getSessionID()});return true;}return false;}function ya(bb){var cb=ra(bb);if(bb==x)x=null;if(cb!=-1){w.splice(cb,1);ga.log('close_tab',{tabs:JSON.stringify(w),closed:bb,window_id:o.getSessionID()});return true;}return false;}n.registerStateStorer(ja);n.registerStateLoader(function(bb){if(ka(bb))oa();});function za(){}r(za,h,{isTabPromoted:function(bb){if(bb)return bb==x;return false;},indexOf:function(bb){return ra(bb);},getTab:function(bb){l.isThreadID(bb);var cb=this.indexOf(bb);if(cb>-1){var db=w[cb];return r({},db);}return null;},getEmptyTab:function(){var bb;for(var cb=0;cb<w.length;cb++){bb=w[cb].id;if(u.isNewEmptyLocalThread(bb))return bb;}bb='root:'+t.generateNewClientMessageID(Date.now());u.createNewLocalThread(bb,[]);return bb;},getServerTime:function(){return ba();},changeShowingTabs:function(bb){return ua(bb);},closeAllTabs:function(){if(w.length){ga.log('close_all_tabs',{closed_tabs:JSON.stringify(w),window_id:o.getSessionID()});w=[];x=null;if(z)z={};pa();oa();}},closeFragileTabs:function(){var bb=[];for(var cb=0;cb<w.length;cb++)if(w[cb].fragile&&!u.isNewEmptyLocalThread(w[cb].id)){bb.push(w[cb]);w.splice(cb);oa();break;}ga.log('close_fragile_tabs',{tabs:JSON.stringify(w),fragile_closed:bb,window_id:o.getSessionID()});},closeTab:function(bb,cb){l.isThreadID(bb);var db=false;if(z){delete z[bb];db=true;}na(function(){if(ya(bb))db=true;return db;},undefined,cb);},raiseTab:function(bb,cb,db){l.isThreadID(bb);var eb=false;if(z&&cb){z[bb]=true;eb=true;}if(!cb&&bb===y){eb&&oa();return;}na(function(){if(sa(bb,db))eb=true;var fb=ra(bb);if(fb!=-1&&!w[fb].raised){w[fb].raised=true;eb=true;ga.log('raise_tab',{tabs:JSON.stringify(w),raised:bb,window_id:o.getSessionID()});}return eb;});},get:function(){var bb=w.map(function(cb){var db=r({},cb);delete db.fragile;if(z)db.raised=z[db.id];return db;});return {tabs:bb,promoted:x};},openFragileTab:function(bb){l.isThreadID(bb);if(ta(bb))oa();},openTab:function(bb){l.isThreadID(bb);na(sa.bind(null,bb));},lowerTab:function(bb){l.isThreadID(bb);var cb=false;if(z){delete z[bb];cb=true;}na(function(){var db=ra(bb);if(db!=-1&&w[db].raised){delete w[db].raised;ga.log('lower_tab',{tabs:JSON.stringify(w),lowered:bb,window_id:o.getSessionID()});cb=true;}return cb;});},raiseAndPromoteTab:function(bb,cb,db,eb,fb){l.isThreadID(bb);var gb=false;if(z&&cb){z[bb]=true;gb=true;}if(!cb&&bb===y){gb&&oa();return;}na(function(){if(sa(bb,db))gb=true;if(wa(bb)){gb=true;ga.log('raise_and_promote_tab',{tabs:JSON.stringify(w),promoted:bb,window_id:o.getSessionID()});}return gb;},eb,fb);},setPromotedTab:function(bb){l.isThreadID(bb);na(wa.bind(null,bb));},promoteThreadInPlaceOfThread:function(bb,cb,db,eb){l.isThreadID(bb);l.isThreadID(cb);na(function(){var fb=ra(bb),gb=ra(cb);if(eb){x=bb;}else if(x===cb)return true;var hb=w[fb];if(db){l.isThreadID(db);var ib=ra(db),jb=w[gb];w[gb]=hb;w.splice(fb,1);w.splice(ib,0,jb);}else{w[fb]=w[gb];w[gb]=hb;}return true;});},squelchTab:function(bb){l.isThreadID(bb);y=bb;this.lowerTab(bb);ga.log('squelch_tab',{squelched:bb,tabs:JSON.stringify(w),window_id:o.getSessionID()});},clearSquelchedTab:function(){if(y)ga.log('unsquelch_tab',{squelched:y,tabs:JSON.stringify(w),window_id:o.getSessionID()});y=null;},persistLocalRaised:function(){if(z){na(function(){var bb=false;w.forEach(function(cb){if(cb.raised!=z[cb.id]){bb=true;if(z[cb.id]){cb.raised=true;}else delete cb.raised;}});return bb;});ga.log('persist_local_raise',{tabs:JSON.stringify(w),window_id:o.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(bb,cb){cb.chat_tabs={promoted:x,tabs:w.map(function(db){return r({},db);}),time:ea,max_load_age:ca};});function ab(){var bb=i.ignoresRemoteTabRaise();if(bb&&!z){ga.log('start_ignore_remote_raise');z={};oa();}else if(!bb&&z){ga.log('stop_ignore_remote_raise');z=null;oa();}}i.subscribe(i.ON_CHANGED,ab);ab();ka(n.getInitial(),true);if(ea===0)ea=ba()-600000;ha=true;e.exports=za;});
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=175,v=269,w=0;function x(){return u;}function y(){return v;}function z(aa){this._root=aa;var ba=this._recalculateWidth.bind(this);m.listen(window,'resize',ba);j.subscribe('resize',ba);g.subscribeOnce('sidebar/initialized',ba,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(z.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var aa=z._getAvailableDockWidth(this._root),ba=Math.max(1,Math.floor(aa/y())),ca=ba!=this._maxShown;if(!this._viewState||ca||aa<=this._viewState.usedWidth||aa>this._viewState.widthToShowNext){this._availableWidth=aa;this._maxShown=ba;this._viewState=null;this._recalculateTabs(ca);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(aa){var ba=z._getTabsToShow(i.get(),this._availableWidth);if(aa||!q(this._viewState,ba)){this._viewState=ba;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>y();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var aa=i.get(),ba=this._viewState.tabsToShow;return aa.tabs.filter(function(ca){return ba[ca.id];});},getRightmostHiddenTab:function(){var aa=i.get(),ba=this._viewState.tabsToShow,ca=aa.tabs.filter(function(ea){return !ba[ea.id];}),da=ca.shift();return da?da.id:null;},getLeftmostVisibleTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.pop();return ba?ba.id:null;},shouldPromoteOnRaise:function(aa){if(!this._viewState.tabsToShow[aa])return true;if(this._viewState.nextToHide!=aa)return false;var ba=i.getTab(aa),ca=ba&&ba.raised;return !ca&&(this._availableWidth-this._viewState.usedWidth<y()-x());}});r(z,{_getAvailableDockWidth:function(aa){var ba=l.getViewportWithoutScrollbarDimensions().width;ba-=p.getLeft()+p.getRight();ba-=50;var ca=n.byClass(aa,'fbDock'),da=k.find(ca,"._56ox"),ea=o.getElementDimensions(da).x;ba-=ea;var fa=k.scry(ca,"._56oy");ea+=o.getElementDimensions(fa.pop()).x;var ga=o.getElementDimensions(ca),ha=ga.x-ea;if(ha>w)w=ha;ba-=w;ba-=15;return Math.max(ba,0);},_getTabsToShow:function(aa,ba){ba=Math.max(ba,y()+1);function ca(sa,ta){return (sa.raised||!ta)?y():x();}var da=JSON.parse(JSON.stringify(aa.tabs)),ea=-1,fa=null;if(aa.promoted)da.forEach(function(sa,ta){if(sa.id===aa.promoted){ea=ta;fa=sa;}});var ga=0,ha=false,ia=0,ja=!fa;da.forEach(function(sa,ta){var ua=ca(sa,ha);ha=ha||!sa.raised;sa.leftmostOffset=ga+ua;ga+=ua;if(sa.leftmostOffset<ba)ia++;ja|=ta==ea;sa.alreadyPlacedPromoted=ja;});function ka(sa,ta,ua){var va={};for(var wa=0;wa<ta;wa++){var xa=sa[wa];if(!xa.alreadyPlacedPromoted&&wa==ta-1){va[ua]=true;}else va[xa.id]=true;}return va;}var la=ka(da,ia,aa.promoted),ma=ka(da,ia-1,aa.promoted),na=null;for(var oa in la)if(!ma[oa])na=oa;var pa=da[ia-1],qa=pa?pa.leftmostOffset:0,ra=Infinity;if(ia<da.length)ra=da[ia].leftmostOffset;return {nextToHide:na,tabsToShow:la,usedWidth:qa,widthToShowNext:ra};}});e.exports=z;});
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};});
__d("ChatTypeaheadBehavior",["ChatConfig","ChatOpenTab","CSS","DOM","Parent","Rect","copyProperties","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(r,s){var t=k.byClass(r,"_4oes");if(t)i.conditionClass(t,"_5q83",s);}function q(r){"use strict";this._typeahead=r;}q.prototype.enable=function(){"use strict";var r=this._typeahead;this._subscriptions=[r.subscribe('focus',function(){r.getData().refreshData();p(r.getElement(),true);}),r.subscribe('blur',function(s){r.getCore().reset();p(r.getElement(),false);}),r.subscribe('respond',function(s,t){if(t.value&&t.value===r.getCore().getValue()){if(!t.results.length){var u=g.get('divebar_typeahead_group_fof',0);if(u&&!t.isAsync)return;var v=j.create('div',{className:'noResults'},"Friend not found.");j.setContent(r.getView().getElement(),v);}i.addClass(r.getElement(),'hasValue');}}),r.subscribe('reset',function(){i.removeClass(r.getElement(),'hasValue');}),r.subscribe('select',function(s,t){r.getView().hide();h.openTabByType(t.selected.uid,t.selected.type,'typeahead');}),r.subscribe('highlight',function(s,t){if(t.index>=0){var u=r.getView().getItems()[t.index];if(u){var v=new l(u),w=u.offsetParent,x=v.boundWithin(new l(w)).getPositionVector();v.getPositionVector().sub(x).scrollElementBy(w);}}})];};q.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(r){this._typeahead.unsubscribe(r);}.bind(this));this._subscriptions=null;};m(q.prototype,{_subscriptions:null});e.exports=q;});
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("ChatOrderedListHover",["ArbiterMixin","CSS","ErrorUtils","Event","LayerHideOnBlur","Parent","copyProperties","cx","mixin","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(x){h.addClass(x,'fetching');}function s(x){h.removeClass(x,'fetching');}var t=o(g);for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x){"use strict";this._orderedList=x;this._root=x.getRoot();j.listen(this._root,'mouseover',this._mouseOver.bind(this));j.listen(this._root,'mouseleave',this._mouseLeave.bind(this));x.subscribe('click',q(this._hide,this));}w.prototype._mouseOver=function(event){"use strict";if(this._paused)return;var x=event.getTarget(),y=l.byClass(x,"_42fz")||l.byClass(x,"_5a58");y&&this._setActiveItem(y);};w.prototype._mouseLeave=function(event){"use strict";this._setActiveItem(null);};w.prototype._clearTimeouts=function(){"use strict";this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;};w.prototype._hide=function(){"use strict";if(this._showingDialog){this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}};w.prototype._show=function(){"use strict";var x=this.getActiveID(),y=false;if(this._defaultHandler){y=true;i.applyWithGuard(this._defaultHandler,{},[x,this]);}if(y&&this._showingID!=this.getActiveID())r(this._activeItem);};w.prototype._setActiveItem=function(x){"use strict";if(x!=this._activeItem){this._clearTimeouts();this._activeItem&&s(this._activeItem);this._activeItem=null;var y=x?0:100;this._hideTimeout=p(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),y);if(x){this._activeItem=x;var z=y+500;this._showTimeout=p(function(){this._show();}.bind(this),z);this.inform('hover');}else this.inform('leave');}};w.prototype.registerDefault=function(x){"use strict";this._defaultHandler=x;};w.prototype.getActiveID=function(){"use strict";var x=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return x||null;};w.prototype.showHovercard=function(x,y){"use strict";if(x==this.getActiveID()&&x!=this._showingID){this._clearTimeouts();s(this._activeItem);this._hide();this._showingDialog=y;this._showingID=x;var z=y.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),aa=y.subscribe('mouseleave',function(){z.unsubscribe();this._setActiveItem(null);}.bind(this)),ba=y.subscribe('hide',function(){this.inform('hovercard_hide');z.unsubscribe();aa.unsubscribe();ba.unsubscribe();}.bind(this));y.enableBehavior(k).setContext(this._activeItem).setPosition('left').show();this.inform('hovercard_show');}};m(w.prototype,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_defaultHandler:null});e.exports=w;});
__d("ChatSidebarConstants",["ChatSidebarDynamicConstants","mergeInto"],function(a,b,c,d,e,f,g,h){var i={LITESTAND_CLASSIC_SIZE:g.divebar_image_size,IMAGE_SIZE:28};h(i,{getImageSize:function(j){if(j===false)return i.IMAGE_SIZE;return i.LITESTAND_CLASSIC_SIZE;},getItemHeight:function(j){if(j===false)return i.IMAGE_SIZE+4;return i.LITESTAND_CLASSIC_SIZE+4;}});e.exports=i;});
__d("SplitImage.react",["React","Image.react","cx"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:'SplitImage',render:function(){var k=this.props.size;return this.transferPropsTo(g.DOM.div({className:"_55lt",style:{width:k,height:k}},this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var k=this.props.srcs,l=Array.isArray(k);if(!l||k.length==1)return this.renderOne(l?k[0]:k);return k.length==2?this.renderTwo(k):this.renderThree(k);},renderOne:function(k){return (h({src:k,width:this.props.size,height:this.props.size}));},renderTwo:function(k){var l=this.props.size,m=Math.floor(l/2),n=-Math.floor(m/2),o=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.DOM.div(null,g.DOM.div({className:"_55lu",style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:o,style:{width:m}},h({src:k[1],width:l,height:l,style:{marginLeft:n}}))));},renderThree:function(k){var l=this.props.size,m=Math.floor(l/3*2),n=-Math.floor((l-m)/2),o=Math.floor(l/2),p=l-m,q=-Math.floor((o-p)/2),r=(("_55lu")+(this.props.border?' '+"_57pl":'')),s=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.DOM.div(null,g.DOM.div({className:r,style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:s,style:{width:p,height:o}},h({src:k[1],width:o,height:o,style:{marginLeft:q}})),g.DOM.div({className:"_55lu",style:{width:p,height:o}},h({src:k[2],width:o,height:o,style:{marginLeft:q}}))));}});e.exports=j;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=9,q=l.createClass({displayName:'ChatSidebarItem',propTypes:{birthday:l.PropTypes.bool,context:l.PropTypes.string,detailedStatus:l.PropTypes.string,href:l.PropTypes.object,imageSize:l.PropTypes.number,name:l.PropTypes.string,onClick:l.PropTypes.func,status:l.PropTypes.number,statusTime:l.PropTypes.string,unreadCount:l.PropTypes.number},render:function(){var r=(("_55ln")+(this.props.context?' '+"_55lo":'')+(this.props.unreadCount?' '+"_5bom":''));return (k({className:r,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},l.DOM.div({className:"_55lp"},l.DOM.div({className:"_56p9"},this.renderImage(),l.DOM.div({className:"_568w"})),l.DOM.div({className:"_5bon"},this.renderBirthday(),this.renderUnreadCount(),this.renderStatus()),l.DOM.div({className:"_55lr"},this.props.name),l.DOM.div({className:"_55ls"},this.props.context))));},renderImage:function(){var r=this.props.imageSize||i.IMAGE_SIZE;return m({size:r,srcs:this.props.images});},renderUnreadCount:function(){var r=this.props.unreadCount;if(!r)return null;var s=(("_5boo")+(r>p?' '+"_5bop":''));if(r>p)r=p+'+';return (l.DOM.div({className:s},r));},renderStatus:function(){var r=this.getStatusSrc();if(!r&&!this.props.statusTime)return null;var s=r?j({className:"_568_",src:r}):null;return (l.DOM.div({className:"_568z"},l.DOM.div({className:"_568-"},this.props.statusTime),this.renderDetailedPresence(),s));},renderDetailedPresence:function(){if(this.props.unreadCount)return null;return (l.DOM.div({className:"_5t35"},this.props.detailedStatus));},renderBirthday:function(){if(!this.props.birthday)return null;var r=o('/images/gifts/icons/cake_icon.png');if(h.get('gray_cake'))r=o('/images/chat/sidebar/livebar/divebar_cake.png');return (j({className:"_5dv3",src:r}));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:return o('/images/litestand_classic/sidebar/online.png');case g.MOBILE:if(h.get('sidebar_remove_mobile_icon'))return null;return o('/images/litestand_classic/sidebar/pushable.png');}return null;}});e.exports=q;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f,g){var h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("ChatSidebarUser.react",["ChatOpenTab","ChatSidebarItem.react","WebMessengerPermalinkConstants","React"],function(a,b,c,d,e,f,g,h,i,j){var k=j.createClass({displayName:'ChatSidebarUser',propTypes:{birthday:j.PropTypes.bool,detailedStatus:j.PropTypes.string,image:j.PropTypes.string,imageSize:j.PropTypes.number,name:j.PropTypes.string,sectionName:j.PropTypes.string.isRequired,slot:j.PropTypes.number,status:j.PropTypes.number,statusTime:j.PropTypes.string,unreadCount:j.PropTypes.number,userID:j.PropTypes.string.isRequired},_openTab:function(event){g.openUserTab(this.props.userID,this.props.sectionName,{global_slot:this.props.slot});return event.preventDefault();},render:function(){var l=i.getURIPathForIDOrVanity(this.props.userID);return (h({onClick:this._openTab,href:{url:l},imageSize:this.props.imageSize,images:this.props.image,name:this.props.name,status:this.props.status,birthday:this.props.birthday,statusTime:this.props.statusTime,detailedStatus:this.props.detailedStatus,context:this.props.context,unreadCount:this.props.unreadCount}));}});e.exports=k;});
__d("ChatSidebarUserGroup.react",["AvailableList","AvailableListConstants","ChannelConnection","ChatContexts","ChatSidebarSections","ChatSidebarUser.react","ChatUnreadCount","LastMobileActiveTimes","PresencePrivacy","PresenceStatus","React","ShortProfiles","SubscriptionsHandler","cx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=Object.keys(k).map(function(x){return k[x];}),w=q.createClass({displayName:'ChatSidebarUserGroup',propTypes:{ids:q.PropTypes.array.isRequired,sectionName:q.PropTypes.oneOf(v).isRequired},getInitialState:function(){return {userData:[],unreadCounts:{}};},_updateUnreadCount:function(x){m.getUnreadCountForUID(x,function(y){this.state.unreadCounts[x]=y;this.setState({unreadCounts:this.state.unreadCounts});}.bind(this));},componentWillMount:function(){this.componentWillReceiveProps(this.props);this._subscriptions=new s();this._subscriptions.addSubscriptions(g.subscribe(h.ON_AVAILABILITY_CHANGED,u(this.forceUpdate,this)),o.subscribe('privacy-changed',u(this.forceUpdate,this)),i.subscribe([i.CONNECTED,i.RECONNECTING,i.SHUTDOWN,i.MUTE_WARNING,i.UNMUTE_WARNING],u(this.forceUpdate,this)));},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(x){r.getMulti(x.ids,function(y){var z=x.ids.map(function(aa){return y[aa];});this.setState({userData:z});}.bind(this));},_renderProfile:function(x,y){if(x.id===0)return null;var z=p.get(x.id),aa=(z!==h.ACTIVE)?n.getShortDisplay(x.id):null,ba=(z===h.ACTIVE)?p.getDetailedActivePresence(x.id):null,ca=i.disconnected()||!o.allows(x.id),da=j.getShortDisplay(x.id);return (q.DOM.li({className:(("_42fz")+(da?' '+"_52zj":'')+(ca?' '+"_570-":'')),'data-id':x.id,key:x.id},l({birthday:p.isBirthday(x.id),context:da,detailedStatus:ba,image:x.thumbSrc,imageSize:this.props.imageSize,name:x.name,sectionName:this.props.sectionName,slot:y,status:z,statusTime:aa,unreadCount:this.state.unreadCounts[x.id],userID:x.id})));},render:function(){return this.transferPropsTo(q.DOM.ul(null,this.state.userData.map(this._renderProfile)));}});e.exports=w;});
__d("ChatSidebarOrderedList.react",["Animation","AsyncDialog","AsyncRequest","ChatQuietLinks","ChatSidebarConstants","ChatSidebarSections","ChatSidebarUserGroup.react","PresencePrivacy","React","URI","cx","shield","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=o.createClass({displayName:'ChatSidebarOrderedList',propTypes:{topUsers:o.PropTypes.array.isRequired,availableUsers:o.PropTypes.array.isRequired,isSidebar:o.PropTypes.bool.isRequired,scrollContainer:o.PropTypes.object},getInitialState:function(){return {mouseOver:true,pauseRendering:false};},shouldComponentUpdate:function(u,v){return !v.mouseOver&&!v.pauseRendering;},componentDidMount:function(){j.nukeLinks(this.getDOMNode());},_scrollToSeparator:function(){if(!this.props.scrollContainer)return;var u=this.refs.usersSeparator.getDOMNode(),v=this.props.scrollContainer.scrollHeight,w=this.props.scrollContainer.clientHeight,x=this.props.scrollContainer.scrollTop,y=Math.min(u.offsetTop,v-w);if(x!==y){var z=Math.abs(y-x)/this.props.scrollContainer.clientHeight*500;new g(this.props.scrollContainer).to('scrollTop',y).ease(g.ease.end).duration(z).go();}},_openBlackbirdSettings:function(){var u=new p('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});h.send(new i(u));},_renderOfflineSection:function(){var u=k.getImageSize(this.props.isSidebar),v=this.props.topUsers.filter(function(x){return !n.allows(x);});v.splice(-2);var w=(o.DOM.a({href:"#",onClick:this._openBlackbirdSettings},"Edit"));return [o.DOM.div({key:"users_separator1",className:"_554m"},o.DOM.div({className:"_554o"},o.DOM.div({className:"_554n"},o.DOM.span({className:"_554p"},"MORE FRIENDS"),o.DOM.div({className:"_554q"},o.DOM.span({className:"_554r"}))))),o.DOM.div({key:"users_separator2",className:"_554m blackbirdWhitelist"},o.DOM.div({className:"_554o"},o.DOM.div({className:"_554n"},o.DOM.div({className:"_5v-d"},o.DOM.span({className:"_554t"},s._("These friends can't see you on chat. {=link}",{'=link':w})))))),m({key:l.OFFLINE_USERS,sectionName:l.OFFLINE_USERS,ids:v,imageSize:u})];},_renderOnlineSection:function(){if(this.props.availableUsers.length===0)return null;var u=k.getImageSize(this.props.isSidebar);return [o.DOM.div({key:"users_separator",ref:"usersSeparator",onClick:this._scrollToSeparator,className:"_554m moreOnlineFriends"},o.DOM.div({className:"_554o"},o.DOM.div({className:"_554n"},o.DOM.span({className:"_554p"},s._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':"MORE FRIENDS",'=count':this.props.availableUsers.length})),o.DOM.div({className:"_554q"},o.DOM.span({className:"_554r"}))))),m({key:l.MORE_ONLINE_FRIENDS,sectionName:l.MORE_ONLINE_FRIENDS,ids:this.props.availableUsers,imageSize:u})];},render:function(){var u=k.getImageSize(this.props.isSidebar),v=this.props.topUsers;if(n.getVisibility()==n.ONLINE)v=this.props.topUsers.filter(function(x){return n.allows(x);});var w=(n.getOnlinePolicy()==n.ONLINE_TO_WHITELIST&&n.getVisibility())?this._renderOfflineSection():this._renderOnlineSection();return this.transferPropsTo(o.DOM.li({onMouseEnter:r(this.setState,this,{mouseOver:true}),onMouseLeave:r(this.setState,this,{mouseOver:false})},m({key:l.ORDERED_LIST,sectionName:l.ORDERED_LIST,ids:v,imageSize:u}),w));}});e.exports=t;});
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","WorkModeConfig","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k){var l=[],m={},n=[],o={contains:function(p){return p in m;},getList:function(){if(k.is_work_mode_enabled)return i(l);if(h.get('chat_web_ranking_with_presence'))o.reRank();var p=i(l);p=p.filter(function(q){var r=j.getNowUnsafe(q);return !r||r.type=="friend";});return p;},getRank:function(p){return p in m?m[p]:l.length;},reRank:function(){var p={},q={};n.forEach(function(s,t){var u=s.substr(0,s.length-2),v=s.substring(s.length-1);if(typeof(q.uid)=='undefined'){if(typeof(p.uid)=='undefined')p[u]=g.get(u);var w=p[u];if(w==v)q[t]=u;}});l=[];for(var r in q)l.push(q[r]);l.forEach(function(s,t){m[s]=t;});}};(function(){var p=b('InitialChatFriendsList');l=p.list.length?p.list:[];if(h.get('chat_web_ranking_with_presence')&&!k.is_work_mode_enabled){n=l.slice();o.reRank();}l.forEach(function(q,r){m[q]=r;});})();e.exports=a.OrderedFriendsList||o;});
__d("ChatSortUsers",["AvailableListConstants","OrderedFriendsList","PresencePrivacy","PresenceStatus","ShortProfiles","TokenizeUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(q,r){var s=i.allows(q),t=i.allows(r);if(s!==t)return s?-1:1;return 0;}var n={};function o(q){if(n[q])return n[q];var r=(k.getNowUnsafe(q)||{}).name;if(r)return n[q]=l.flatten(r);return '~';}var p={sortAlphabetical:function(q,r){var s=o(q),t=o(r);if(s!==t)return s<t?-1:1;return 0;},sortMobile:function(q,r){var s=j.get(q)===g.MOBILE,t=j.get(r)===g.MOBILE;if(s!==t)return t?-1:1;return p.sortAlphabetical(q,r);},sortCoefficient:function(q,r){var s=h.getRank(q),t=h.getRank(r);if(s!==t)return s-t;return p.sortAlphabetical(q,r);},sort:function(q,r){var s=m(q,r);if(s!==0)return s;return p.sortCoefficient(q,r);}};e.exports=p;});
__d("ChatTypeaheadCore",["Event","Keys","TypeaheadCore","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in i)if(i.hasOwnProperty(m))o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(){"use strict";if(i!==null)i.apply(this,arguments);}o.prototype.init=function(p,q,r){"use strict";n.init.call(this,p,q,r);this.informBeginActive=false;this.informEndActive=false;this.data.subscribe('respond',function(){if(this.informBeginActive){this.informBeginActive=false;this.inform('sidebar/typeahead/active',true);}else if(this.informEndActive){this.informEndActive=false;this.inform('sidebar/typeahead/active',false);}}.bind(this));};o.prototype.keydown=function(event){"use strict";this.data.fetchAll();var p=g.getKeyCode(event);if(p===h.ESC){setTimeout(l(this.reset,this),0);if(!this.getValue()){this.element.blur();this.inform('escape');}return event.kill();}return n.keydown.call(this,event);};o.prototype.checkValue=function(){"use strict";var p=this.getValue(),q=this.value;if(p==q)return;if(q&&!p){this.typeaheadActive=false;this.informEndActive=true;}else if(!q&&p){this.typeaheadActive=true;this.informBeginActive=true;this.inform('sidebar/typeahead/preActive');}n.checkValue.call(this);};j(o.prototype,{handleTab:k});e.exports=o;});
__d("ChatTypeaheadDataSource",["ChatSortUsers","CurrentUser","DataSource","JSLogger","MercuryParticipantTypes","Run","ShortProfiles"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in i)if(i.hasOwnProperty(n))p[n]=i[n];var o=i===null?null:i.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=i;function p(q){"use strict";q=q||{};q.kanaNormalization=true;i.call(this,q);this.persistOnRefresh=q.persistOnRefresh!==false;this.showOfflineUsers=!!q.showOfflineUsers;this._jslog=j.create('chat_typeahead');this._jslog.log('created');}p.prototype.init=function(){"use strict";this._jslog.log('init');o.init.call(this);this._update();};p.prototype.bootstrap=function(){"use strict";this._jslog.log('bootstrap');o.bootstrap.call(this);if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(m.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');m.fetchAll();this.inform('activity',{activity:true});var q=m.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)l.onLeave(function(){m.unsubscribe(q);});}}};p.prototype.fetchAll=function(){"use strict";m.fetchAll();};p.prototype._update=function(){"use strict";d(['AvailableList'],function(q){var r=this.value;this.dirty();var s=m.getCachedProfileIDs(),t=s.filter(function(v){var w=m.getNow(v);return w.type===k.FRIEND;});t.sort(g.sort);var u=[];t.forEach(function(v){if(v==h.getID())return;var w=q.get(v);if(!this.showOfflineUsers&&w!==q.ACTIVE)return;var x=m.getNow(v),y=x.additionalName;if(x.hasOwnProperty('searchTokens'))y=y?y+' '+x.searchTokens.join(' '):x.searchTokens.join(' ');u.push({uid:v,text:x.name,tokens:y,localized_text:x.name,additional_text:x.additionalName,photo:x.thumbSrc,type:x.type});}.bind(this));if(u.length)this.addEntries(u);this.value=r;if(r)this.query(r);}.bind(this));};p.prototype.refreshData=function(){"use strict";this.fetchAll();d(['AvailableList'],function(q){q.update();}.bind(this));};e.exports=p;});
__d("ChatSidebarHeader.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:'ReactChatSidebarHeader',render:function(){return this.transferPropsTo(g.DOM.div({className:"_55ob"},g.DOM.div({className:"_55oc"},this.props.children)));}});e.exports=i;});
__d("MercuryErrorInfo",["MercuryActionStatus","MercuryErrorType","tx"],function(a,b,c,d,e,f,g,h,i){var j={getMessage:function(k){var l="This message failed to send.";if(j.isConnectionError(k)){l="Unable to connect to Facebook. This message failed to send. ";}else if(k.description)l=k.description;return l;},isConnectionError:function(k){if(k&&k.type==h.TRANSPORT)return k.code===1001||k.code===1004||k.code===1006;return false;},isTransient:function(k){return k&&k.is_transient;},isPermanent:function(k){return k?!this.isTransient(k):false;},hasErrorStatus:function(k){return k.status===g.FAILED_UNKNOWN_REASON||k.status===g.UNABLE_TO_CONFIRM||k.status===g.ERROR;}};e.exports=j;});
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={renderParticipantListWithNoThreadName:function(u,v,w,x,y,z){var aa={callback:true,check_length:true,show_unread_count:true};z=z||{};var ba={};for(var ca in z)if(aa[ca]){ba[ca]=z[ca];delete z[ca];}var da=w.map(function(ia){return x[ia];}),ea=this.renderRawParticipantList(u,da,w.length,z);ea=this.renderRawTitleWithUnreadCount(ea,ba.show_unread_count?v.unread_count:0);var fa=z.abbr_mode,ga={};for(var ha in z)ga[ha]=z[ha];ga.abbr_mode=true;y.forEach(function(ia){var ja=y.length>1?this._cloneIfDOMElement(ea):ea;i.setContent(ia,ja);if(ba.check_length&&!fa&&ia.scrollWidth>ia.clientWidth){var ka=this.renderRawParticipantList(u,da,w.length,ga),la=this.renderRawTitleWithUnreadCount(ka,ba.show_unread_count?v.unread_count:0);i.setContent(ia,la);}}.bind(this));ba.callback&&ba.callback(ea);},renderRawParticipantList:function(u,v,w,x){var y={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};x=x||{};var z=null;if(x.names_renderer){z=x.names_renderer(v);}else z=v.map(function(ca){return ca.name;});var aa=null;if(z.length===0){if(!u){aa="New Message";}else aa="No Participants";}else if(z.length==1){aa=z[0];}else if(z.length==2){var ba={participant1:z[0],participant2:z[1]};if(x.last_separator_uses_and){aa=r._("{participant1} and {participant2}",ba);}else aa=r._("{participant1}, {participant2}",ba);}else if(x.last_separator_uses_and){if(x.abbr_mode){aa=r._("{participant1} and {others_link}",{participant1:z[0],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-1})});}else if(z.length==3){aa=r._("{participant1}, {participant2} and {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2} and {others_link}",{participant1:z[0],participant2:z[1],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-2})});}else if(z.length==3){aa=r._("{participant1}, {participant2}, {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:z[0],participant2:z[1],participant3:z[2],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-3})});if(Array.isArray(aa))aa=i.create('span',{},aa);return aa;},renderRawTitleWithUnreadCount:function(u,v){var w=u;if(v&&v>1)w=i.create('span',{},r._("{conversation_title} ({unread_count})",{conversation_title:u,unread_count:v}));return w;},renderRawParticipantCount:function(u,v){var w=v.render_subset,x;if(!w){x=v.count>1?r._("{num} people",{num:v.count}):"1 person";}else x=v.count>1?r._("{others_count} others",{others_count:v.count}):"1 other";return x;},renderShortNames:function(u){if(u.length==1)return [u[0].name];return u.map(function(v){return v.short_name;});},getUserCanonicalWebMessengerURL:function(u,v,w){var x=new o().setSubdomain('www'),y=u.substr(u.indexOf(':')+1);x.setPath(t(w)+'/'+y);v&&v(x.toString());return x.toString();},getWebMessengerURLWithServerID:function(u,v,w){var x=new o().setSubdomain('www');x.setPath(p.getURIPathForThreadID(u,t(w)));v&&v(x.toString());return x.toString();},renderUserCanonicalWebMessengerLink:function(u,v,w,x){var y=this.getUserCanonicalWebMessengerURL(u,null,x);v.setAttribute('href',y);w&&w();},renderWebMessengerLinkWithServerID:function(u,v,w,x){var y=this.getWebMessengerURLWithServerID(u,null,x);v.setAttribute('href',y);w&&w();},renderStatusIndicator:function(u,v,w){var x;if(u==j.RESENDING){x=this.renderResendIndicator();}else if(u!==undefined&&u!=j.UNSENT&&u!=j.UNCONFIRMED&&u!=j.SUCCESS)x=this.renderErrorIndicator(v,w);return x;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(u,v){if(!u)return null;var w=m[':fb:mercury:error-indicator'].render(),x=u.is_transient,y=k.getMessage(u);if(x)if(k.isConnectionError(u)){y=r._("{message} Check your network connection or click to try again.",{message:y});}else y=r._("{message} Click to send again.",{message:y});n.set(w,y,'above','center');if(v&&x){g.listen(w,'click',v);w.setAttribute('tabindex','0');h.addClass(w,"_55q-");}return w;},_cloneIfDOMElement:function(u){if(u&&u.cloneNode){return u.cloneNode();}else return u;}};function t(u){var v=p.BASE_PATH;if(u&&u!=l.INBOX)v+='/'+u;return v;}e.exports=s;});
__d("ChatSidebarThread.react",["ChatSidebarItem.react","DOM","WebMessengerPermalinkConstants","React","MercuryThreadMetadataRawRenderer","Tooltip","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'ChatSidebarThread',getInitialState:function(){return {maxNumParticipantsToRender:10};},propTypes:{image:j.PropTypes.string,imageSize:j.PropTypes.number,name:j.PropTypes.string,participants:j.PropTypes.array,numOtherParticipants:j.PropTypes.number,status:j.PropTypes.number,threadID:j.PropTypes.string,unreadCount:j.PropTypes.number},_renderParticipants:function(){var q=[],r=this.props.participants.length,s=this.props.numOtherParticipants,t=Math.min(this.state.maxNumParticipantsToRender,r);if(s-t==1)t--;for(var u=0;u<t;u++){var v=h.create('li');h.setContent(v,this.props.participants[u].name);q.push(v);}if(t<s){v=h.create('li');h.setContent(v,m._("and {num} more...",[m.param("num",s-t)]));q.push(v);}return h.create('ul',{},q);},componentDidMount:function(){l.set(this.getDOMNode(),this._renderParticipants());},render:function(){var q=this.props.name,r=o(this.props.threadID,this.props.participants,this.props.numOtherParticipants),s=q?r:undefined,t=i.getURIPathForThreadID(this.props.threadID),u=p(this.props.image,this.props.participants),v=q?q:r;return (g({context:s,href:{url:t},imageSize:this.props.imageSize,images:u,name:v,status:this.props.status,unreadCount:this.props.unreadCount}));}});function o(q,r,s){return k.renderRawParticipantList(q,r,s,{names_renderer:k.renderShortNames});}function p(q,r){if(q)return q;return r.map(function(s){return s.image_src;});}e.exports=n;});
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',HEADER_TYPE:'header'};e.exports=g;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","ChatSidebarConstants","ChatSidebarHeader.react","ChatSidebarSections","ChatSidebarThread.react","ChatSidebarUser.react","ChatTypeaheadConstants","DOM","LastMobileActiveTimes","MercuryParticipants","PresenceStatus","React"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={};function t(y,z){if(!(y in s))s[y]=n.create('li');r.renderComponent(z,s[y]);return s[y];}function u(y){return t(y.text,i(null,y.text));}function v(y){var z=y.mercury_thread.participants.map(function(aa){return p.getUserID(aa);});return t(y.uid,k({image:y.mercury_thread.image_src,imageSize:h.getImageSize(),name:y.mercury_thread.name,participants:y.participants_to_render,numOtherParticipants:z.length-1,status:q.getGroup(z),threadID:y.uid}));}function w(y){var z=q.get(y.uid),aa=(z===g.MOBILE)?o.getShortDisplay(y.uid):null,ba=(y.render_type==m.NON_FRIEND_TYPE||y.render_type==m.FB4C_TYPE)?y.subtext:null,ca=null;if(z===g.ACTIVE)ca=q.getDetailedActivePresence(y.uid);return t(y.uid,l({image:y.photo,imageSize:h.getImageSize(),name:y.text,sectionName:j.TYPEAHEAD,status:z,birthday:q.isBirthday(y.uid),statusTime:aa,detailedStatus:ca,userID:y.uid,context:ba}));}function x(y,z){if(y.type===m.HEADER_TYPE)return u(y);if(y.type==m.THREAD_TYPE)return v(y);return w(y);}e.exports=x;});
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f,g,h){var i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('\\b'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;});
__d("ChatTypeaheadView",["BucketedTypeaheadView","ChatConfig","ChatTypeaheadConstants","CurrentUser","MercuryThreadSearchUtils","WorkModeConfig","arrayContains","fbt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=h.get('divebar_typeahead_group_fof',0);for(var q in g)if(g.hasOwnProperty(q))s[q]=g[q];var r=g===null?null:g.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=g;function s(t,u){"use strict";g.call(this,t,u);this.typeObjects={};this.typeObjectsOrder=[];this.typeObjects[i.NON_FRIEND_TYPE]={uid:i.NON_FRIEND_TYPE,type:i.HEADER_TYPE,text:"FRIENDS OF FRIENDS"};this.typeObjectsOrder.push(i.NON_FRIEND_TYPE);this.typeObjects[i.THREAD_TYPE]={uid:i.THREAD_TYPE,type:i.HEADER_TYPE,text:"GROUP CONVERSATIONS"};this.typeObjectsOrder.push(i.THREAD_TYPE);this.typeObjects[i.FB4C_TYPE]={uid:i.FB4C_TYPE,type:i.HEADER_TYPE,text:"CO-WORKERS"};this.typeObjects[i.FRIEND_TYPE]={disabled:true,uid:i.FRIEND_TYPE,type:i.HEADER_TYPE,text:"FRIENDS"};if(l.is_work_mode_enabled){this.typeObjectsOrder.push(i.FRIEND_TYPE);this.typeObjectsOrder.push(i.FB4C_TYPE);}else{this.typeObjectsOrder.push(i.FB4C_TYPE);this.typeObjectsOrder.push(i.FRIEND_TYPE);}}s.prototype.buildBuckets=function(t,u){"use strict";if(p){u=u.reverse();u=u.filter(function(v){var w=v.render_type||v.type;if(w==='thread'){var x='fbid:'+j.getID();if(!m(v.mercury_thread.participants,x))return false;var y=v.participants_to_render.some(function(aa){return k.queryMatchesName(t,aa.name);}),z=k.queryMatchesName(t,v.mercury_thread.name);if(!y&&!z)return false;}return true;});}u=r.buildBuckets.call(this,t,u);if(!p)u=u.filter(function(v){return v&&!v.disabled;});return u;};s.prototype.getDefaultIndex=function(t){"use strict";if(!p)return r.getDefaultIndex.call(this,t);if(t.length===0)return -1;var u=t.length-1;while(!this.isHighlightable(t[u])&&u>=0)u--;return u;};e.exports=s;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;});
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;});
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","AsyncSignal","ChatConfig","ChatImpressionLogger","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","Env","Event","JSLogger","JSXDOM","KeyEventController","LitestandClassicPlaceHolders","OrderedFriendsList","Parent","PresencePrivacy","ScrollableArea","SidebarFitWindowHeight","Style","UserAgent","ViewportBounds","copyProperties","createArrayFrom","csx","cx","debounce","emptyFunction","ge","ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","ChatTypeaheadView","Typeahead"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('ChatTypeaheadView');b('Typeahead');var ma,na=false,oa=false,pa=false,qa=false,ra=false,sa=false,ta,ua,va,wa,xa,ya=null,za,ab,bb=t.create('chat_sidebar');function cb(){o.removeClass(document.documentElement,'sidebarMode');if(!qa||!lb.isVisible()){g.inform('reflow');return;}pa=false;ya=null;ta.hide();wa.getCore().reset();o.hide(ua);bb.rate('sidebar_hide',qa);lb.inform('sidebar/hide',lb);g.inform('sidebar/hide',lb);g.inform('reflow');}function db(){var mb=lb.shouldShowSidebar();o.conditionClass(document.documentElement,'sidebarCapable',mb);if(lb.isEnabled()&&mb){gb();var nb=ga(ua.childNodes),ob=fb(nb),pb=ta.getItemHeight(),qb=8,rb=Math.floor((ob-qb)/pb);ca.set(ma,'height',ob+'px');ta.setNumTopFriends(rb);var sb=Math.floor((ob-qb)/pb);if(ib())sb=(sb-2)>0?sb-2:0;wa.getData().setMaxResults(sb);lb.inform('sidebar/resized',lb);g.inform('sidebar/resized',lb);g.inform('reflow');}else cb();if(!qa){kb();qa=true;}ya=null;}function eb(){if(wa&&lb.isVisible())wa.getCore().getElement().focus();}function fb(mb){if(!mb)mb=ga(ua.childNodes);var nb=xa.height;mb.forEach(function(ob){if(ob&&ob!==ma)nb-=q.getElementDimensions(ob).height;});if(za)nb-=za.getOffset();return Math.max(0,nb);}function gb(){if(lb.isVisible())return;pa=true;ya=null;o.show(ua);o.addClass(document.documentElement,'sidebarMode');ta.show();bb.rate('sidebar_show',qa);lb.inform('sidebar/show',lb);g.inform('sidebar/show',lb);w.destroy('sidebar');}function hb(){m.setSetting('sidebar_mode',lb.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(ka).setErrorHandler(ka).setData({sidebar_mode:lb.isEnabled()}).setAllowCrossPageTransition(true).send();}function ib(){return k.get('divebar_typeahead_group_fof',0);}function jb(){return x.getList().length<=k.get('sidebar.min_friends');}function kb(){var mb=true;if(!lb.isEnabled()){bb.log('state_not_enabled');mb=false;}if(!lb.isViewportCapable()){bb.log('state_not_shown_viewport');mb=false;}if(oa){bb.log('state_not_shown_hidden');mb=false;}if(jb()){bb.log('state_not_shown_num_friends');mb=false;}bb.log(mb?'state_shown':'state_not_shown');}var lb={init:function(mb,nb,ob,pb){lb.init=ka;ra=true;ua=mb;ta=nb;wa=ob;va=pb;ma=p.find(mb,'div.fbChatSidebarBody');s.listen(window,'resize',db);v.registerKey('q',function(event){if(pa){var tb=null;if(ab){tb=p.scry(ab,'.inputsearch')[0];}else tb=p.scry(mb,'.inputsearch')[0];if(tb){tb.focus();event.prevent();}}});var qb=new n(mb);qb.subscribe('updated',db);g.subscribe('sidebar/invalidate',db);nb.setScrollContainer(y.byClass(nb.getRoot(),'uiScrollableAreaWrap'));nb.subscribe(['render','show','hide'],ja(function(tb){if(tb==='render'&&!sa){sa=true;lb.inform('sidebar/chatRendered',null,g.BEHAVIOR_PERSISTENT);}var ub=nb.getRoot(),vb=aa.getInstance(ub);vb&&vb.adjustGripper();}));g.subscribe('chat/option-changed',function(tb,ub){if(ub.name=="sidebar_mode"){na=!!m.getSetting('sidebar_mode');db();}});ob.getCore().subscribe('sidebar/typeahead/active',lb.updateOnActiveTypeahead);ob.subscribe('reset',function(){if(!ob.getCore().getValue()&&!ta.isVisible())lb.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(tb,ub){s.listen(ub.getButton(),'click',function(event){var vb=oa;oa=false;lb.enable();var wb=lb.shouldShowSidebar();oa=vb&&!wb;return !wb;});});na=!!m.getSetting('sidebar_mode');z.subscribe('privacy-user-presence-changed',db);db();l.init(ta);ea.addRight(lb.getVisibleWidth);lb.inform('sidebar/initialized',lb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',lb,g.BEHAVIOR_PERSISTENT);if(k.get('sidebar_below_bluebar')){var rb=p.find(mb,"._5qqe");za=new ba(rb);za.subscribe('resized',db);}if(k.get('chat_sidebar_load_log')){var sb={loaded:true,session_token:pb.session_token,buddylist_short:k.get('buddylist_short_group'),bootloader_retry:r.bootloader_retry_on_timeout};new j('/ajax/chat/sidebar_load_log.php',sb).send();}},updateOnActiveTypeahead:function(mb,nb){if(!pa)return;if(nb){ta.hide();}else{ta.show();db();}},isInitialized:function(){return qa;},disable:function(){if(!lb.isEnabled())return;na=false;hb();cb();},enable:function(){if(lb.isEnabled())return;na=true;hb();db();setTimeout(eb,0);},forceEnsureLoaded:function(){if(ra)return;if(la('pagelet_sidebar'))return;d(['UIPagelet'],function(mb){var nb=u.div({id:"pagelet_sidebar"});p.appendContent(document.body,nb);mb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});ra=true;},ensureLoaded:function(){if(!na)return;lb.forceEnsureLoaded();},hide:function(){if(oa)return;oa=true;cb();},unhide:function(){if(!oa)return;oa=false;db();},getBody:function(){return ma;},getRoot:function(){return ua;},getVisibleWidth:function(){if(!pa||!ua)return 0;if(ya===null)ya=ua.offsetWidth;return ya;},isEnabled:function(){return na;},isViewportCapable:function(){xa=q.getViewportWithoutScrollbarDimensions();var mb=k.get('sidebar.minimum_width');return xa.width>mb;},shouldShowSidebar:function(){var mb=lb.isViewportCapable();return mb&&!oa&&!jb();},isVisible:function(){return pa;},resize:db,toggle:function(){lb.isEnabled()?lb.disable():lb.enable();}};fa(lb,h);e.exports=lb;});
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("ActiveXSupport",["UserAgent"],function(a,b,c,d,e,f,g){var h=null,i={isSupported:function(){if(h!==null)return h;try{if(g.ie()>=11){h=!!new ActiveXObject("htmlfile");}else h=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(j){h=false;}return h;}};e.exports=i;});
__d("VideoCallSupport",["MercuryConfig","UserAgent"],function(a,b,c,d,e,f,g,h){var i={newVCIsSupported:function(){return g.NewVCGK&&(h.chrome()>=24||h.firefox()>=22);}};e.exports=i;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","URI","tx"],function(a,b,c,d,e,f,g,h,i,j,k){var l={get:function(m,n){var o="Would you like to leave a message?",p="New Message";return new i().setTitle(k._("{firstname} is Unavailable",{firstname:n})).setBody(o).setButtons([{name:'record-message',label:p},i.CANCEL]).setHandler(function(){var q=j('/ajax/messaging/composer.php').setQueryData({ids:[m],autoloadvideo:true}).toString();g.send(new h(q));});}};e.exports=l;});
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","VideoCallSupport","emptyFunction","ge","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b('VideoCallTemplates');var w=[],x=[],y={isSupported:function(){if(t.newVCIsSupported())return true;if(s.windows()){if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.5)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ca=false;if(this.isSupported())if(z()){var da=null;try{da=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ca=!!da;}catch(ea){}da=null;}else{ca=aa();if(r.VideoCallingNoJavaGK)if(ca&&s.osx()>=10.8)if(ca.description&&ca.description.charAt(0)!='v')ca=false;}return ca;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ca){w.push(ca);m.loadModules(["VideoCallController"],u);},onRTCMessage:function(ca){if(t.newVCIsSupported()){x.push(ca);m.loadModules(["FBRTCCallController"],u);}},setMessageHandler:function(ca){this.onVideoMessage=ca;if(ca)while(w.length)ca(w.shift());},setRTCMessageHandler:function(ca){this.onRTCMessage=ca;if(ca)while(x.length)ca(x.shift());},availableForCall:function(ca){var da=k.get(ca);return da==l.ACTIVE||da==l.IDLE;},onProfileButtonClick:function(ca){y.startCallOrLeaveMessage(ca,'profile_button_click');},attachListenerToProfileButton:function(ca){var da=v('videoCallProfileButton');if(da){if(!y.isSupported()){p.hide(da);return;}g.listen(da,'click',function(event){y.startCallOrLeaveMessage(ca,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ca,da){if(this.availableForCall(ca)){y.showOutgoingCallDialog(ca,da);}else b('ShortProfiles').get(ca,function(ea){b('VideoCallRecordMessageDialog').get(ca,ea.firstName).show();});},showOutgoingCallDialog:function(ca,da){var ea=da||'unknown';y.logClick(ca,ea);var fa=y.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',ga='/ajax/chat/video/'+fa+'?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(ga).setHandler(u).setServerDialogCancelHandler(u)).show();},logClick:function(ca,da){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ca,clickSource:da}).setAllowCrossPageTransition(true).setErrorHandler(u).send();}};function z(){return s.ie()&&s.windows()&&!s.opera();}function aa(){if(!navigator)return null;navigator.plugins.refresh(false);var ca=navigator.mimeTypes['application/skypesdk-plugin'];return ca&&ca.enabledPlugin;}function ba(){if(!y.mightReloadPostInstall())return;var ca=o.get('vcpwn');if(ca){o.clear('vcpwn');var da=o.get('vctid');if(da){o.clear('vctid');if(o.get('vctid'))return;if(da&&y.isInstalled()){var ea='/ajax/chat/video/outgoing_dialog.php?idTarget='+da;new q().setAllowCrossPageTransition(true).setAsync(new j(ea)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ca,da){y.onVideoMessage(da.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ca,da){y.onRTCMessage(da.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ca,da){if(da.obj.event_name=="missed-call")m.loadModules(["VideoCallController"],function(ea){ea.onMissedCallEvent(da.obj);});});ba();e.exports=y;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreads').get();function s(){this._dialog=null;}function t(v){if(!(o.isSupported()&&i.get('video.show_promo')))return false;var w=r.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&o.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(q).send();}p(s.prototype,g);p(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=r.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=n[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(r.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;});
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryThreads').get();function o(){this._dialog=null;}m(o.prototype,g);m(o.prototype,{render:function(p,q){var r=n.getCanonicalUserInThread(q);if(!r||!k.availableForCall(r))return;var s=j[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});l.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.bind(null,y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.bind(null,y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.bind(null,y)),r.subscribe('dialog/close-all',u.bind(null,y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;});
__d("FileForm",["ArbiterMixin","AsyncRequest","AsyncResponse","AsyncUploadRequest","BehaviorsMixin","CurrentUser","DataStore","DOMQuery","Event","Form","JSONPTransport","Parent","URI","copyProperties","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(ca){var da={},ea=n.scry(ca,'input[type="file"]');ea.forEach(function(fa){da[fa.name]=fa.files;});return da;}function x(ca){var da=n.scry(ca,'input[type="file"]');da.forEach(function(ea){ea.files=null;});}var y=u(g,k);for(var z in y)if(y.hasOwnProperty(z))ba[z]=y[z];var aa=y===null?null:y.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=y;function ba(ca,da,ea){"use strict";if(ca.getAttribute('rel')==='async')throw new Error('FileForm cannot be used with Primer forms.');if(ca.getAttribute('method').toUpperCase()!=='POST')throw new Error('FileForm must be used with POST forms.');this._form=ca;this._previousEncoding=this._form.enctype;this._form.enctype=this._form.encoding='multipart/form-data';this._files=null;da&&this.enableBehaviors(da);this._options=ea||{};this.setAllowCrossOrigin(this._options.allowCrossOrigin);this.setUploadInParallel(this._options.uploadInParallel);this.setPreprocessHandler(this._options.preprocessHandler);this.setNetworkErrorRetryLimit(this._options.networkErrorRetryLimit);this._listeners=[o.listen(this._form,'submit',this._submit.bind(this)),o.listen(this._form,'click',this._click.bind(this))];m.set(this._form,'FileForm',this);}ba.prototype.getRoot=function(){"use strict";return this._form;};ba.prototype.setAllowCrossOrigin=function(ca){"use strict";this._allowCrossOrigin=!!ca;return this;};ba.prototype.setUploadInParallel=function(ca){"use strict";this._uploadInParallel=!!ca;return this;};ba.prototype.setPreprocessHandler=function(ca){"use strict";this._preprocessHandler=ca;return this;};ba.prototype.setNetworkErrorRetryLimit=function(ca){"use strict";this._retryLimit=ca;return this;};ba.prototype.setFiles=function(ca){"use strict";this._files=ca;return this;};ba.prototype._submit=function(event){"use strict";if(this.inform('submit')===false){event.prevent();return;}var ca='FormData' in window;if(ca)if(!s(this._form.action).isSameOrigin()&&!this._allowCrossOrigin)ca=false;return ca?this._sendViaXHR(event):this._sendViaFrame(event);};ba.prototype._click=function(event){"use strict";var ca=event.getTarget();while(n.isElementNode(ca)){if(ca.type==='submit'){this._clickTarget=ca;setTimeout(this._unclick.bind(this),0);break;}ca=ca.parentNode;}};ba.prototype._unclick=function(){"use strict";this._clickTarget=null;};ba.prototype._sendViaFrame=function(event){"use strict";var ca=this._request=new h();ca.setStatusElement(this._getStatusElement());ca.addStatusIndicator();ca.setOption('useIframeTransport',true);var da=ca.handleResponse.bind(ca),ea=new q('iframe',this._form.action,da),fa=ea.getTransportFrame(),ga=ea.getRequestURI().addQueryData({__iframe:true,__user:l.getID()});this._form.setAttribute('action',ga.toString());this._form.setAttribute('target',fa.name);ca.setJSONPTransport(ea);ca.setURI(ga);ca.setHandler(this.success.bind(this,null));ca.setErrorHandler(this.failure.bind(this,null));ca.setInitialHandler(v(this.initial,this,null));};ba.prototype._sendViaXHR=function(event){"use strict";var ca;if(this._uploadInParallel&&j.isSupported()){ca=new j().setPreprocessHandler(this._preprocessHandler).setData(p.serialize(this._form,this._clickTarget));ca.setNetworkErrorRetryLimit(this._retryLimit);if(this._files){ca.setFiles(this._files);}else ca.setFiles(w(this._form));var da=[ca.subscribe('progress',function(ea,fa){this.progress(fa,fa.getProgressEvent());}.bind(this)),ca.subscribe('initial',function(ea,fa){this.initial(fa,fa.getResponse());}.bind(this)),ca.subscribe('success',function(ea,fa){this.success(fa,fa.getResponse());}.bind(this)),ca.subscribe('start',function(ea,fa){this.inform('start',{upload:fa});}.bind(this)),ca.subscribe('failure',function(ea,fa){this.failure(fa,fa.getResponse());return false;}.bind(this)),ca.subscribe('complete',function(){while(da.length)da.pop().unsubscribe();})];}else ca=new h().setRawData(p.createFormData(this._form,this._clickTarget)).setHandler(this.success.bind(this,null)).setErrorHandler(this.failure.bind(this,null)).setUploadProgressHandler(this.progress.bind(this,null)).setInitialHandler(v(this.initial,this,null));ca.setAllowCrossOrigin(this._allowCrossOrigin).setRelativeTo(this._form).setStatusElement(this._getStatusElement()).setURI(this._form.action).send();this._request=ca;event.prevent();};ba.prototype.initial=function(ca){"use strict";return this.inform('initial',{upload:ca});};ba.prototype.success=function(ca,da){"use strict";var ea={response:da,upload:ca};if(this.inform('success',ea)!==false)o.fire(this._form,'success',ea);this._cleanup();};ba.prototype.failure=function(ca,da){"use strict";var ea={response:da,upload:ca};if(this.inform('failure',ea)!==false)if(o.fire(this._form,'error',ea)!==false)i.defaultErrorHandler(da);this._cleanup();};ba.prototype.progress=function(ca,event){"use strict";this.inform('progress',{event:event,upload:ca});};ba.prototype.abort=function(){"use strict";if(this._request){this._request.abort();this._cleanup();}};ba.prototype.clear=function(){"use strict";x(this._form);};ba.prototype.destroy=function(){"use strict";this._cleanup();while(this._listeners.length)this._listeners.pop().remove();this._listeners=null;this._form.enctype=this._form.encoding=this._previousEncoding;m.remove(this._form,'FileForm');};ba.prototype._cleanup=function(){"use strict";this._request=null;};ba.prototype._getStatusElement=function(){"use strict";return r.byClass(this._form,'stat_elem')||this._form;};ba.getInstance=function(ca){"use strict";return m.get(ca,'FileForm');};t(ba,{EVENTS:['start','submit','initial','progress','success','failure']});e.exports=ba;});
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;});
__d("submitForm",["DOM"],function(a,b,c,d,e,f,g){var h=function(i){var j=g.scry(i,'input[type="submit"]')[0];if(j){j.click();}else{j=g.create('input',{type:'submit',className:'hidden_elem'});g.appendContent(i,j);j.click();g.remove(j);}};e.exports=h;});
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._form=k;}j.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};j.prototype._submit=function(){"use strict";i(this._form.getRoot());};h(j.prototype,{_listener:null});e.exports=j;});
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield","startsWith","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=x(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(ga,ha,ia,ja){"use strict";this.$MercuryFileUploader0=ga;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7=new t();this.$MercuryFileUploader8=new l(ha,[o,m]);this.$MercuryFileUploader8.setAllowCrossOrigin(true);this.$MercuryFileUploader8.setUploadInParallel(true);var ka=j.find(ha,"._4q60"),la=j.find(ka,"._4q61");new n(ka,la,ia);h.hide(this.$MercuryFileUploader0);this.$MercuryFileUploader7.addSubscriptions(this.$MercuryFileUploader8.subscribe('submit',function(){var ma={count:0,file_sizes:[]};if(ia.files){for(var na=0;na<ia.files.length;na++)if(ia.files[na].size>r.AttachmentMaxSize){this.$MercuryFileUploader8.abort();this.$MercuryFileUploader8.clear();new i().setTitle("The file you have selected is too large").setBody("The file you have selected is too large. The maximum size is 25MB.").setButtons(i.OK).setSemiModal(true).show();return false;}var oa={};for(var pa=0;pa<ia.files.length;pa++){var qa=this.$MercuryFileUploader9();this.$MercuryFileUploadera(qa,ia.files[pa].name);ma.count++;ma.file_sizes.push(ia.files[pa].size);oa[qa]=ia.files[pa];}this.$MercuryFileUploader8.setFiles(oa);}else{ja.value=this.$MercuryFileUploader9();this.$MercuryFileUploadera(ja.value,ia.value);ma.count=1;}this.inform('submit',ma);}.bind(this)),this.$MercuryFileUploader8.subscribe('success',this.$MercuryFileUploaderb.bind(this)),this.$MercuryFileUploader8.subscribe('failure',this.$MercuryFileUploaderc.bind(this)),k.listen(la,'click',y(this.inform,this,'open')));}ea.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader4).length;};ea.prototype.addCachedAttachments=function(ga){"use strict";ga.forEach(function(ha){var ia=this.$MercuryFileUploader9();this.$MercuryFileUploadera(ia,ha.filename);this.$MercuryFileUploaderd(ia,ha);}.bind(this));};ea.prototype.addCachedImageFiles=function(ga){"use strict";var ha="Photo";ga.forEach(function(ia){var ja=this.$MercuryFileUploader9();this.$MercuryFileUploadera(ja,ha);this.$MercuryFileUploaderd(ja,{filename:ia,image_id:ia,filetype:'image/jpeg'});}.bind(this));};ea.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ea.prototype.getImageFiles=function(){"use strict";return w(this.$MercuryFileUploader2);};ea.prototype.getVideoFiles=function(){"use strict";return w(this.$MercuryFileUploader3);};ea.prototype.removeAttachments=function(){"use strict";w(this.$MercuryFileUploader5).forEach(function(ga){if(ga)j.remove(ga.getRoot());});this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader5={};this.$MercuryFileUploader4={};this.$MercuryFileUploader6={};h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ea.prototype.destroy=function(){"use strict";this.$MercuryFileUploader7&&this.$MercuryFileUploader7.release();this.$MercuryFileUploader8&&this.$MercuryFileUploader8.destroy();this.removeAttachments();};ea.prototype.$MercuryFileUploadera=function(ga,ha){"use strict";var ia=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader5[ga]=ia;this.$MercuryFileUploader4[ga]=true;this.$MercuryFileUploader6[ga]=Date.now();j.appendContent(ia.getNode('iconText'),fa(ha));k.listen(ia.getNode('closeFileUpload'),'click',this.$MercuryFileUploadere.bind(this,ga));j.appendContent(this.$MercuryFileUploader0,ia.getRoot());h.show(this.$MercuryFileUploader0);this.inform('dom-updated');};ea.prototype.$MercuryFileUploadere=function(ga,event){"use strict";if(this.$MercuryFileUploader4[ga]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ga]||this.$MercuryFileUploader2[ga]||this.$MercuryFileUploader3[ga])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ga];delete this.$MercuryFileUploader2[ga];delete this.$MercuryFileUploader3[ga];delete this.$MercuryFileUploader4[ga];delete this.$MercuryFileUploader6[ga];var ha=this.$MercuryFileUploader5[ga];delete this.$MercuryFileUploader5[ga];if(ha){j.remove(ha.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ea.prototype.$MercuryFileUploaderf=function(ga,ha){"use strict";var ia=this.$MercuryFileUploader5[ga],ja=p.getAttachIconClassByMime(ha);h.addClass(ia.getNode('iconText'),ja);h.addClass(ia.getRoot(),'done');};ea.prototype.$MercuryFileUploaderd=function(ga,ha){"use strict";if(this.$MercuryFileUploader4[ga]){delete this.$MercuryFileUploader4[ga];if(ha.image_id){this.$MercuryFileUploader2[ga]=ha.image_id;}else if(ha.video_id){this.$MercuryFileUploader3[ga]=ha.video_id;}else this.$MercuryFileUploader1[ga]=ha;this.$MercuryFileUploaderf(ga,ha.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader6[ga]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ea.prototype.$MercuryFileUploaderb=function(event,ga){"use strict";var ha=ga.response.getPayload();this.$MercuryFileUploaderd(this.$MercuryFileUploaderg(ga),ha.metadata[0]);};ea.prototype.$MercuryFileUploaderc=function(event,ga){"use strict";this.inform('one-upload-failed');this.$MercuryFileUploadere(this.$MercuryFileUploaderg(ga),event);};ea.prototype.$MercuryFileUploader9=function(){"use strict";return 'upload_'+s.getNewID();};ea.prototype.$MercuryFileUploaderg=function(ga){"use strict";var ha=ga.response.getPayload();if(ga.upload){return ga.upload.getName();}else return ha.uploadID;};function fa(ga){if(ga&&z(ga,'C:\\fakepath\\'))return ga.substring(12);return ga;}e.exports=ea;});
__d("ChatFileUploader.react",["InlineBlock.react","MercuryConfig","MercuryFileUploader","SubscriptionsHandler","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.createClass({displayName:'ChatFileUploader',propTypes:{attachmentsShelf:k.PropTypes.object,onFileUploaderMounted:k.PropTypes.func,onUploadFinished:k.PropTypes.func,onUpdateAttachmentsShelf:k.PropTypes.func,onSubmit:k.PropTypes.func},componentDidMount:function(){this._uploader=new i(this.props.attachmentsShelf,this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this._subscriptions=new j();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},shouldComponentUpdate:function(){return false;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (k.DOM.form({ref:"form",action:h.upload_url,method:"post"},k.DOM.input({type:"hidden",ref:"attachID",name:"attach_id"}),g({className:"_m _4q60 itemLabel"},k.DOM.input({type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),k.DOM.a({className:"_4q61 itemAnchor"},"Add Files..."))));},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){this.props.onSubmit();}});e.exports=n;});
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p,q,r){"use strict";var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString(),t=l(k.Constants.BROWSE_ALBUMS_PATH).addQueryData({browse_mode:k.BrowseModes.CHOOSE_CHAT_TARGET,browse_args:{thread_id:r}}).toString();o.setAttribute('ajaxify',t);p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){"use strict";var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){"use strict";this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){"use strict";if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;});
__d("XHRHttpError",[],function(a,b,c,d,e,f){var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};});
__d("xhrSimpleDataSerializer",[],function(a,b,c,d,e,f){function g(h){var i=[],j;for(j in h)i.push(encodeURIComponent(j)+'='+encodeURIComponent(h[j]));return i.join('&');}e.exports=g;});
__d("XHRRequest",["URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f,g,h,i,j,k){var l={errorCode:null,errorMsg:null,errorType:null},m={loadedBytes:null,totalBytes:null};function n(p){"use strict";this.setURI(p);this.setMethod('POST');this.setIsAsynchronous(true);this.setTransportBuilder(i);this.setDataSerializer(k);this.$XHRRequest0=this.$XHRRequest0.bind(this);}n.prototype.setURI=function(p){"use strict";this.$XHRRequest1=new g(p);return this;};n.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};n.prototype.setMethod=function(p){"use strict";this.$XHRRequest2=p;return this;};n.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};n.prototype.setData=function(p){"use strict";this.$XHRRequest3=p;return this;};n.prototype.getData=function(){"use strict";return this.$XHRRequest3;};n.prototype.setRawData=function(p){"use strict";this.$XHRRequest4=p;return this;};n.prototype.setRequestHeaderField=function(p,q){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[p]=q;return this;};n.prototype.setTimeout=function(p){"use strict";this.$XHRRequest6=p;return this;};n.prototype.setResponseHandler=function(p){"use strict";this.$XHRRequest7=p;return this;};n.prototype.setErrorHandler=function(p){"use strict";this.$XHRRequest8=p;return this;};n.prototype.setAbortHandler=function(p){"use strict";this.$XHRRequest9=p;return this;};n.prototype.setTimeoutHandler=function(p){"use strict";this.$XHRRequesta=p;return this;};n.prototype.setUploadProgressHandler=function(p){"use strict";this.$XHRRequestb=p;return this;};n.prototype.setIsAsynchronous=function(p){"use strict";this.$XHRRequestc=p;return this;};n.prototype.setTransportBuilder=function(p){"use strict";this.$XHRRequestd=p;return this;};n.prototype.setDataSerializer=function(p){"use strict";this.$XHRRequeste=p;return this;};n.prototype.send=function(){"use strict";var p=this.$XHRRequest6,q=this.$XHRRequestd(),r=this.getURI();this.$XHRRequestf=q;var s;j(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){r.addQueryData(this.$XHRRequest3);s=this.$XHRRequest4;}else s=this.$XHRRequeste(this.$XHRRequest3);q.onreadystatechange=this.$XHRRequest0;if(q.upload&&this.$XHRRequestb)q.upload.onprogress=this.$XHRRequestg.bind(this);if(p)this.$XHRRequesth=setTimeout(this.$XHRRequesta.bind(this),p);q.open(this.$XHRRequest2,r.toString(),this.$XHRRequestc);if(n.__inFlightRequests!==null){this.inFlight=true;n.__inFlightRequests.push(this);}if(this.$XHRRequest5)for(var t in this.$XHRRequest5)q.setRequestHeader(t,this.$XHRRequest5[t]);q.send(s);if(!this.$XHRRequestc)q.onreadystatechange(null,true);};n.prototype.abort=function(){"use strict";this.$XHRRequest9&&this.$XHRRequest9();this.$XHRRequestf&&this.$XHRRequestf.abort();this.$XHRRequesti();};n.prototype.$XHRRequesta=function(){"use strict";this.$XHRRequesta&&this.$XHRRequesta();this.$XHRRequesti();};n.prototype.$XHRRequest0=function(p,q){"use strict";if(!this.$XHRRequestc&&q!==true)return;var r=this.$XHRRequestf,s=r.readyState;if(s>=2){var t=s===4,u=this.getURI(),v=h.getErrorCode(u,r.status),w=this.$XHRRequest7;if(v!==null){if(t){l.errorCode=v;l.errorMsg=r.responseText;l.errorType='HTTP';this.$XHRRequest8&&this.$XHRRequest8(l);}}else if(w){var x=null;if(w.includeHeaders)x=r.getAllResponseHeaders();if(t||w.parseStreaming&&s===3)w(r.responseText,x,t);}if(t)this.$XHRRequesti();}};n.prototype.$XHRRequestg=function(p){"use strict";m.loadedBytes=p.loaded;m.totalBytes=p.total;this.$XHRRequestb&&this.$XHRRequestb(m);};n.prototype.$XHRRequesti=function(){"use strict";if(this.$XHRRequesth!==undefined){clearTimeout(this.$XHRRequesth);this.$XHRRequesth=undefined;}delete this.$XHRRequestf;if(n.__inFlightRequests!==null){this.inFlight=false;n.__inFlightRequests=n.__inFlightRequests.filter(o);}};n.__inFlightRequests=null;if(window.attachEvent){n.__inFlightRequests=[];window.attachEvent('onunload',function p(){for(var q=0,r=n.__inFlightRequests.length;q<r;q++){n.__inFlightRequests[q].abort();delete n.__inFlightRequests[q];}n.__inFlightRequests.length=0;});}function o(p){return p&&p.inFlight;}e.exports=n;});
__d("getCrossOriginTransport",["ex","invariant"],function(a,b,c,d,e,f,g,h){function i(){try{var k=new XMLHttpRequest();if(!('withCredentials' in k))k=new XDomainRequest();return k;}catch(j){throw new Error(g('getCrossOriginTransport: %s',j.message));}}i.withCredentials=function(){var j=i();h('withCredentials' in j);j.withCredentials=true;return j;};e.exports=i;});
__d("WebWorker",["BanzaiLogger","WebWorkerConfig","BlobFactory","Event","URI","Run","SubscriptionsHandler","XHRRequest","arrayContains","emptyFunction","getCrossOriginTransport","performanceNow","invariant","memoize","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=a.URL||a.webkitURL;function w(aa){"use strict";this.$WebWorker0=false;this.$WebWorker1=null;this.$WebWorker2('constructed');this.$WebWorker3=aa;this.$WebWorker4=null;this.$WebWorker5=p;this.$WebWorker6=p;this.$WebWorker7=[];this.$WebWorker8=false;this.$WebWorker9=new m();l.onLeave(function(){if(!this.$WebWorker8)this.terminate();}.bind(this));}w.prototype.setMessageHandler=function(aa){"use strict";this.$WebWorker5=aa||p;return this;};w.prototype.setErrorHandler=function(aa){"use strict";this.$WebWorker6=aa||p;return this;};w.prototype.postMessage=function(aa,ba){"use strict";s(!this.isCurrentState('constructed'));s(!this.isCurrentState('terminated'));if(this.isCurrentState('preparing')){this.$WebWorker7.push(this.postMessage.bind(this,aa,ba));return this;}var ca={type:'message',message:aa};if(ba){this.$WebWorker4.postMessage(ca,ba);}else this.$WebWorker4.postMessage(ca);return this;};w.prototype.terminate=function(){"use strict";if(this.isCurrentState('executing'))this.$WebWorker4.terminate();if(!this.isCurrentState('terminated')){this.$WebWorker2('terminated');this.$WebWorker4=null;this.$WebWorkera();this.$WebWorker7=[];}return this;};w.prototype.execute=function(){"use strict";s(!this.isCurrentState('terminated'));if(['preparing','executing'].some(this.isCurrentState,this))return this;this.$WebWorker2('preparing');w.prepareResource(this.$WebWorker3,this.$WebWorkerb.bind(this));return this;};w.prototype.setAllowCrossPageTransition=function(aa){"use strict";this.$WebWorker8=aa;return this;};w.prototype.isCurrentState=function(aa){"use strict";s(o(w.states,aa));return aa===this.$WebWorker1;};w.prototype.$WebWorkerb=function(){"use strict";s(!this.isCurrentState('executing'));if(this.isCurrentState('terminated'))return;s(this.$WebWorker3.sameOriginURL||this.$WebWorker3.source);if(this.$WebWorker3.sameOriginURL){this.$WebWorker4=new a.Worker(this.$WebWorker3.sameOriginURL);}else{this.$WebWorker4=new a.Worker(w.evalWorkerURL);this.$WebWorker4.postMessage(this.$WebWorker3.source);}this.$WebWorkerc('ping',Date.now());this.$WebWorkerd();this.$WebWorker2('executing');this.$WebWorker7.forEach(function(aa){return aa();});this.$WebWorker7=null;};w.prototype.$WebWorkera=function(){"use strict";this.$WebWorker9.release();};w.prototype.$WebWorkerc=function(aa){"use strict";var ba=Array.prototype.slice.call(arguments,1);this.$WebWorker4.postMessage({type:aa,args:ba});};w.prototype.$WebWorkere=function(event,aa){"use strict";w.$WebWorkere(event,this.$WebWorker3.name,aa);};w.prototype.$WebWorkerd=function(){"use strict";this.$WebWorker9.addSubscriptions(j.listen(this.$WebWorker4,'message',this.$WebWorkerf.bind(this)),j.listen(this.$WebWorker4,'error',this.$WebWorkerg.bind(this)));};w.prototype.$WebWorkerg=function(aa){"use strict";var ba=this.$WebWorker6(aa);if(!ba&&!aa.defaultPrevented)this.$WebWorkere('exception',{message:aa.message});};w.prototype.$WebWorkerf=function(event){"use strict";var aa=event.data;switch(aa.type){case 'message':this.$WebWorker5(aa.message);break;case 'pong':this.$WebWorker0=true;this.$WebWorkere('executed',{dt:Math.floor(aa.args[1]-aa.args[0]),bytes:this.$WebWorker3.source.length});break;case 'terminate':this.terminate();break;case 'haste-error':this.terminate();break;case 'console':var ba=aa.args.shift();s(o(['log','error','info','debug','warn'],ba));a.console[ba].apply(a.console,aa.args);break;}};w.prototype.$WebWorker2=function(aa){"use strict";s(o(w.states,aa));this.$WebWorker1=aa;};w.prepareResource=function(aa,ba){"use strict";ba=ba||p;s(aa.sameOriginURL||aa.url||aa.source);if(aa.sameOriginURL){ba();}else if(aa.url&&k(aa.url).isSameOrigin()){aa.sameOriginURL=aa.url;ba();}else if(aa.source){if(w.$WebWorkerh())aa.sameOriginURL=w.$WebWorkeri(aa.source);ba();}else if(!aa.loading){var ca=r();aa.loading=[ba];w.$WebWorkerj(aa.url,function(da){if(da){aa.source=da;if(w.$WebWorkerh())aa.sameOriginURL=w.$WebWorkeri(da);}w.$WebWorkere('prepared',aa.name,{dt:Math.floor(r()-ca),bytes:da.length});aa.loading.forEach(function(ea){return ea();});aa.loading=false;});}else aa.loading.push(ba);return aa;};w.releaseResource=function(aa){"use strict";if(aa.sameOriginURL.indexOf('blob:')===0){v.revokeObjectURL(aa.sameOriginURL);aa.sameOriginURL=null;}return aa;};w.isSupported=function(){"use strict";return !!a.Worker;};w.areTransferablesSupported=function(){"use strict";return w.isSupported()&&z();};w.$WebWorkerj=function(aa,ba){"use strict";new n(aa).setTransportBuilder(q).setMethod('GET').setResponseHandler(function(ca){ba(ca);}).setErrorHandler(ba.bind(null,null)).send();};w.$WebWorkeri=function(aa){"use strict";s(w.$WebWorkerh());if(w.$WebWorkerk()){var ba=i.getBlob([aa]);return v.createObjectURL(ba);}if(w.$WebWorkerl())return 'data:application/javascript,'+encodeURIComponent(aa);};w.$WebWorkerk=function(){"use strict";return i.isSupported()&&!!v&&!!v.createObjectURL&&x();};w.$WebWorkerl=function(){"use strict";return y();};w.$WebWorkerh=function(){"use strict";return w.$WebWorkerk()||w.$WebWorkerl();};w.$WebWorkere=function(event,aa,ba){"use strict";if(!h.logging.enabled)return;g.log(h.logging.config,u(ba,{event:event,resource:aa}));};var x=t(function(){var aa,ba;try{aa=v.createObjectURL(i.getBlob(['']));var da=new a.Worker(aa);da.terminate();ba=true;}catch(ca){ba=false;}finally{v.revokeObjectURL(aa);}return ba;}),y=t(function(){var aa;try{var ca=new a.Worker('data:application/javascript,');ca.terminate();aa=true;}catch(ba){aa=false;}return aa;}),z=t(function(){var aa;try{var ca=new a.Worker(w.evalWorkerURL),da=new ArrayBuffer(0);ca.postMessage({buffer:da},[da]);ca.terminate();aa=true;}catch(ba){aa=false;}return aa;});w.states=['constructed','preparing','executing','terminated'];w.evalWorkerURL=h.evalWorkerURL;e.exports=w;});
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";i.constructor.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;});
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";var j=Array.prototype.slice.call(arguments,0),k=this.getWorker();k.postMessage.apply(k,j);return k;};i.prototype.$WebWorkerPool2=function(){"use strict";var j=Array.prototype.slice.call(arguments,0);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";var j=Array.prototype.slice.call(arguments,0);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;});
__d("JpegResizer",["JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool"],function(a,b,c,d,e,f,g,h,i,j){var k=null;l.isSupported=function(){"use strict";return j.isSupported()&&!g.isGKBlacklisted;};l.getSingleton=function(){"use strict";if(!k)k=new l(l.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return k;};l.prepareResource=function(m){"use strict";i.prepareResource(h,m);};function l(m){"use strict";m=m||l.DEFAULT_POOL_SIZE;i.prepareResource(h);this.$JpegResizer0=(new j(h,m)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};}l.prototype.setAllowCrossPageTransition=function(m){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(m);return this;};l.prototype.resizeBlob=function(m,n,o){"use strict";var p=this.$JpegResizer0.getWorker();if(p.isCurrentState('terminated')){n(new Error('Worker terminated'));return this;}var q=p.postMessage({blob:m,height:2048,width:2048}).getIndex();this.$JpegResizer4(q).unshift({done:n,progress:o});return this;};l.prototype.$JpegResizer4=function(m){"use strict";if(!this.$JpegResizer3.hasOwnProperty(m))this.$JpegResizer3[m]=[];return this.$JpegResizer3[m];};l.prototype.$JpegResizer1=function(m,n){"use strict";m.terminate();var o=this.$JpegResizer4(m.getIndex());o.forEach(function(p){return p.done(n);});o.length=0;};l.prototype.$JpegResizer2=function(m,n){"use strict";if(n.done){this.$JpegResizer4(m.getIndex()).pop().done(n.error,n.blob,n.skipped);}else{var o=this.$JpegResizer4(m.getIndex()),p=o[o.length-1].progress;if(p)p({written:n.written,total:n.total});}};l.DEFAULT_POOL_SIZE=3;e.exports=l;});
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f,g){"use strict";function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;});
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;});
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";function aa(){return 'upload_'+r.getNewID();}var ba=z(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(fa,ga,ha){this.$ChatAutoSendPhotoUploader0=ha;this.$ChatAutoSendPhotoUploader1=ga;this.$ChatAutoSendPhotoUploader2=new s();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=fa.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(fa,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ia=i.find(fa,"._4q60"),ja=i.find(ia,"._4q61");new m(ia,ja,ga);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader7.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploadera.bind(this)),j.listen(ja,'click',function(){if(this.$ChatAutoSendPhotoUploaderb)if(o.prepareResource)o.prepareResource();this.inform('open');}.bind(this)));}ea.prototype.isUploading=function(){return !y(this.$ChatAutoSendPhotoUploader3);};ea.prototype.setUseJpegResizer=function(fa){this.$ChatAutoSendPhotoUploaderb=fa&&o.isSupported();if(this.$ChatAutoSendPhotoUploaderb)this.$ChatAutoSendPhotoUploader6.setPreprocessHandler(this.$ChatAutoSendPhotoUploaderc.bind(this));return this;};ea.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};ea.prototype.$ChatAutoSendPhotoUploaderd=function(fa,ga){var ha=this.$ChatAutoSendPhotoUploadere(fa);if(ga){ha.preview_width=ga.width;ha.preview_height=ga.height;}return ha;};ea.prototype.$ChatAutoSendPhotoUploadere=function(fa){var ga={upload_id:fa,on_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ha));}.bind(this),on_resizing_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ha));}.bind(this),on_success:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ha));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderf.bind(this),attach_type:p.PHOTO,preview_uploading:true};return ga;};ea.prototype.$ChatAutoSendPhotoUploaderc=function(fa,ga){var ha=fa.getFile();if(!q(ha.type).isJpeg())return ga(fa);o.getSingleton().resizeBlob(ha,function(ia,ja,ka){if(ja)fa.setFile(ja);ga(fa);},this.$ChatAutoSendPhotoUploaderg.bind(this,fa));};ea.prototype.$ChatAutoSendPhotoUploader7=function(){var fa=aa();this.$ChatAutoSendPhotoUploaderh(fa,this.$ChatAutoSendPhotoUploader1.files);};ea.prototype.$ChatAutoSendPhotoUploaderh=function(fa,ga){var ha={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ga&&ga.length===1){this.$ChatAutoSendPhotoUploader3[fa]=fa;ha[fa]=ga[0];var ia=new FileReader();ia.onload=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploaderd(fa,v(ia.result))]});}.bind(this);ia.onerror=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploadere(fa)]});}.bind(this);ia.readAsArrayBuffer(ga[0]);}else{var ja=[];if(!ga){this.$ChatAutoSendPhotoUploader3[fa]=fa;this.$ChatAutoSendPhotoUploader0.value=fa;ja.push(this.$ChatAutoSendPhotoUploadere(fa));}else for(var ka=0;ka<ga.length;++ka){var la=aa();ha[la]=ga[ka];this.$ChatAutoSendPhotoUploader3[la]=fa;ja.push(this.$ChatAutoSendPhotoUploadere(la));}this.inform('submit',{upload_id:fa,preview_attachments:ja});}if(Object.keys(ha).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(ha);};ea.prototype.$ChatAutoSendPhotoUploader8=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);if(this.$ChatAutoSendPhotoUploader3[ga]){var ha=this.$ChatAutoSendPhotoUploader3[ga];delete this.$ChatAutoSendPhotoUploader3[ga];var ia=fa.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ha])this.$ChatAutoSendPhotoUploader4[ha]=[];this.$ChatAutoSendPhotoUploader4[ha].push(ia.metadata[0].image_id);this.inform('success',{upload_id:ga});if(!this.$ChatAutoSendPhotoUploaderj(ha))this.$ChatAutoSendPhotoUploaderk(ha);}};ea.prototype.$ChatAutoSendPhotoUploaderk=function(fa){x(!this.$ChatAutoSendPhotoUploaderj(fa));this.inform('all-uploads-completed',{upload_id:fa,image_ids:this.$ChatAutoSendPhotoUploader4[fa]});delete this.$ChatAutoSendPhotoUploader4[fa];};ea.prototype.$ChatAutoSendPhotoUploadera=function(event,fa){this.inform('progress',{upload_id:fa.upload.getName(),event:fa.event});};ea.prototype.$ChatAutoSendPhotoUploaderg=function(fa,event){this.inform('resize_progress',{upload_id:fa.getName(),event:event});};ea.prototype.$ChatAutoSendPhotoUploaderj=function(fa){return t(w(this.$ChatAutoSendPhotoUploader3),fa);};ea.prototype.$ChatAutoSendPhotoUploader9=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);this.$ChatAutoSendPhotoUploaderl(ga,'last-upload-failed');return false;};ea.prototype.$ChatAutoSendPhotoUploaderf=function(fa){this.$ChatAutoSendPhotoUploaderl(fa,'last-upload-canceled');};ea.prototype.$ChatAutoSendPhotoUploaderl=function(fa,ga){if(!this.$ChatAutoSendPhotoUploader3[fa])return;var ha=this.$ChatAutoSendPhotoUploader3[fa];delete this.$ChatAutoSendPhotoUploader3[fa];if(!this.$ChatAutoSendPhotoUploaderj(ha))if(this.$ChatAutoSendPhotoUploader4[ha]){this.$ChatAutoSendPhotoUploaderk(ha);}else this.inform(ga,{upload_id:ha});};ea.prototype.$ChatAutoSendPhotoUploaderi=function(fa){if(fa.upload){return fa.upload.getName();}else return fa.response.getPayload().uploadID;};ea.prototype.uploadFile=function(fa){var ga=aa(),ha={};ha[ga]=fa;var ia=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setFiles(ha);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ia.subscribe('success',function(event,ja){this.$ChatAutoSendPhotoUploader8(event,{upload:ja,response:ja.getResponse()});}.bind(this)),ia.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)));ia.send();this.$ChatAutoSendPhotoUploaderh(ga,[fa]);};e.exports=ea;});
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=l.createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:l.PropTypes.string,onSubmit:l.PropTypes.func,onAllUploadsComplete:l.PropTypes.func,onLastUploadFail:l.PropTypes.func,onLastUploadCancel:l.PropTypes.func},getDefaultProps:function(){return {actionURI:k.upload_url,onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode()).setUseJpegResizer(k.ChatUseJpegResizer);this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(s,t){return s.actionURI!=this.props.actionURI;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (l.DOM.form({action:this.props.actionURI,method:"post",ref:"form"},l.DOM.input({type:"hidden",name:"attach_id",ref:"attachID"}),l.DOM.input({type:"hidden",name:"images_only",value:true}),i({className:"_m _4q60 _3rzn"},j({className:"_4q61 _509v"},h({className:"_509w",src:q('/images/chat/chat_camera_icon.png'),alt:"Camera"})),l.DOM.input({type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:"image/*",ref:"input"}))));},_handleSubmit:function(s,t){this.props.onSubmit(s,t);},_handleAllUploadsCompleted:function(s,t){this.props.onAllUploadsComplete(s,t);},_handleLastUploadFailed:function(s,t){this.props.onLastUploadFail(s,t);},_handleLastUploadCanceled:function(s,t){this.props.onLastUploadCancel(s,t);},isUploading:function(){return this._uploader&&this._uploader.isUploading();}});e.exports=r;});
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;});
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^_`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;});
__d("URLScraper",["ArbiterMixin","DataStore","Event","URLMatcher","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m='scraperLastPermissiveMatch',n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r){"use strict";this.input=r;this.enable();}q.prototype.reset=function(){"use strict";h.set(this.input,m,null);};q.prototype.enable=function(){"use strict";if(this.events)return;var r=function(s){setTimeout(this.check.bind(this,s),30);};this.events=i.listen(this.input,{paste:r.bind(this,false),keydown:r.bind(this,true)});};q.prototype.disable=function(){"use strict";if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;};q.prototype.check=function(r){"use strict";var s=this.input.value;if(r&&q.trigger(s))return;var t=q.match(s),u=j.permissiveMatch(s);if(u&&(u!=h.get(this.input,m))){h.set(this.input,m,u);this.inform('match',{url:t||u,alt_url:u});}};k(q,j);e.exports=q;});
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Form","URLScraper","WebMessengerEvents","mixin","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u,v,w,x){"use strict";this.$MercuryShareLinkUploader0=t;this.$MercuryShareLinkUploader1=u;this.$MercuryShareLinkUploader2=v;this.$MercuryShareLinkUploader3=x;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;o.listen(w,'click',this.close.bind(this));o.listen(x,'keyup',function(){!x.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new l(x);this.$MercuryShareLinkUploader7.subscribe('match',function(y,z){this.loadShare(z&&z.url);}.bind(this));}s.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};s.prototype.loadAttachData=function(t,u,v){"use strict";if(t){var w=k.serialize(u),x=w.attachment&&w.attachment.params,y=w.link_metrics?w.link_metrics.no_image:true;if(!x||!x.url)return null;if(v.value.indexOf(x.url)===-1)return w;if(!x.summary&&!x.favicon&&y){var z=x.url.substr(0,x.title.length);if(!x.title||x.title===z)return null;}return w;}return null;};s.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};s.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};s.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};s.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};s.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};s.prototype.loadShare=function(t){"use strict";this.$MercuryShareLinkUploader5=t;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:t}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,t)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};s.prototype.$MercuryShareLinkUploader9=function(t,u){"use strict";if(this.$MercuryShareLinkUploader5!==t)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,u.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}m.detailDOMChanged();};s.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();m.detailDOMChanged();};e.exports=s;});
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;m.listen(r,'keyup',function(){!r.value.length&&this.$ChatShareLinkUploader6.enable();}.bind(this));this.$ChatShareLinkUploader6=new j(r);this.$ChatShareLinkUploader6.subscribe('match',function(t,u){this.loadShare(u&&u.url);}.bind(this));this.$ChatShareLinkUploader7=null;}p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.enable();};p.prototype.$ChatShareLinkUploader8=function(){"use strict";var q=this.$ChatShareLinkUploader7;delete this.$ChatShareLinkUploader7;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();this.$ChatShareLinkUploader5=null;this.$ChatShareLinkUploader6&&this.$ChatShareLinkUploader6.reset();};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploader4=q;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader7)i.remove(this.$ChatShareLinkUploader7);this.$ChatShareLinkUploader7=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader7);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');var t={u:q,chat:true,extra_params:JSON.stringify(r)};this.$ChatShareLinkUploader5=new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData(t).setHandler(this.$ChatShareLinkUploader9.bind(this).bind(null,q));this.$ChatShareLinkUploader5.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploader9=function(q,r){"use strict";if(this.$ChatShareLinkUploader4!==q)return;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;i.appendContent(this.$ChatShareLinkUploader7,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();return;}h.addClass(this.$ChatShareLinkUploader7,'done');};e.exports=p;});
__d("MessagesEmoticons.react",["MercuryConfig","Grid.react","React","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.GridItem,n=g.WebBigStickerTray?8:7,o={smile:"smile",frown:"frown",tongue:"tongue",grin:"grin",gasp:"gasp",wink:"wink",pacman:"pacman",grumpy:"grumpy",unsure:"unsure",cry:"cry",kiki:"kiki",glasses:"glasses",sunglasses:"sunglasses",heart:"heart",devil:"devil",angel:"angel",squint:"squint",confused:"confused",upset:"upset",colonthree:"colonthree",like:"like"},p=i.createClass({displayName:'MessagesEmoticons',propTypes:{onEmoticonSelect:i.PropTypes.func},getDefaultProps:function(){return {onEmoticonSelect:k};},getEmoticons:function(){return Object.keys(o).map(function(q){return (m({key:q},i.DOM.div({className:"panelCell"},i.DOM.a({'aria-label':o[q],className:'emoticon emoticon_'+q,onClick:function(){return this.props.onEmoticonSelect(q);}.bind(this)}))));}.bind(this));},render:function(){return (i.DOM.div({className:"emoticonsTable"},h({cols:n,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=p;});
__d("XStickerStateInitialDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/stickers\/state\/",{});});
__d("XStickerStatePackDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});});
__d("XStickerStateStoreDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/stickers\/state\/store\/",{});});
__d("StickerState",["AsyncRequest","Deferred","PresenceState","XStickerStateInitialDataControllerURIBuilder","XStickerStatePackDataControllerURIBuilder","XStickerStateStoreDataControllerURIBuilder","copyProperties","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={},p,q,r,s=0,t={},u=[],v=[],w=null,x=i.get();if(x)w=x.tray_pack_id;var y={onTrayDataReady:function(fa){!q&&z();q.addCallback(fa);},onStoreDataReady:function(fa){!p&&aa();p.addCallback(fa);},onPackDataReady:function(fa,ga){!o[fa]&&ba(fa);o[fa].addCallback(ga);},getPacksInTray:function(){return u;},getPacksInCommentsTray:function(){return u.filter(function(fa){return !fa.isMessengerOnly;});},getPackIDsInTray:function(){return u.map(function(fa){return fa.id;});},getPacksInStore:function(){return v;},getPack:function(fa){return t[fa];},getNumNewPacks:function(){return s;},resetNumNewPacks:function(){if(s){s=0;this.emit(this.NUM_NEW_PACKS_CHANGED,0);}},addMRUPack:function(){if(r){this.addPack(r);r=null;}},addPack:function(fa){da(fa);t[fa.id].isPurchased=true;t[fa.id].isInTray=true;if(t[fa.id].isPromoted){t[fa.id].isPromoted=false;}else{var ga=u.filter(function(ha){return ha.isMRU||ha.isPromoted;}).length;u.splice(ga,0,t[fa.id]);}this.emit(this.PACKS_CHANGED,fa.id);},removePack:function(fa){u=u.filter(function(ga){return ga.id!==fa;});t[fa].isInTray=false;this.emit(this.PACKS_CHANGED,fa);},setTrayPackID:function(fa){w=fa;i.doSync();this.emit(y.PACK_SELECTED,fa);},getTrayPackID:function(){return w;}};y.PACKS_CHANGED='StickerState/packsChanged';y.PACK_SELECTED='StickerState/packSelected';y.NUM_NEW_PACKS_CHANGED='StickerState/numNewPacksChanged';i.registerStateStorer(function(fa){fa.tray_pack_id=w;});function z(){q=ca(new j().getURI(),function(fa){u=fa.packs.map(function(ga){return da(ga);});r=fa.mru;s=fa.num_new_packs;});}function aa(){p=ca(new l().getURI(),function(fa){v=fa.packs.map(function(ga){return da(ga);});});}function ba(fa){o[fa]=ca(new k().setInt('pack_id',fa).getURI(),function(ga){da(ga);});}function ca(fa,ga){var ha=new h();new g(fa).setHandler(function(ia){ga(ia.payload);ha.succeed();}).send();return ha;}function da(fa){var ga=fa.id;if(!t[ga]){return (t[ga]=fa);}else return m(t[ga],fa);}var ea={};ea[y.PACK_SELECTED]=true;ea[y.PACKS_CHANGED]=true;ea[y.NUM_NEW_PACKS_CHANGED]=true;n(y,ea);e.exports=y;});
__d("DialogFitHeight",["CSS","DOM","Event","Style","SubscriptionsHandler","Vector","csx","cx","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=450,q=100,r=67,s=67;function t(u){"use strict";this.$DialogFitHeight0=u;}t.prototype.enable=function(){"use strict";this.$DialogFitHeight1=new k();this.$DialogFitHeight1.addSubscriptions(this.$DialogFitHeight0.subscribe('beforeshow',this.$DialogFitHeight2.bind(this)),i.listen(window,'resize',o(this.$DialogFitHeight2.bind(this))));this.$DialogFitHeight3=h.find(this.$DialogFitHeight0.getRoot(),"._4-i2");g.addClass(this.$DialogFitHeight3,"_5pfh");this.$DialogFitHeight4=q;if(h.scry(this.$DialogFitHeight0.getRoot(),"._4-i0").length)this.$DialogFitHeight4+=r;if(h.scry(this.$DialogFitHeight0.getRoot(),"._5a8u").length)this.$DialogFitHeight4+=s;};t.prototype.disable=function(){"use strict";this.$DialogFitHeight1.release();this.$DialogFitHeight1=null;g.removeClass(this.$DialogFitHeight3,"_5pfh");};t.prototype.$DialogFitHeight2=function(){"use strict";var u=l.getViewportDimensions().y,v=u-this.$DialogFitHeight4;j.set(this.$DialogFitHeight3,'height',Math.max(p,v)+'px');this.$DialogFitHeight0.updatePosition();};e.exports=t;});
__d("StickerStoreController",["Bootloader","DialogFitHeight","DOM","LayerFadeOnHide","React","XUIDialog.react","XUIDialogBody.react","XUISpinner.react","cx","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=688,r=null,s=k.createClass({displayName:'StoreLayer',getInitialState:function(){return {renderStore:function(){return (k.DOM.div({className:"_5r5e"},n({background:"light",size:"large"})));}};},componentDidMount:function(){g.loadModules(["StickerStore.react"],function(v){this.setState({renderStore:function(){return (v({currentPackID:this.props.packID,onPackSelect:this._packSelected,shown:this.props.shown}));}.bind(this)});}.bind(this));},_packSelected:function(v){this.setProps({packID:v});},_onToggle:function(v){p(this.setProps.bind(this,{shown:v},null));},render:function(){return (l({behaviors:{DialogFitHeight:h,LayerFadeOnHide:j},onToggle:this._onToggle,shown:this.props.shown,width:q},m({className:"_5rq-"},this.state.renderStore())));}});function t(v){var w=i.create('div');i.appendContent(document.body,w);r=k.renderComponent(s({packID:v,shown:true}),w);}var u={showStore:function(v){if(!r){t(v);}else r.setProps({shown:true,packID:v});},hideStore:function(){if(!r)return;r.setProps({shown:false});}};e.exports=u;});
__d("XUIBadge.react",["React","cx","invariant"],function(a,b,c,d,e,f,g,h,i){function j(l){return parseInt(l,10)===l;}var k=g.createClass({displayName:'XUIBadge',propTypes:{type:g.PropTypes.oneOf(['regular','special']),count:g.PropTypes.number.isRequired,maxcount:g.PropTypes.number},getDefaultProps:function(){return {type:'regular',maxcount:20};},render:function(){var l=this.props.type,m=this.props.count,n=this.props.maxcount;i(j(m));i(j(n));var o=(("_5ugh")+(m>n?' '+"_5ugi":'')+(l==='regular'?' '+"_5ugf":'')+(l==='special'?' '+"_5ugg":'')+(m===0?' '+"hidden_elem":''));return this.transferPropsTo(g.DOM.span({className:o,type:null},m>n?n+'+':m));}});e.exports=k;});
__d("StickersFlyoutPackSelector.react",["Animation","Locale","MercuryConfig","ReactPropTypes","React","Image.react","StickerState","StickerStoreController","XUIBadge.react","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=5,u="Sticker Store",v=k.createClass({displayName:'StickersFlyoutPackSelector',propTypes:{numNewPacks:j.number,packs:j.array.isRequired,onPackClick:j.func,selectedPackID:j.string},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {numNewPacks:0,onPackClick:q};},shouldComponentUpdate:function(x,y){return !y.animating;},_setPage:function(x){if(this.state.animating)return;this.setState({animating:true,page:x});var y=this.refs.positioner.getDOMNode(),z=this._calculatePosition(x);new g(y).to(z.reference,z.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(200).go();},_calculatePosition:function(x){var y=this.refs.positioner.getDOMNode(),z=y.childNodes[x].offsetLeft;if(h.isRTL()){var aa=y.offsetWidth,ba=y.childNodes[x].offsetWidth;return {reference:'right',offset:z+ba-aa};}return {reference:'left',offset:-z};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/t));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1);},_openStore:function(){m.resetNumNewPacks();n.showStore();},render:function(){return (k.DOM.div({className:(("_5r85")+(i.WebBigStickerTray?' '+"_lm9":''))},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),this._renderJewel(),k.DOM.div({className:"_5r88"},k.DOM.div({className:"_5r89",ref:"positioner"},this._renderPages()))));},_renderPages:function(){var x=this.props.packs.map(function(ba){return w({key:ba.id,onClick:function(){return this.props.onPackClick(ba.id,ba.isPromoted);}.bind(this),pack:ba,selected:this.props.selectedPackID===ba.id});}.bind(this)),y=[];for(var z=0;z<x.length;z+=t){var aa=z;z===0&&z++;y.push(k.DOM.div({className:"_5r81",key:z},x.slice(aa,z+t)));}return y;},_renderStoreButton:function(){return (k.DOM.a({'aria-label':u,className:"_5r86 rfloat",'data-hover':"tooltip",onClick:this._openStore},l({className:"_5r87",src:s('/images/messaging/stickers/selector/store.png')})));},_renderJewel:function(){var x=this.props.numNewPacks;if(!x)return null;return (o({className:"rfloat _3fhs",count:x,maxcount:9,type:"special"}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;return (k.DOM.a({className:(("_37wu")+(' '+"lfloat")),onClick:this._goPrev},l({className:"_5r84",src:s('/images/messaging/stickers/selector/leftarrow.png')})));},_renderNextArrow:function(){if(!this._canGoNext())return null;return (k.DOM.a({className:(("_37wv")+(' '+"rfloat")),onClick:this._goNext},l({className:"_5r84",src:s('/images/messaging/stickers/selector/rightarrow.png')})));}}),w=k.createClass({displayName:'PackIcon',propTypes:{pack:j.object.isRequired,selected:j.bool,onClick:j.func},getDefaultProps:function(){return {onClick:q};},render:function(){var x=this.props.pack,y=(("_5r8a")+(this.props.selected?' '+"_5r8b":''));return (k.DOM.a({'aria-label':x.name,className:y,'data-id':x.id,'data-hover':"tooltip",onClick:function(){return this.props.onClick(x.id);}.bind(this),tabIndex:"0"},k.DOM.img({className:(("_5r8c")+(x.isPromoted?' '+"_182h":'')),src:x.icon}),k.DOM.img({className:"_5r8d",src:x.selectedIcon})));}});e.exports=v;});
__d("XStickerPackImagesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int"}});});
__d("StickersFlyoutStickerSelector.react",["AsyncRequest","Deferred","Grid.react","LegacyScrollableArea.react","MercuryConfig","ReactPropTypes","React","ReactLayeredComponentMixin","Sticker.react","StickerConstants","StickerState","XUIContextualDialog.react","XUISpinner.react","XStickerPackImagesControllerURIBuilder","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=i.GridItem,w=k.WebBigStickerTray?256:148,x=k.WebBigStickerTray?320:256,y=p.MRU_STICKER_PACK,z=k.WebBigStickerTray?70:52,aa=128,ba=null,ca={},da={},ea=m.createClass({displayName:'StickersFlyoutStickerSelector',mixins:[n],propTypes:{packID:l.string},getInitialState:function(){return {loading:false,stickers:[],stickerPreviewID:null,stickerPreviewLoading:false};},_addRecentlyUsedSticker:function(fa){var ga=fa.id,ha=ba;for(var ia=0;ia<ha.length;++ia)if(ha[ia].id===ga){ha.splice(ia,1);break;}ha.unshift(fa);},updateRecentlyUsed:function(fa,ga){if(!k.WebRecentlyUsedStickersGK)return;if(!ba){q.addMRUPack();return;}var ha;ca[fa].addCallback(function(ia){var ja=fa==y?ba:ia;ha=ja.filter(function(ka){return ka.id===ga;})[0];});this._addRecentlyUsedSticker(ha);},componentDidMount:function(){this.requestStickers(this.props.packID);},componentWillReceiveProps:function(fa){if(fa.packID!==this.props.packID)this.requestStickers(fa.packID);},getScaledDimensions:function(fa,ga){var ha,ia,ja;if(ga>fa){ja=z/ga;ha=fa*ja;ia=ga*ja;}else{ja=z/fa;ha=fa*ja;ia=ga*ja;}return {height:Math.round(ha),width:Math.round(ia)};},requestStickers:function(fa){if(!fa)return;if(!ca[fa]){var ga=new h();new g().setURI(new t().setInt('pack_id',fa).setInt('sticker_size',z).getURI()).setMethod("POST").setHandler(function(ha){if(fa==y)ba=ha.payload;ga.succeed(ha.payload);}.bind(this)).send();ca[fa]=ga;}this.setState({loading:true});ca[fa].addCallback(function(ha){this.setState({loading:false,stickers:ha});}.bind(this));},requestPreviewStickers:function(fa){if(!k.StickerPreviews||!fa)return;if(fa==this.state.stickerPreviewID)return;this.setState({stickerPreviewID:fa});if(fa in da||this.state.stickerPreviewLoading)return;new g().setURI(new t().setInt('pack_id',this.props.packID).setInt('sticker_size',aa).getURI()).setMethod("POST").setHandler(function(ga){ga.payload.forEach(function(ha){da[ha.id]=ha;});this.setState({stickerPreviewLoading:false});}.bind(this)).send();this.setState({stickerPreviewLoading:true});},renderLayers:function(){if(!k.StickerPreviews||!this.state.stickerPreviewID)return;var fa;if(this.state.stickerPreviewLoading){fa=m.DOM.div({className:"_49li"},s({className:"_5r8j"}));}else{var ga=da[this.state.stickerPreviewID];fa=o({animationTrigger:"load_and_hover",frameCount:ga.frameCount,frameRate:ga.frameRate,framesPerCol:ga.framesPerCol,framesPerRow:ga.framesPerRow,sourceHeight:ga.height,sourceURI:ga.sourceURI,sourceWidth:ga.width,spriteURI:ga.spriteURI,stickerID:this.state.stickerPreviewID,style:{cursor:'pointer'}});}return {preview:r({contextRef:this.state.stickerPreviewID,shown:true},fa)};},onStickerMouseLeave:function(fa){if(!k.StickerPreviews)return;this.setState({stickerPreviewID:null});},renderStickers:function(){var fa=this.state.stickers.map(function(ga){var ha=this.getScaledDimensions(ga.height,ga.width),ia=k.StickerPreviews?'click':'hover';return (v({key:ga.id},m.DOM.div({className:"_5r8h",'data-id':ga.id,onMouseOver:this.requestPreviewStickers.bind(this,ga.id),onMouseLeave:this.onStickerMouseLeave.bind(this,ga.id),ref:ga.id},o({animationTrigger:ia,className:"_5r8i",frameCount:ga.frameCount,frameRate:ga.frameRate||83,framesPerCol:ga.framesPerCol,framesPerRow:ga.framesPerRow,sourceHeight:ha.height,sourceURI:ga.sourceURI,sourceWidth:ha.width,spriteURI:ga.spriteURI,stickerID:ga.id,style:{cursor:'pointer'}}))));}.bind(this));return fa;},render:function(){if(this.state.loading)return (s({className:"_5r8j"}));return (j({height:w,width:x,fade:true},m.DOM.div({className:"_5r8k"},i({cols:4,fixed:true},this.renderStickers()))));}});e.exports=ea;});
__d("XStickersAddPackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"}});});
__d("StickersFlyout.react",["AsyncRequest","BanzaiLogger","MercuryConfig","MessagesEmoticons.react","Parent","React","ReactPropTypes","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickerState","SubscriptionsHandler","Toggler","XUISpinner.react","XStickersAddPackControllerURIBuilder","arrayContains","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=l.createClass({displayName:'StickersFlyout',propTypes:{isComments:m.bool,onStickerSelect:m.func.isRequired,onEmoticonSelect:m.func,onPackSelect:m.func.isRequired,packID:m.string,shown:m.bool},getDefaultProps:function(){var x=i.ShowLastSelectedPackTab?p.getTrayPackID():null;return {isComments:false,packID:x,shown:false};},getInitialState:function(){return {dataReady:false,numNewPacks:0};},componentDidMount:function(){var x=k.byClass(this.getDOMNode(),'uiToggle');if(x){r.listen('show',x,function(){h.log('StickersLoggerConfig',{event:'open_tray'});if(!this.state.dataReady)this.loadTrayData();}.bind(this));}else if(this.props.shown&&!this.state.dataReady)this.loadTrayData();this.subscriptions=new q();this.subscriptions.addSubscriptions(p.addListener(p.PACKS_CHANGED,this.packsUpdated));this.subscriptions.addSubscriptions(p.addListener(p.NUM_NEW_PACKS_CHANGED,function(y){this.setState({numNewPacks:y});}.bind(this)));},componentWillReceiveProps:function(x){if(!this.state.dataReady&&x.shown)this.loadTrayData();},loadTrayData:function(){p.onTrayDataReady(function(){var x=p.getNumNewPacks();this.setState({dataReady:true,numNewPacks:x});var y=p.getPacksInTray()[0].id,z=this.props.packID;if(!z||!u(p.getPackIDsInTray(),z))this.props.onPackSelect(y,true);}.bind(this));},componentWillUnmount:function(){this.subscriptions.release();},selectPack:function(x,y){if(y){var z=(new t()).setInt('pack_id',x).getURI();new g().setURI(z).send();}if(i.ShowLastSelectedPackTab)p.setTrayPackID(x);this.setState({currentPackID:x});},loadPack:function(){if(!this.state.dataReady)return s({className:"_5r8j"});if(this.props.packID==='emoticons')return (l.DOM.div({className:"_5r8l",'data-id':this.props.packID},j({onEmoticonSelect:this.props.onEmoticonSelect})));h.log('StickersLoggerConfig',{event:'select_pack',packid:this.props.packID});return (l.DOM.div({className:"_5r8l",'data-id':this.props.packID},o({ref:"selector",packID:this.props.packID})));},packsUpdated:function(){var x=p.getPackIDsInTray();if(!u(x,this.props.packID)){this.props.onPackSelect(x[0]);return;}this.forceUpdate(null);},selectedSticker:function(event){var x=k.byClass(event.target,"_5r8h");if(x){var y=x.getAttribute('data-id'),z=this.props.packID;this.refs.selector.updateRecentlyUsed(z,y);this.props.onStickerSelect(y);var aa=k.byClass(this.getDOMNode(),'uiToggle');aa&&r.hide(aa);}},render:function(){var x=this.props.isComments?p.getPacksInCommentsTray():p.getPacksInTray();return (l.DOM.div({className:"_5r8f"},l.DOM.div({className:"_5r8e"},n({numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.props.packID,packs:x})),l.DOM.div({className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=w;});
__d("ChatStickerButton.react",["MercuryConfig","React","ReactLayeredComponentMixin","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=g.WebBigStickerTray?320:256,n=h.createClass({displayName:'ChatStickerButton',propTypes:{onStickerSelect:h.PropTypes.func,onEmoticonSelect:h.PropTypes.func,packID:h.PropTypes.string,shown:h.PropTypes.bool},mixins:[i],getDefaultProps:function(){return {onStickerSelect:k,onEmoticonSelect:k,shown:false};},getInitialState:function(){return {renderFlyout:null};},componentDidMount:function(){this._bootstrapFlyout();},shouldComponentUpdate:function(o,p){return (o.packID!=this.props.packID||o.shown!=this.props.shown||p.renderFlyout!=this.state.renderFlyout);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (h.DOM.a({className:"_4vuh",onClick:this._showFlyout,onMouseDown:this._prepareForClick,title:"Choose a sticker or emoticon",ref:"link"},h.DOM.div({className:(("_4vui")+(this.props.shown?' '+"open":''))})));},renderLayers:function(){return !this.state.renderFlyout?{}:this.state.renderFlyout();},_prepareForClick:function(){this._clickGuard=this.props.shown;},_showFlyout:function(){if(!this._clickGuard)if(this._initialPackID){this.setProps({shown:true,packID:this._initialPackID});this._initialPackID=null;}else this.setProps({shown:true});},_hideFlyout:function(){this.setProps({shown:false});},_handleStickerSelected:function(o){this._hideFlyout();this.props.onStickerSelect(o);},_handleEmoticonSelected:function(o){this._hideFlyout();this.props.onEmoticonSelect(o);},_bootstrapFlyout:function(){d(['XUIContextualDialog.react','StickersFlyout.react','StickerState'],function(o,p,q){var r=function(t,u){if(g.ShowLastSelectedPackTab){q.setTrayPackID(t);}else if(u){this._initialPackID=t;}else this.setProps({packID:t});}.bind(this);if(g.ShowLastSelectedPackTab)this._subscription=q.addListener(q.PACK_SELECTED,function(t){this.setProps({packID:t});}.bind(this));var s=((g.WebBigStickerTray?"_5la5":''));this.setState({renderFlyout:function(){return {contextualDialog:o({alignment:"right",className:"_5e-r",contextRef:"link",onBlur:this._hideFlyout,position:"above",shown:this.props.shown,width:m},h.DOM.div({className:s},p({onPackSelect:r,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.props.packID,shown:this.props.shown})))};}.bind(this)});}.bind(this));}});e.exports=n;});
__d("loadImage",[],function(a,b,c,d,e,f){"use strict";function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;});
__d("PhotoResizeMath",[],function(a,b,c,d,e,f){var g={getScaledPhotoDimensions:function(h,i,j,k,l){var m=h/i,n=j/k;if(j&&k&&l==='stretch')return {width:j,height:k};if((!j&&k)||((l==='contain')!==(m>=n)))return {width:k*m,height:k};if(j)return {width:j,height:j/m};return {width:h,height:i};}};e.exports=g;});
__d("PixelzFocus",[],function(a,b,c,d,e,f){"use strict";var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;});
__d("Pixelz.react",["arrayContains","copyProperties","cx","loadImage","React","PhotoResizeMath","PixelzFocus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=k.PropTypes,o=k.createClass({displayName:'Pixelz',propTypes:{width:n.number,height:n.number,resizeMode:n.oneOf(['contain','cover','stretch']),alt:n.string,letterbox:n.bool,borderRadius:n.number,insetBorderColor:n.string,animated:n.bool,upscale:n.bool,cropRect:function(p,q,r){var s=p[q],t='Invalid prop `'+q+'` supplied to `'+r+'`, expected a rectangle with values normalized '+'between 0 and 1.';if(s.left<0||s.top<0||s.width<0||s.height<0||s.left+s.width>1||s.top+s.height>1)return new Error(t);},focus:function(p,q,r){var s=p[q],t='Invalid prop `'+q+'` supplied to `'+r+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1.';if(Array.isArray(s)){for(var u=0;u<s.length;++u)if(!(s[u].x>=0&&s[u].x<=1)||!(s[u].y>=0&&s[u].y<=1))return new Error(t);}else{if(!s.type)s.type='css';if(!(s.x>=0&&s.x<=1)||!(s.y>=0&&s.y<=1)||!g(['center','css'],s.type))return new Error(t);}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var p=this.props.src,q=this.state.srcDimensions[p];if(q)return q;j(p,function(r,s){var t={};t[p]={width:r,height:s};this.setState({srcDimensions:t});}.bind(this));return null;},getCropSrcDimensions:function(){var p=this.getSrcDimensions();return {width:p.width*this.props.cropRect.width,height:p.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var p=this.getCropSrcDimensions();return l.getScaledPhotoDimensions(p.width,p.height,this.props.width,this.props.height,this.props.resizeMode);},getCropDimensions:function(){var p=this.getUpscaleCropDimensions(),q=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(p.width,q.width),height:Math.min(p.height,q.height)};return p;},getCropAspectRatio:function(){var p=this.getCropDimensions();return p.width/p.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var p=this.getContainerDimensions();return p.width/p.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var p=this.props.focus;if(!Array.isArray(p)&&p.type==='css')return {x:p.x,y:p.y};var q=this.getContainerAspectRatio(),r=this.getCropAspectRatio(),s=m.getVisible(q,r),t=m.focusHorizontally(q,r),u;if(!Array.isArray(p)){u=m.convertFromCenterToCSS(t?p.x:p.y,s);}else{var v=p.map(function(y){return t?y.x:y.y;});v.sort();var w=m.findBiggestSets(v,s),x=m.getBestSet(v,w,s);u=m.getFocusFromSet(v,x);}return {x:t?u:.5,y:t?.5:u};},getCropPosition:function(){var p=this.getCropDimensions(),q=this.getContainerDimensions(),r=this.getFocus();return {left:r.x*(q.width-p.width),top:r.y*(q.height-p.height)};},getScaleDimensions:function(){var p=this.getCropDimensions();return {width:p.width/this.props.cropRect.width,height:p.height/this.props.cropRect.height};},getScalePosition:function(){var p=this.getScaleDimensions();return {left:-p.width*this.props.cropRect.left,top:-p.height*this.props.cropRect.top};},getClipCropRectangle:function(){var p=this.getContainerDimensions(),q=this.getCropDimensions(),r=this.getContainerPosition(),s=this.getCropPosition(),t=Math.max(r.left,s.left),u=Math.max(r.top,s.top),v=Math.min(r.top+p.height,s.top+q.height),w=Math.min(r.left+p.width,s.left+q.width);return {left:t,top:u,width:w-t,height:v-u};},getClipCropPosition:function(){var p=this.getClipCropRectangle();return {left:p.left,top:p.top};},getClipCropDimensions:function(){var p=this.getClipCropRectangle();return {width:p.width,height:p.height};},getClipScalePosition:function(){var p=this.getScalePosition(),q=this.getClipCropPosition(),r=this.getCropPosition();return {left:p.left+(r.left-q.left),top:p.top+(r.top-q.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(p,q){return p.width===q.width&&p.height===q.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var p=this.getContainerDimensions(),q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q)||this.areDimensionsEqual(q,r))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var p=this.getContainerDimensions(),q=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(p,q){if(this.shouldAddAllNodesAndStyles()||q.left)p.left=Math.round(q.left);if(this.shouldAddAllNodesAndStyles()||q.top)p.top=Math.round(q.top);},applyDimensionsStyle:function(p,q){p.width=Math.round(q.width);p.height=Math.round(q.height);},applyBorderRadiusStyle:function(p){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)p.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var p={},q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(q,r)){this.applyPositionStyle(p,this.getClipScalePosition());}else this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipScaleDimensions());this.applyBorderRadiusStyle(p);return p;},getCropStyle:function(){var p={};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getInsetBorderStyle:function(){var p={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getContainerStyle:function(){var p={};this.applyDimensionsStyle(p,this.getContainerDimensions());this.applyBorderRadiusStyle(p);return p;},getScale:function(){var p=this.getScaleStyle(),q=p.width,r=p.height;p=h({},p);delete p.width;delete p.height;return this.transferPropsTo(k.DOM.img({alt:this.props.alt,className:(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),src:this.props.src,style:p,width:q,height:r}));},getCrop:function(){var p=this.getScale();if(!this.hasCrop())return p;return (k.DOM.div({className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},p));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (k.DOM.div({className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var p=this.getCrop();if(!this.hasContainer())return p;var q=this.getInsetBorder();return (k.DOM.div({className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},p,q));},render:function(){var p=this.getSrcDimensions();if(!p)return k.DOM.span(null);return this.getContainer();}});e.exports=o;});
__d("MercuryRoger",["ArbiterMixin","MercuryActionStatus","copyProperties","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryServerRequests').get(),k={},l={getSeenBy:function(m,n){if(!m)return [];var o=[],p=k[m.thread_id],q=h.SUCCESS;for(var r in p)if(p[r]>m.timestamp&&(m.status===undefined||m.status===q)&&(!n||r!=m.author))o.push(r);return o;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};i(l,g);j.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","EmoticonsList","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","MercurySeenByAll","MercuryServerRequests","SplitImage.react","StickerConstants","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","emojiAndEmote","fbt","formatDate","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){var ma=l.create('wm_timestamp');function na(ta){this._fbid=ta;this._serverRequests=w.getForFBID(ta);this._threads=ba.getForFBID(ta);}ga(na,p);ga(na.prototype,{renderTimestamp:function(ta,ua,va,wa){if(wa){if(!ua){ma.warn('no_title');ua=(new Date(wa)).toLocaleDateString();}ta.setAttribute('title',ua);ta.setAttribute('data-utime',wa/1000);if(!va){ma.warn('no_display');va=ka(new Date(wa),'g:ia');}h.setContent(ta,va);g.show(ta);}},renderMessageSourceTags:function(ta,ua,va,wa){var xa='',ya='',za='';if(ea(va,o.MESSENGER)){xa="Sent from Messenger";ya=new da('/mobile/messenger');za="_9g";}else if(ea(va,o.MOBILE)){xa="Sent from Mobile";ya=new da('/mobile/');za="_9j";}else if(ea(va,o.CHAT)){xa="Sent from chat";za="_9h";}else if(ea(va,o.EMAIL)){if(wa){xa=la._("Sent from {email}",{email:wa});}else xa="Sent from email";za="_9i";}if(za){ca.set(ta,xa);g.addClass(ua,za);if(ya){ta.setAttribute('href',ya);}else ta.removeAttribute('href');}else g.hide(ta);},renderMessageLocation:function(ta,ua,va){var wa=da('/ajax/messaging/hovercard/map.php').setQueryData(va);ta.setAttribute('data-hovercard',wa);g.removeClass(ta,"_b9");g.show(ua);},renderSpoofWarning:function(ta,ua,va){if(ua){g.addClass(ta,"_sa");ca.set(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));}},renderChatSpoofWarning:function(ta,ua,va){if(ua)h.appendContent(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));},renderCoreThreadlist:function(ta,ua,va,wa,xa){wa=wa||{};this.renderThreadImage(ta,ua.getNode('image'));var ya=ua.getNode('accessibleName'),za=[ua.getNode('name')];if(ya)za.push(ya);sa(this,ta,za,wa);if(ta.folder&&xa)ra(ua.getNode('folderBadge'),ta.folder);var ab=ua.getNode('timestamp');this.renderTimestamp(ab,ta.timestamp_absolute,ta.timestamp_relative,ta.timestamp);this.renderSnippet(ta,ua.getNode('snippet'));pa(ua,ta);va(ua,ta);},renderAndSeparatedParticipantList:function(ta,ua,va){va=va||{};va.last_separator_uses_and=true;this._threads.getThreadMeta(ta,function(wa){sa(this,wa,ua,va);}.bind(this));},renderSnippet:function(ta,ua){var va=false,wa=h.create('span');g.addClass(wa,'MercuryRepliedIndicator');h.appendContent(ua,wa);v.updateOnSeenChange(wa,ta);var xa=ta.snippet;if(xa){if(ta.snippet_has_attachment)h.appendContent(ua,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(xa.substr(0,4)=='?OTR'){xa="[encrypted message]";}else xa=xa.replace(/\r\n|[\r\n]/g," ");xa=k(i.htmlEmojiAndEmote(xa));}else{if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(ta.snippet_has_attachment&&ta.snippet_attachments&&ta.snippet_attachments.length){va=true;xa=h.create('span');qa(this,ta,xa);}}var ya=ta.participants.length;if(ta.is_subscribed)ya--;if(!va&&ta.snippet_sender&&r.getIDForUser(this._fbid)!=ta.snippet_sender&&ya>1){r.get(ta.snippet_sender,function(za){if(za.short_name){h.appendContent(ua,la._("{name}: {conversation_snippet}",{name:za.short_name,conversation_snippet:xa}));}else h.appendContent(ua,xa);});}else h.appendContent(ua,xa);},getWebMessengerURL:function(ta,ua,va){if(ta.substr(0,ta.indexOf(':'))=='user'){q.getUserCanonicalWebMessengerURL(ta,ua,va);}else this._serverRequests.getServerThreadID(ta,function(wa){q.getWebMessengerURLWithServerID(wa,ua,va);});},renderWebMessengerLink:function(ta,ua,va,wa){if(ta.substr(0,ta.indexOf(':'))=='user'){q.renderUserCanonicalWebMessengerLink(ta,ua,va,wa);}else this._serverRequests.getServerThreadID(ta,function(xa){q.renderWebMessengerLinkWithServerID(xa,ua,va,wa);});},renderThreadImage:function(ta,ua){if(ta.image_src){var va=t({height:s.BIG_IMAGE_SIZE,resizeMode:'cover',src:ta.image_src,width:s.BIG_IMAGE_SIZE});va=u.renderComponent(va,ua);return;}var wa=r.getIDForUser(this._fbid),xa=[],ya=ta.participants.filter(function(za){return za!=wa;});if(!ya.length){xa=[wa];}else if(ya.length==1){xa=[ya[0]];}else xa=ya.slice(0,3);this.renderParticipantImages(xa,ua);},renderParticipantImages:function(ta,ua){r.getOrderedBigImageMulti(ta,function(va){var wa=x({srcs:va,border:true,size:s.BIG_IMAGE_SIZE});u.renderComponent(wa,ua);});},renderParticipantList:function(ta,ua,va,wa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa);},renderThreadNameAndParticipantList:function(ta,ua,va,wa){var xa=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa),ya=this._threads.getThreadMetaNow(ta);if(!ya.name)return xa;return la._("{conversation_name} [with {participant_list}]",{conversation_name:ya.name,participant_list:xa});},renderParticipantCount:function(ta,ua){return q.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(ta),ua);}});function oa(ta){if(!ta.snippet_attachments)return [];return ta.snippet_attachments.filter(function(ua){return ua.attach_type===n.PHOTO;});}function pa(ta,ua){var va=oa(ua);if(va.length===0)return;var wa=va[0].thumbnail_url;if(!wa)return;var xa=(va.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',ya=ta.getNode(xa);if(!ya)return;var za=h.find(ya,'i');z.set(za,'background-image','url('+wa+')');g.show(ya);}function qa(ta,ua,va){var wa=ua.snippet_sender&&r.getIDForUser(ta._fbid)==ua.snippet_sender,xa=function(eb){if(!ua.snippet_sender||wa){eb(null);return;}r.get(ua.snippet_sender,function(fb){eb(fb.short_name);});},ya=oa(ua),za=ya.length==ua.snippet_attachments.length,ab=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.VIDEO,bb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].metadata&&ua.snippet_attachments[0].metadata.type=='fb_voice_message',cb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.STICKER,db=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.SHARE;xa(function(eb){var fb=null;if(za){var gb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(ya.length===1){fb=wa?"You sent a photo.":la._("{name} sent a photo.",{name:eb});}else fb=wa?la._("You sent {num_photos} photos.",{num_photos:ya.length}):la._("{name} sent {num_photos} photos.",{name:eb,num_photos:ya.length});g.addClass(gb,m.getAttachIconClass(ya[0].icon_type));h.appendContent(gb,fb);h.appendContent(va,gb);}else if(ab){var hb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(wa){fb="You sent a video.";}else fb=ja._("{sender name} sent a video.",[ja.param("sender name",eb)]);g.addClass(hb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(hb,fb);h.appendContent(va,hb);}else if(bb){var ib=aa[':fb:mercury:attachment-icon-text'].build().getRoot();fb=wa?"You sent a voice message.":la._("{name} sent a voice message.",{name:eb});g.addClass(ib,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(ib,fb);h.appendContent(va,ib);}else if(cb){if(ua.snippet_attachments[0].metadata.stickerID==y.LIKE_STICKER_ID){fb=ia(j.symbols.like);}else fb=wa?"You sent a sticker.":la._("{name} sent a sticker.",{name:eb});h.appendContent(va,fb);}else if(db){var jb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(wa){fb="You shared a link.";}else fb=ja._("{sender name} shared a link.",[ja.param("sender name",eb)]);g.addClass(jb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(jb,fb);h.appendContent(va,jb);}else ua.snippet_attachments.filter(function(kb){return kb.attach_type===n.FILE||kb.attach_type===n.PHOTO||kb.attach_type===n.VIDEO;}).forEach(function(kb){var lb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(lb,kb.name);g.addClass(lb,m.getAttachIconClass(kb.icon_type));h.appendContent(va,lb);});});}function ra(ta,ua){fa(ta).forEach(function(va){h.setContent(va,ua);});}function sa(ta,ua,va,wa){va=fa(va);if(ua.name){var xa=q.renderRawTitleWithUnreadCount(ua.name,wa.show_unread_count?ua.unread_count:0);va.forEach(function(za){h.setContent(za,xa);});wa.callback&&wa.callback(xa);return;}var ya=ua.participants;if(ua.participants.length>1)ya=ua.participants.filter(function(za){return za!=r.getIDForUser(ta._fbid);});r.getMulti(ya,function(za){q.renderParticipantListWithNoThreadName(ta._serverRequests.getServerThreadIDNow(ua.thread_id),ua,ya,za,va,wa);});}e.exports=na;});
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryThreads').get(),l={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(m){return m.mute_settings&&m.mute_settings[l.getUserIDEmail()];},isThreadMuted:function(m){return l.getThreadMuteSettingForUser(m)!==undefined;},showMuteChangeDialog:function(m){g.send(new h('/ajax/mercury/mute_thread_dialog.php'),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600*1000);o/=1000;break;default:o=0;}k.updateThreadMuteSetting(m,o);}.bind(n));});}};e.exports=l;});
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","Link.react","MercuryThreadMuter","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","cx","fbt","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';var s=b('MercuryThreadMetadataRenderer').get(),t=b('MercuryThreads').get(),u=m.Item,v=k.createClass({displayName:'ChatTabMenu',propTypes:{onFileUploaderMounted:k.PropTypes.func,updatePrivacyLinkFunc:k.PropTypes.func,nameConversationFunc:k.PropTypes.func,leaveConversationFunc:k.PropTypes.func,clearHistoryFunc:k.PropTypes.func,reportSpamFunc:k.PropTypes.func,isMultichat:k.PropTypes.bool,showAddFriend:k.PropTypes.func,threadID:k.PropTypes.string,attachmentsShelf:k.PropTypes.object,onUploadFinished:k.PropTypes.func,onUpdateAttachmentsShelf:k.PropTypes.func,onSubmit:k.PropTypes.func},getDefaultProps:function(){return {show:true};},componentWillMount:function(){if(!this.props.isMultiChat)this._privacyActionController=new h(t.getCanonicalUserInThread(this.props.threadID),this.props.updatePrivacyLinkFunc);},componentDidMount:function(){if(!this.props.fullURL){var w=this;s.getWebMessengerURL(this.props.threadID,function(x){w.setProps({fullURL:x});});}},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();},_unmuteThread:function(){t.updateThreadMuteSetting(this.props.threadID,0);o.hide();},_renderFileUploader:function(){return (u(null,g({onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.props.fullURL)return (u({className:"fullConversation"},i({href:this.props.fullURL},"See Full Conversation")));return null;},_renderAddFriend:function(){return (u(null,i({onClick:this.props.showAddFriend},"Add Friends to Chat...")));},_renderTogglePrivacy:function(){if(!this.props.isMultichat){var w=this._privacyActionController.togglePrivacy.bind(this._privacyActionController);return (u(null,i({onClick:w},this.props.privacyText)));}return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var w=j.showMuteChangeDialog.bind(null,this.props.threadID);return (u(null,i({onClick:w},"Mute Conversation...")));}else return (u(null,i({onClick:this._unmuteThread},"Unmute Conversation")));},_renderClearConversation:function(){if(!this.props.isMultichat)return (u(null,i({onClick:this.props.clearHistoryFunc},"Clear Window")));return null;},_renderReportSpam:function(){if(!this.props.isMultichat)return (u(null,i({onClick:this.props.reportSpamFunc},"Report as Spam or Abuse...")));return null;},_renderConversationName:function(){if(this.props.isMultichat&&this.props.fullURL)return (u(null,i({onClick:this.props.nameConversationFunc},"Edit Conversation Name")));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (u(null,i({onClick:this.props.leaveConversationFunc},"Leave Conversation...")));return null;},render:function(){var w=this._renderReportSpam();this.fileUploaderContainer=u(null);var x=m({className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),n(null),this._renderMuteConversation(),this._renderClearConversation(),this._renderLeaveConversation(),w?(n(null)):null,w),y="Options",z=p.getTrackingInfo(p.types.DROPDOWN_BUTTON);return (l({menu:x},k.DOM.a({'data-ft':z,'data-hover':"tooltip",'aria-label':y,'data-tooltip-alignh':"center",className:"button"})));}});e.exports=v;});
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","UserAgent","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=200;function n(){if(k.webkit()&&!k.chrome())return false;var w=i.create('audio'),x=false;try{if(!!w.canPlayType)if(w.canPlayType('video/mp4;').replace(/^no$/,''))x=true;}finally{return x;}}function o(){return j.isAvailable();}var p=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),m);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(p.prototype,{setAudio:function(w,x){this.audio.setAttribute('src',w);this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var q=function(){this.src=null;this.arbiterInstance=null;var w=i.create('div');document.body.appendChild(w);this.swf=j.embed('/swf/SoundStreamPlayer.swf',w,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(q.prototype,{setAudio:function(w,x){this.src=w;this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var w=this.swf.getCurrentTime();this.informAttachment('playing',w);}.bind(this),m);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function r(){if(n()){return new p();}else if(o())return new q();return false;}var s=null,t=null,u=0;function v(w,x){this.src=w;this.arbiterInstance=x;this.audio_id=++u;s!==null||(s=r());if(!s)return false;}l(v.prototype,{getType:function(){if(!s){return false;}else return s.getType();},play:function(w){if(w&&t==this.audio_id){s.resume();}else{this.pause();t=this.audio_id;s.setAudio(this.src,this.arbiterInstance);s.play();}},pause:function(){s.pause();}});e.exports=v;});
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","React","cx","shield","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q='MercuryAttachmentAudioClip/play',r=k.create('mercury_audio_clip'),s=m.createClass({displayName:'AudioClip',mixins:[h],getInitialState:function(){this.subscribe('playing',this.updateTime);this.subscribe('played',o(this.setState,this,{playing:true,started:true}));this.subscribe('paused',o(this.setState,this,{playing:false}));this.subscribe('finished',o(this.setState,this,{playing:false,started:false,time:this.props.duration}));this.logged=false;var t=this.props.downloadOnly?false:new i(this.props.src,this);g.subscribe(q,function(u,v){if(this.props.src!=v)this.setState({time:0});}.bind(this));return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:t};},updateTime:function(t,u){this.setState({time:u});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(q,this.props.src);if(!this.logged){this.logged=true;r.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(t){if(t){t=Math.ceil(t);var u=t%60;if(u<10)u='0'+u;var v=Math.floor(t/60);return v+':'+u;}else return null;},_renderPlayer:function(t,u){return (m.DOM.a({className:"_1miz",style:{width:t},onClick:this.play},m.DOM.span({className:"_1mi-"},m.DOM.i({className:"_1mi_"})),m.DOM.span({className:"_1mj0"},u),m.DOM.div({className:"_1mj1"})));},render:function(){var t=this.state.time,u=this.state.playing,v=this._formatSeconds(this.state.duration),w=this.props.width||170,x=null,y=Math.ceil((t*(w+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var z=this._renderPlayer(w,v),aa=this._renderPlayer(w,v),ba=(("_1mj2")+(u&&(t!==0)?' '+"_1mj3":'')+(u&&(t===0)?' '+"_4g4x":''));x=(m.DOM.div({className:ba},z,m.DOM.div({className:"_1mj4",style:{width:y}},aa)));}else x=(m.DOM.div({className:"_1mj2"},m.DOM.div({className:"_1miz"},l(null,m.DOM.a({className:"_1mj5",href:this.props.src},m.DOM.span({className:"_3qi6"},m.DOM.i({className:"_1mj6"})),m.DOM.span({className:"_1mj7"},"Voice Message"),m.DOM.span({className:"_1mj8"},v)),m.DOM.a({href:this.props.src,className:"_1mj9"},m.DOM.i({className:"_1mja"}))))));return (m.DOM.div({className:"_1mjb"},x));}});e.exports=s;});
__d("ChatAnimatedGifs",["MercuryConfig","URI"],function(a,b,c,d,e,f,g,h){var i={shouldHideBody:function(j){if(!j.has_attachment||!g.AnimatedGifsAttachmentGK)return false;for(var k=0;k<j.attachments.length;k++){var l=j.attachments[k];if(l.preview_url){var m=i.getRawUrlFromSafeUrl(l.preview_url);if(j.body==m)return true;}}return false;},getRawUrlFromSafeUrl:function(j){return h(j).getQueryData().url;}};e.exports=i;});
__d("CroppedImage.react",["Image.react","React","ReactPropTypes","cx"],function(a,b,c,d,e,f,g,h,i,j){var k=h.createClass({displayName:'CroppedImage',propTypes:{center:i.shape({x:i.number.isRequired,y:i.number.isRequired}),crop:i.shape({height:i.number.isRequired,width:i.number.isRequired}).isRequired,size:i.shape({height:i.number.isRequired,width:i.number.isRequired}).isRequired,src:i.string.isRequired},getDefaultProps:function(){return {center:{x:.5,y:.5}};},_calculateMargin:function(l,m,n){return -1*Math.max(Math.min(((n*m)-(.5*l)),m-l),0);},render:function(){var l=this._calculateMargin(this.props.crop.width,this.props.size.width,this.props.center.x),m=this._calculateMargin(this.props.crop.height,this.props.size.height,this.props.center.y),n={left:l,height:this.props.size.height,top:m,width:this.props.size.width};return (h.DOM.div({className:"_46-h",style:this.props.crop},g({alt:this.props.alt||'',className:"_46-i",src:this.props.src,style:n})));}});e.exports=k;});
__d("MercuryAttachmentVideo.react",["CroppedImage.react","Image.react","React","ReactPropTypes","XMessagingVideoAttachmentControllerURIBuilder","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.createClass({displayName:'MercuryAttachmentVideo',propTypes:{duration:j.number.isRequired,name:j.string.isRequired,size:j.shape({height:j.number,width:j.number}),thumbnailSize:j.shape({height:j.number,width:j.number}),thumbnail:j.string,videoID:j.string},_formatDuration:function(){var o=this.props.duration,p=Math.floor(o/60),q=o%60;if(q<10)return p+':0'+q;return p+':'+q;},render:function(){var o=!!this.props.thumbnail,p=(("_zow")+(' '+"_59go")+(!o?' '+"_59gq":'')),q=((!o?"_3l6h":'')+(!o?' '+"uiIconText":'')),r=new k().setInt('video_id',this.props.videoID).setInt('window_width',document.body.clientWidth).getURI();if(this.props.thumbnail)return (i.DOM.div({className:p,style:this.props.size},i.DOM.a({className:q,href:r,role:"button",rel:"async"},g({crop:this.props.size,size:this.props.thumbnailSize,src:this.props.thumbnail}),i.DOM.div({className:"_zox"}),i.DOM.div({className:"_zoy"},h({src:m('/images/chat/chat_play_icon.png')})),i.DOM.span({className:"_zoz"},this._formatDuration()))));return (i.DOM.div({className:p},i.DOM.a({className:q,href:r,role:"button",rel:"async"},h({src:m('/images/icons/video.gif')}),i.DOM.span({className:"_59gp"},this.props.name))));}});e.exports=n;});
__d("SpotlightViewerPagers",["LeftRight.react","Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j){var k=i.createClass({displayName:'SpotlightViewerPagers',render:function(){return (g(null,h({className:"_4-oa _4-ob _50-m"}),h({className:"_4-oa _4-oc _50-m"})));}});e.exports=k;});
__d("SpotlightViewerPageWithKeys",["KeyEventController","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$SpotlightViewerPageWithKeys0=j;}i.prototype.enable=function(){"use strict";this.$SpotlightViewerPageWithKeys1=new h();this.$SpotlightViewerPageWithKeys1.addSubscriptions(g.registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys0.viewState.backward();return false;}.bind(this)),g.registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys0.viewState.forward();return false;}.bind(this)));};i.prototype.disable=function(){"use strict";this.$SpotlightViewerPageWithKeys1.release();delete this.$SpotlightViewerPageWithKeys1;};e.exports=i;});
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f,g,h){var i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;});
__d("SpotlightMessagesViewer",["ArbiterMixin","React","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerThumbnailMixin","SpotlightViewerUnmountOnClose","SpotlightViewport","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=h.createClass({displayName:'SpotlightMessagesViewer',mixins:[g,k,m,q,n],behaviors:[p,r,j],componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getViewerID:function(){return this.props.setid;},getInitialState:function(){this._subscriptions=new t();return {photoData:this._getInitialPhotoData(),open:true,updatingPhoto:false};},_enableSubscriptions:function(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},render:function(){var v=this.getMedia(),w=this.getStageDimensions(),x=this.props.useloadingindicator&&!this.state.photoData;return (i({open:this.state.open,onHide:this.close},s({onClick:this._onClickViewport,stageDimensions:w,media:v,showLoadingIndicator:x},l({onClick:this.close}),this.props.disablepaging?null:o(null))));}});e.exports=u;});
__d("MessagesViewer",["AsyncRequest","DOM","MessagesViewerSetID","PhotoStore","React","SpotlightMessagesViewer","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={bootstrapWithElem:function(o){n.bootstrapWithConfig({fbid:o.getAttribute('data-fbid'),dimensions:o.getAttribute('data-dimensions'),src:o.getAttribute('href'),endpoint:o.getAttribute('data-endpoint'),disablePaging:o.getAttribute('data-disablepaging')},o);},bootstrapWithConfig:function(o,p){var q=o.setID;if(!q)q=i.MESSAGES;var r=l({open:true,setid:q,photoid:o.fbid,thumbsrc:o.src,dimensions:[o.dimensions],disablepaging:o.disablePaging,reverse:false});n.render(r);if(!j.hasBeenCreated(q)){var s=new g(o.endpoint);if(p)s.setRelativeTo(p);s.send();}},render:function(o){var p=m('messages_viewer');if(!p){p=h.create('div',{id:'messages_viewer'});document.body.appendChild(p);}o=k.renderComponent(o,p);o.subscribeOnce('close',function(){h.empty(p);});}};e.exports=n;});
__d("fileSlice",["UserAgent"],function(a,b,c,d,e,f,g){var h='slice',i,j;if(i=g.chrome()){if(i<21)h='webkitSlice';}else if(i=g.firefox()){if(i<13)h='mozSlice';}else if(!(i=g.safari()))if(g.webkit())h='webkitSlice';j=a.File&&a.File.prototype[h];e.exports=j;});
__d("VideoUploadFeatureDetector",["UserAgent","fileSlice"],function(a,b,c,d,e,f,g,h){var i={supportsChunking:function(){return (typeof h==='function')&&this.supportsXHR();},supportsFullProgress:function(){return !g.firefox();},supportsFileAPI:function(){return ('FileList' in window);},supportsFileReading:function(){return ('FileReader' in window&&'DataView' in window);},supportsXHR:function(){return ('FormData' in window);}};e.exports=i;});
__d("VideoUploadFile",["fileSlice","VideoUploadFeatureDetector"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$VideoUploadFile0=j;this.$VideoUploadFile1=i.getExtensionFromFileInput(j);if(h.supportsFileAPI()&&j.files.length){this.$VideoUploadFile2=j.files[0];this.$VideoUploadFile3=this.$VideoUploadFile2.size;}else{this.$VideoUploadFile2=null;this.$VideoUploadFile3=null;}}i.prototype.getFileInput=function(){"use strict";return this.$VideoUploadFile0;};i.prototype.getFile=function(){"use strict";return this.$VideoUploadFile2;};i.prototype.getSize=function(){"use strict";return this.$VideoUploadFile3;};i.prototype.getExtension=function(){"use strict";return this.$VideoUploadFile1;};i.prototype.getChunk=function(j,k){"use strict";return this.$VideoUploadFile2?g.call(this.$VideoUploadFile2,j,k):null;};i.getExtensionFromFileInput=function(j){"use strict";return j.value.indexOf('.')!=-1?j.value.split('.').pop().toLowerCase():'';};e.exports=i;});
__d("ComposerXMediaUploadHandler",["Arbiter","ComposerXController","VideoUploadConfig","VideoUploadFile"],function(a,b,c,d,e,f,g,h,i,j){var k='/ajax/composerx/attachment/media/upload/',l='/ajax/composerx/attachment/video/upload/';function m(n){"use strict";this.$ComposerXMediaUploadHandler0=n;}m.prototype.fetchAttachments=function(){"use strict";h.fetchAttachmentData(this.$ComposerXMediaUploadHandler0,k);h.fetchAttachmentData(this.$ComposerXMediaUploadHandler0,l);};m.prototype.handleFileSelected=function(n){"use strict";if(m.isVideoFile(n)){this.handleVideoSelected(n);}else this.handlePhotoSelected(n);};m.prototype.handleVideoSelected=function(n){"use strict";h.getAttachment(this.$ComposerXMediaUploadHandler0,l);g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/videoupload',{fileInput:n},g.BEHAVIOR_PERSISTENT);};m.prototype.handlePhotoSelected=function(n){"use strict";h.getAttachment(this.$ComposerXMediaUploadHandler0,k);g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/mediaupload',{fileInput:n},g.BEHAVIOR_PERSISTENT);};m.isVideoFile=function(n){"use strict";var o=j.getExtensionFromFileInput(n.getInput());return !!i.videoExtensions[o];};e.exports=m;});
__d("FileInputUploader",["ArbiterMixin","DOM","DTSG","FileForm","Form","copyProperties","mixin","submitForm"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(s,t){"use strict";this._inputElem=s;this._form_container=t?t:document.body;this._data={};}r.prototype.setInput=function(s){"use strict";this._inputElem=s;return this;};r.prototype.setURI=function(s){"use strict";this._uri=s;return this;};r.prototype.setData=function(s){"use strict";this._data=s;return this;};r.prototype.setPreprocessHandler=function(s){"use strict";this._preprocessHandler=s;return this;};r.prototype.setNetworkErrorRetryLimit=function(s){"use strict";this._retryLimit=s;return this;};r.prototype.setFiles=function(s){"use strict";this._files=s;return this;};r.prototype.setAllowCrossOrigin=function(s){"use strict";this._allowCrossOrigin=!!s;return this;};r.prototype.setUploadInParallel=function(s){"use strict";this._uploadInParallel=!!s;return this;};r.prototype.send=function(){"use strict";this._createForm();var s=this._inputElem.cloneNode(false);h.replace(this._inputElem,s);h.appendContent(this._formElem,this._inputElem);h.appendContent(this._form_container,this._formElem);n(this._formElem);h.replace(s,this._inputElem);this._cleanup();};r.prototype._onFileFormEvent=function(s,t){"use strict";this.inform(s,t);};r.prototype._createForm=function(){"use strict";this._formElem=h.create('form',{action:this._uri,method:'post'});this._fileForm=new j(this._formElem,null,{allowCrossOrigin:this._allowCrossOrigin,uploadInParallel:this._uploadInParallel,preprocessHandler:this._preprocessHandler,networkErrorRetryLimit:this._retryLimit});if(this._files)this._fileForm.setFiles(this._files);this._fileForm.subscribe(j.EVENTS,this._onFileFormEvent.bind(this));k.createHiddenInputs(l({fb_dtsg:i.getToken()},this._data),this._formElem);};r.prototype._cleanup=function(){"use strict";this._fileForm.destroy();this._fileForm=null;h.remove(this._formElem);this._formElem=null;};l(r.prototype,{_formElem:null,_fileForm:null,_uri:null,_files:null,_allowCrossOrigin:false,_uploadInParallel:false});e.exports=r;});
__d("str2rstr",[],function(a,b,c,d,e,f){function g(h){var i="",j,k;for(var l=0;l<h.length;l++){j=h.charCodeAt(l);k=l+1<h.length?h.charCodeAt(l+1):0;if(55296<=j&&j<=56319&&56320<=k&&k<=57343){j=65536+((j&1023)<<10)+(k&1023);l++;}if(j<=127){i+=String.fromCharCode(j);}else if(j<=2047){i+=String.fromCharCode(192|((j>>>6)&31),128|(j&63));}else if(j<=65535){i+=String.fromCharCode(224|((j>>>12)&15),128|((j>>>6)&63),128|(j&63));}else if(j<=2097151)i+=String.fromCharCode(240|((j>>>18)&7),128|((j>>>12)&63),128|((j>>>6)&63),128|(j&63));}return i;}e.exports=g;});
__d("md5",["str2rstr"],function(a,b,c,d,e,f,g){function h(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=j(w,x,y,z,v[0],7,-680876936);z=j(z,w,x,y,v[1],12,-389564586);y=j(y,z,w,x,v[2],17,606105819);x=j(x,y,z,w,v[3],22,-1044525330);w=j(w,x,y,z,v[4],7,-176418897);z=j(z,w,x,y,v[5],12,1200080426);y=j(y,z,w,x,v[6],17,-1473231341);x=j(x,y,z,w,v[7],22,-45705983);w=j(w,x,y,z,v[8],7,1770035416);z=j(z,w,x,y,v[9],12,-1958414417);y=j(y,z,w,x,v[10],17,-42063);x=j(x,y,z,w,v[11],22,-1990404162);w=j(w,x,y,z,v[12],7,1804603682);z=j(z,w,x,y,v[13],12,-40341101);y=j(y,z,w,x,v[14],17,-1502002290);x=j(x,y,z,w,v[15],22,1236535329);w=k(w,x,y,z,v[1],5,-165796510);z=k(z,w,x,y,v[6],9,-1069501632);y=k(y,z,w,x,v[11],14,643717713);x=k(x,y,z,w,v[0],20,-373897302);w=k(w,x,y,z,v[5],5,-701558691);z=k(z,w,x,y,v[10],9,38016083);y=k(y,z,w,x,v[15],14,-660478335);x=k(x,y,z,w,v[4],20,-405537848);w=k(w,x,y,z,v[9],5,568446438);z=k(z,w,x,y,v[14],9,-1019803690);y=k(y,z,w,x,v[3],14,-187363961);x=k(x,y,z,w,v[8],20,1163531501);w=k(w,x,y,z,v[13],5,-1444681467);z=k(z,w,x,y,v[2],9,-51403784);y=k(y,z,w,x,v[7],14,1735328473);x=k(x,y,z,w,v[12],20,-1926607734);w=l(w,x,y,z,v[5],4,-378558);z=l(z,w,x,y,v[8],11,-2022574463);y=l(y,z,w,x,v[11],16,1839030562);x=l(x,y,z,w,v[14],23,-35309556);w=l(w,x,y,z,v[1],4,-1530992060);z=l(z,w,x,y,v[4],11,1272893353);y=l(y,z,w,x,v[7],16,-155497632);x=l(x,y,z,w,v[10],23,-1094730640);w=l(w,x,y,z,v[13],4,681279174);z=l(z,w,x,y,v[0],11,-358537222);y=l(y,z,w,x,v[3],16,-722521979);x=l(x,y,z,w,v[6],23,76029189);w=l(w,x,y,z,v[9],4,-640364487);z=l(z,w,x,y,v[12],11,-421815835);y=l(y,z,w,x,v[15],16,530742520);x=l(x,y,z,w,v[2],23,-995338651);w=m(w,x,y,z,v[0],6,-198630844);z=m(z,w,x,y,v[7],10,1126891415);y=m(y,z,w,x,v[14],15,-1416354905);x=m(x,y,z,w,v[5],21,-57434055);w=m(w,x,y,z,v[12],6,1700485571);z=m(z,w,x,y,v[3],10,-1894986606);y=m(y,z,w,x,v[10],15,-1051523);x=m(x,y,z,w,v[1],21,-2054922799);w=m(w,x,y,z,v[8],6,1873313359);z=m(z,w,x,y,v[15],10,-30611744);y=m(y,z,w,x,v[6],15,-1560198380);x=m(x,y,z,w,v[13],21,1309151649);w=m(w,x,y,z,v[4],6,-145523070);z=m(z,w,x,y,v[11],10,-1120210379);y=m(y,z,w,x,v[2],15,718787259);x=m(x,y,z,w,v[9],21,-343485551);u[0]=s(w,u[0]);u[1]=s(x,u[1]);u[2]=s(y,u[2]);u[3]=s(z,u[3]);}function i(u,v,w,x,y,z){v=s(s(v,u),s(x,z));return s((v<<y)|(v>>>(32-y)),w);}function j(u,v,w,x,y,z,aa){return i((v&w)|((~v)&x),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return i((v&x)|(w&(~x)),u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return i(v^w^x,u,v,y,z,aa);}function m(u,v,w,x,y,z,aa){return i(w^(v|(~x)),u,v,y,z,aa);}function n(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)h(w,o(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){h(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;h(w,y);return w;}function o(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var p='0123456789abcdef'.split('');function q(u){var v='',w=0;for(;w<4;w++)v+=p[(u>>((w<<3)+4))&15]+p[(u>>(w<<3))&15];return v;}function r(u){for(var v=0;v<u.length;v++)u[v]=q(u[v]);return u.join('');}var s=function(u,v){return (u+v)&4294967295;};function t(u){if(null===u||undefined===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=g(u);break;}return r(n(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')s=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;});
__d("WaterfallIDGenerator",["CurrentUser","md5"],function(a,b,c,d,e,f,g,h){function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.getID(),j(),i()].join(':'));}};e.exports=k;});
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f,g){function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;});
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;});
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase","copyProperties"],function(a,b,c,d,e,f,g,h,i){'use strict';var j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof(j)=='undefined')j=new k();return j;};function l(){return g.forced;}i(k.prototype,h.prototype,{decideIfSampled:l});e.exports=k;});
/**
 * @generated SignedSource<<091461a353d9b40c12f5a66d653a6b62>>
 * 
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * 
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;});
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f,g){'use strict';var h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;});
__d("guardFunction",[],function(a,b,c,d,e,f){function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;});
__d("Fbtrace",["Arbiter","BanzaiScribe","ErrorUtils","FbtraceForcedByServer","FbtraceForcedByServerPolicy","Random","SiteData","copyProperties","guardFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',q='AAAAAAAAAAA';for(var r in Error)if(Error.hasOwnProperty(r))t[r]=Error[r];var s=Error===null?null:Error.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=Error;function t(ia){Error.call(this,ia);}function u(ia){i.reportError(new t(ia));}function v(){var ia=function(){var la=0,ma=0,na='';for(var oa=10;oa>=0;oa--){if(la<6){ma=l.uint32();la=32;}if(oa===0)ma=ma&7;na=p.charAt(ma&63)+na;ma>>=6;la-=6;}return na;},ja,ka;for(ja=3;ja>0;ja--){ka=ia();if(ka!=q)return ka;}u('failed to generate valid Fbtrace id');return q;}function w(){n(this,w);}n(w,{isOn:function(){return false;},replySend:function(ia,ja){},requestSend:function(ia,ja,ka){ca(ia,ja);return {metadata:function(){return undefined;},replyReceive:function(la){}};}});var x=new w();function y(ia,ja,ka){if(!ia)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ja)throw {name:'ArgumentError',message:'no valid version specified'};var la=h,ma=0,na=v(),oa=v(),pa=ba(na),qa={service:ia,version:ja},ra=function(wa){if(typeof(wa)=='undefined')return 'undefined';if(typeof(wa)!='string')wa=ra(JSON.stringify(wa));return wa;},sa=function(wa){var xa='';for(var ya in wa){if(xa.length>0)xa+='\x02';xa+=ra(ya)+'\x03'+ra(wa[ya]);}return xa;},ta=function(wa,xa,event,ya,za){ma++;return [za,ma,na,wa,xa,ra(event),sa(ya)].join('\x01');},ua=function(wa,xa,event,ya,za){if(!za&&typeof(za)=='undefined')za=Date.now()*1000;var ab=ta(wa,xa,event,ya,za);la.log('fbtrace',ab,pa);},va=function(){return oa;};ua(q,oa,'#rqrecv',n(ka,qa));n(this,y);n(this,{replySend:function(wa,xa){xa=n(xa,qa,{success:wa?'true':'false'});ua(q,oa,'#rpsend',xa);},requestSend:function(wa,xa,ya){ca(wa,xa);var za=va(),ab=v();ya=n(ya,qa,{op:wa,'remote:service':xa});ua(za,ab,'#rqsend',ya);return {metadata:function(){return na+ab;},replyReceive:function(bb){ua(za,ab,'#rprecv',n(bb,qa));},parentNode:this};}});}n(y,{isOn:function(){return true;}});function z(){return x;}function aa(ia,ja,ka){ka=ka||{};ka.init=true;var la=k.get();if(la.isSampled()){return new y(ia,ja,ka);}else return new w();}function ba(ia){var ja=ia.charAt(ia.length-1);return p.indexOf(ja)%32;}function ca(ia,ja){if(!ia)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ja)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function da(ia,ja){var ka=x,la;x=ia;try{la=ja();}finally{x=ka;}return la;}var ea=function(ia,ja){var ka=z(),la=ja.request;if(!ka.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(la.uri.toString()))ka=aa('photo_upload_kludge',String(m.revision||'dev'),{policy:'PhotoUpload'});if(ka.isOn()){var ma={policy:'PhotoUpload'};if(la.userActionId)ma.user_action_id=la.userActionId;var na=ka.requestSend(la.uri.toString(),'www',ma);la.fbtraceRemoteNode=na;la.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},fa=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:true});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},ga=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:false,error_code:ja.response.error,error_summary:ja.response.errorSummary,error_description:ja.response.errorDescription});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ha=function(ia,ja){return ja.request.fbtraceRemoteNode;};g.subscribe('AsyncRequest/send',ea);g.subscribe('AsyncRequest/response',o(ha,fa));g.subscribe('AsyncRequest/error',o(ha,ga));e.exports={defaultNode:z,requestReceive:aa,withDefaultNode:da};});
__d("PhotosMultiUploadInput",["Arbiter","Animation","AsyncUploadRequest","ComposerXController","ComposerXDragDrop","ComposerXMediaUploadHandler","CSS","Dialog","DOM","DOMQuery","DragDropTarget","Event","FileInputUploader","JpegResizer","JSLogger","Parent","PhotosMimeType","PhotosUploadID","PhotosUploadWaterfallXMixin","PUWApplications","PUWMethods","PUWSteps","ProgressBar","WaterfallIDGenerator","$","copyProperties","createArrayFrom","csx","cx","mixin","performanceNow","tx","Fbtrace"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){var ma=u.create('composer');b("Fbtrace");function na(wa,xa,ya,za){"use strict";this._grid=ta.getInstance(za.gridID);this._grid.setProgressBarMarkup(wa).setVideoIconMarkup(xa).setConfig(za);ya.getInput().multiple=(za.maxselect!=1)&&i.isSupported();ya.subscribe('change',function(ab,event){if(event.getTarget().value)this._grid.doFileUpload(ya);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(ba.CLIENT_FLOW_BEGIN);}this._grid.logStep(ba.CLIENT_SELECT_BEGIN);g.inform('PhotosMultiUploadInput/loaded/'+za.gridID,g.BEHAVIOR_PERSISTENT);}na.prototype.getGrid=function(){"use strict";return this._grid;};fa(na,{imageUploadDone:function(wa,xa,ya,za){oa[wa].imageUploadDone(xa,ya,za);},initDragDrop:function(wa,xa){g.inform('PhotosMultiUploadInput/initDragDrop/'+wa,{dragDropArea:xa},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(wa,xa){oa[wa].removeLoadingIndicator(xa.getFile().uploadID);},doFileUpload:function(wa,xa){oa[wa].doFileUpload(xa);},onFilesDrop:function(wa,xa){oa[wa].onFilesDrop(xa);},getWaterfallID:function(wa){return ta.getInstance(wa).getWaterfallID();},clearSession:function(wa){oa[wa].clearSession();},getConfig:function(wa){return oa[wa].getConfig();},updateProgressBar:function(wa,event){if(event.loaded!=event.total){wa.setPosition(50*event.loaded/event.total);}else{wa.setPosition(50);wa.setTarget(100,2000);}}});var oa={},pa=0,qa=ja(y);for(var ra in qa)if(qa.hasOwnProperty(ra))ta[ra]=qa[ra];var sa=qa===null?null:qa.prototype;ta.prototype=Object.create(sa);ta.prototype.constructor=ta;ta.__superConstructor__=qa;function ta(wa){"use strict";this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=wa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;g.subscribe('multi-upload/video-removed/'+this._gridID,function(){o.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(xa){xa.clear();});}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+wa,function(xa,ya){this.initDragDrop(ya.dragDropArea);}.bind(this));g.subscribe('AttachmentsPhotoEditor/newImage'+wa,this._onEditedImage.bind(this));}ta.prototype.getWaterfallID=function(){"use strict";if(!this._waterfallID)this._waterfallID=da.generate();return this._waterfallID;};ta.prototype.getWaterfallAppName=function(){"use strict";return z.WEB_COMPOSER;};ta.prototype.getLoadingIndicator=function(wa){"use strict";var xa=this._loadingIndicators[wa];return xa;};ta.prototype.initDragDrop=function(wa){"use strict";this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new q(wa).setOnFilesDropCallback(this.onFilesDrop.bind(this)).setFileFilter(k.filterImages).enable();};ta.prototype.setConfig=function(wa){"use strict";this._config=wa;if(!t.isSupported()){this.logStep(ba.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer)this._resizer=new t(this._config.maxselect===1?1:t.DEFAULT_POOL_SIZE);if(!this._waterfallID)this._waterfallID=wa.waterfallID;return this;};ta.prototype.setProgressBarMarkup=function(wa){"use strict";this._progressBarMarkup=wa;return this;};ta.prototype.setVideoIconMarkup=function(wa){"use strict";this._videoIconMarkup=wa;var xa=o.find(wa,"._3ev");r.listen(xa,'click',this._onVideoRemoved.bind(this));return this;};ta.prototype.imageUploadDone=function(wa,xa,ya){"use strict";this._numUploadsSucceeded++;var za=this.getLoadingIndicator(xa);if(!za)return;if(o.contains(document.body,za.getRoot()))o.replace(za.getRoot(),wa);g.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:[ya],tagInfo:{}});this._numRemainingFiles--;if(this._numRemainingFiles===0)this._finishUploadBatch();this._loadingIndicators[xa]=null;};ta.prototype._generateLoadingIndicator=function(wa){"use strict";this._numRemainingFiles++;var xa=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(xa);this._loadingIndicators[wa]=new ca(xa);};ta.prototype._generateUploadIDsAndLoadingIndicators=function(wa){"use strict";for(var xa=0;xa<wa.length;xa++){if(!wa[xa].uploadID)wa[xa].uploadID=x.getNewID();this._generateLoadingIndicator(wa[xa].uploadID);}};ta.prototype.fileUploadFailure=function(wa,xa){"use strict";this._numUploadsFailed++;var ya=Date.now()-this._uploadTimers[wa],za=0;if(xa.upload)za=xa.upload.getRetryCount?xa.upload.getRetryCount():0;this.logStep(ba.CLIENT_TRANSFER_FAIL,{dt:ya,error_code:xa.response?xa.response.getError():undefined,bytes:xa.upload?xa.upload.getFile().size:null,auto_retry_count:za});this._showUploadFailedMessage(wa);this._fadeOutFileUpload(wa);};ta.prototype._fadeOutFileUpload=function(wa){"use strict";new h(this.getLoadingIndicator(wa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,wa)).go();};ta.prototype._showUploadFailedMessage=function(wa){"use strict";m.hide(p.find(this.getLoadingIndicator(wa).getRoot(),"._5l83"));m.show(p.find(this.getLoadingIndicator(wa).getRoot(),"._5l82"));};ta.prototype._finishUploadBatch=function(){"use strict";g.inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(ba.CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(ba.CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};ta.prototype.fileUploadCanceled=function(wa,xa){"use strict";var ya={latency:Date.now()-this._uploadTimers[wa]};if(xa.upload&&xa.upload.getFile())ya.bytes=xa.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_CANCEL,ya);this.removeFileUpload(wa);};ta.prototype.removeFileUpload=function(wa){"use strict";this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(wa);if(this._numRemainingFiles===0)this._finishUploadBatch();};ta.prototype.doFileUpload=function(wa){"use strict";var xa=false,ya=false;switch(this._config.supportedFileTypes){case 'photos':ya=true;break;case 'videos':xa=true;break;case 'both':xa=ya=true;break;}var za=xa&&l.isVideoFile(wa);this._submitListener&&this._submitListener.remove();if(za){var ab=v.byTag(ea(this._gridID),'form'),bb=j.getComposerID(ab),cb=new l(bb);cb.handleVideoSelected(wa);}else if(ya){this._photosSelected(wa);}else new n().setBody("Sorry, you can only select video files.").setTitle("Unsupported File").setModal(true).setButtons(n.OK).show();};ta.prototype.getConfig=function(){"use strict";return this._config;};ta.prototype._resizeUpload=function(wa,xa){"use strict";var ya=wa.getFile();if(!ya||!w(ya.type).isJpeg())return xa(wa);var za=ka();this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:ya.size});this._resizer.resizeBlob(ya,function(ab,bb,cb){bb=bb||ya;if(ab){this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:ka()-za,bytes:bb.size,error_code:ab.message});return xa(wa);}bb.uploadID=ya.uploadID;wa.setFile(bb);this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:ka()-za,media_data_size:ya.size,bytes:bb.size,custom_tags:{skipped_resizing:cb}});xa(wa);}.bind(this),this._onResizeProgress.bind(this,ya.uploadID));};ta.prototype._isExceedMaxSelect=function(wa){"use strict";return this._config.maxselect>1&&wa>this._config.maxselect;};ta.prototype._showTooManyPhotosDialog=function(){"use strict";new n().setTitle("Too Many Photos").setBody(la._("Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages.",{maxselect:this._config.maxselect})).setButtons(n.OK).setModal(true).show();};ta.prototype._photosSelected=function(wa){"use strict";var xa=wa.getInput(),ya=ua(xa);if(this._isExceedMaxSelect(ya)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();var za=this._config.uploadData,ab=null;if(!va(xa)){xa.uploadID=x.getNewID();this._generateLoadingIndicator(xa.uploadID);za.upload_id=xa.uploadID;}else{ab=ga(xa.files);this._generateUploadIDsAndLoadingIndicators(ab);}g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:ya});if(this._config.waterfallID)za.qn=this._config.waterfallID;var bb=new s(xa).setURI(this._config.photoEndpoint).setData(za).setAllowCrossOrigin(true).setNetworkErrorRetryLimit(this._config.retryLimit).setUploadInParallel(true);if(ab){bb.setFiles(ab);if(this._resizer)bb.setPreprocessHandler(this._resizeUpload.bind(this));}bb.subscribe('progress',function(db,eb){this._onUploadProgress(this._getUploadID(eb,xa),eb);}.bind(this));bb.subscribe('failure',function(db,eb){this.fileUploadFailure(this._getUploadID(eb,xa),eb);}.bind(this));bb.subscribe('start',function(db,eb){this._onFileUploadStart(this._getUploadID(eb,xa),eb);}.bind(this));bb.subscribe('success',function(db,eb){this._onFileUploadSuccess(this._getUploadID(eb,xa),eb);}.bind(this));try{bb.send();wa.clear();}catch(cb){ma.error('error_send_unpublished_files',cb);throw cb;}this.logStep(ba.CLIENT_SELECT_SUCCESS,{times_selected:pa++,volume:ya,method:'file_selector'});};ta.prototype._onVideoRemoved=function(){"use strict";this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);};ta.prototype.removeLoadingIndicator=function(wa){"use strict";var xa=this.getLoadingIndicator(wa);xa&&o.remove(xa.getRoot());delete this._loadingIndicators[wa];};ta.prototype._onFileUploadStart=function(wa,xa){"use strict";var ya=o.find(this.getLoadingIndicator(wa).getRoot(),"._639");m.show(ya);r.listen(ya,'click',function(){if(xa.upload)xa.upload.abort();this.fileUploadCanceled(wa,xa);}.bind(this));this._uploadTimers[wa]=Date.now();var za={};if(xa.upload&&xa.upload.getFile())za.size=xa.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_BEGIN,za);};ta.prototype._onUploadProgress=function(wa,xa){"use strict";var ya=this.getLoadingIndicator(wa);if(!ya)return;this._showProgressBar(ya);m.removeClass(ya.getRoot(),"_5v_0");na.updateProgressBar(ya,xa.event);};ta.prototype._onResizeProgress=function(wa,event){"use strict";var xa=this.getLoadingIndicator(wa);if(!xa)return;this._showProgressBar(xa);m.addClass(xa.getRoot(),"_5v_0");xa.setPosition(100*event.written/event.total);};ta.prototype._showProgressBar=function(wa){"use strict";m.hide(o.find(wa.getRoot(),"._2om"));m.show(o.find(wa.getRoot(),"._5e4h"));};ta.prototype._onFileUploadSuccess=function(wa,xa){"use strict";var ya=Date.now()-this._uploadTimers[wa],za={dt:ya};if(xa.upload){za.bytes=xa.upload.getFile().size;za.auto_retry_count=xa.upload.getRetryCount?xa.upload.getRetryCount():0;}this.logStep(ba.CLIENT_TRANSFER_SUCCESS,za);};ta.prototype._onEditedImage=function(wa,xa){"use strict";this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([xa]);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:aa.EDITOR});var ya=new i().setData(this._config.uploadData).setFiles([xa]).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);ya.subscribe('failure',function(za,ab){this.fileUploadFailure(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.subscribe('progress',function(za,ab){this._onUploadProgress(ab.getFile().uploadID,{upload:ab,event:ab.getProgressEvent()});}.bind(this));ya.subscribe('start',function(za,ab){this._onFileUploadStart(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.subscribe('success',function(za,ab){this._onFileUploadSuccess(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:1,method:aa.EDITOR});};ta.prototype.onFilesDrop=function(wa){"use strict";if(this._isExceedMaxSelect(wa.length)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(wa);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:wa.length,method:aa.DRAGDROP||'dragdrop'});var xa=new i().setData(this._config.uploadData).setFiles(wa).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);xa.subscribe('failure',function(ya,za){this.fileUploadFailure(za.getFile().uploadID,{upload:za});}.bind(this));xa.subscribe('progress',function(ya,za){this._onUploadProgress(za.getFile().uploadID,{upload:za,event:za.getProgressEvent()});}.bind(this));xa.subscribe('start',function(ya,za){this._onFileUploadStart(za.getFile().uploadID,{upload:za});}.bind(this));xa.subscribe('success',function(ya,za){this._onFileUploadSuccess(za.getFile().uploadID,{upload:za});}.bind(this));xa.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:wa.length,method:'drag_drop'});};ta.prototype._onBeforeAddUploadedImages=function(){"use strict";if(!this.sessionStarted)this.logStep(ba.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ta.prototype.clearSession=function(){"use strict";this.sessionStarted=false;};ta.prototype.insertIntoGrid=function(wa){"use strict";var xa=o.scry(ea(this._gridID),"._577")[0];if(xa){o.insertBefore(xa,wa);}else o.prependContent(ea(this._gridID),wa);};ta.prototype._getUploadID=function(wa,xa){"use strict";if(wa.upload){return wa.upload.getFile().uploadID;}else return xa.uploadID;};ta.getInstance=function(wa){"use strict";oa[wa]=oa[wa]||new ta(wa);return oa[wa];};function ua(wa){if(!va(wa))return 1;return wa.files.length;}function va(wa){return !!wa.files&&i.isSupported();}e.exports=na;});
__d("XLinkshimLogControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f,g){e.exports=g.create("\/si\/ajax\/l\/render_linkshim_log\/",{u:{type:"String",required:true},h:{type:"String",required:true},render_verification:{type:"Bool"},enc:{type:"String"}});});
__d("LinkshimHandler",["Event","LinkshimAsyncLink","LinkshimHandlerConfig","URI","XLinkshimLogControllerURIBuilder","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={setUpLinkshimHandling:function(s){try{var u=j(s.getAttribute('href')),v=n(u);if(v&&o(u)){g.listen(s,'mouseover',l(h.swap,null,s,v));var w=q(u);g.listen(s,'click',function(){if(i.supports_meta_referrer){h.referrer_log(s,w,p(u).toString());}else h.swap(s,u);});}}catch(t){}}};function n(s){return s.getQueryData().u?new j(s.getQueryData().u):null;}function o(s){return s.getQueryData().hasOwnProperty('s');}function p(s){var t=s.getQueryData().hasOwnProperty('enc')?s.getQueryData().enc:'';return (new k()).setString('u',s.getQueryData().u).setString('h',s.getQueryData().h).setBool('render_verification',s.getQueryData().hasOwnProperty('render_verification')).setString('enc',t).getURI();}function q(s){var t;if(r()){t=j(s).addQueryData({render_verification:true});}else t=n(s);return t;}function r(){var s=i.render_verification_rate||0;return Math.floor(Math.random()*s+1)===s;}e.exports=m;});
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","ChatAnimatedGifs","GameInvite.react","CSS","MercuryConstants","DOM","Event","JSXDOM","MercuryAttachment","MercuryAttachmentType","MercuryAttachmentVideo.react","MercuryConfig","MercuryParticipants","MessagesViewer","PhotosMultiUploadInput","ProgressBar","React","Sticker.react","Style","URI","UserAgent","cx","endsWith","invariant","tx","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){"use strict";var ga=b('MercuryMessages').get(),ha=ba.ie()<=8;function ia(la,ma){var na=g[ma].build().setNodeContent('filename',la.name),oa=na.getNode('link');oa.setAttribute('href',la.url);la.rel&&oa.setAttribute('rel',la.rel);k.addClass(na.getRoot(),p.getAttachIconClass(la.icon_type));return na;}function ja(la,ma){var na=g[ma].build().setNodeContent('filename',la.name);k.addClass(na.getRoot(),p.getAttachIconClass(la.icon_type));return na;}var ka={renderAttachment:function(la,ma,na,oa,pa,qa){var ra=100,sa=la?160:400,ta=null,ua=null,va=l.MercurySupportedShareType;if(this.isErrorAttachment(ma))ta=ka.renderError(ma);if(this.isShareAttachment(ma)&&ma.share_xhp)if(ma.share_data_type===va.FB_BROWSE_QUERY||!la)ua=ka.renderShareXHP(ma,na.id);if(this.isStickerAttachment(ma))ua=ka.renderSticker(ma,na,la,qa);if(!ua&&this.isShareAttachment(ma)){var wa=ma.share_data_type;switch(wa){case va.FB_PHOTO:ua=ka.renderPreview(ma,na,oa,pa);break;case va.FB_VIDEO:ua=ka.renderVideoThumb(ma);break;case va.FB_MUSIC_ALBUM:case va.FB_SONG:case va.FB_PLAYLIST:case va.FB_MUSICIAN:case va.FB_RADIO_STATION:ua=ka.renderMusic(ma);break;case va.EXTERNAL:case va.FB_TEMPLATE:case va.FB_SOCIAL_REPORT_PHOTO:ua=ka.renderExternalLink(ma);break;case va.FB_COUPON:case va.FB_EVENT:ua=ka.renderChatXHP(ma);break;case va.FB_SOCIAL_RESOLUTION:case va.FB_STATUS:ua=ka.renderSocialResolution(ma);break;case va.FB_GAME_INVITE:ua=ka.renderGameInvite(ma);break;case va.FB_OPEN_GRAPH:ua=ka.renderOpenGraph(ma);break;default:if(ma.name)ua=ka.renderShareLink(ma,na&&na.id,la);break;}}if(!ua&&ma.preview_loading)ua=ka.renderPreview(ma,na,oa,pa);if(!ua&&this.isVideoAttachment(ma)){ua=m.create('div');x.renderComponent(ka.renderVideo(ma,la),ua);}if(!ua&&ma.preview_url)ua=ka.renderPreview(ma,na,oa,pa);if(!ua&&this.isFileAttachment(ma))if(ma.metadata&&ma.metadata.type==l.MercuryAttachmentAudioClip){ua=m.create('div');var xa=ka.renderAudioClip(ma,na.message_id,ra,sa);x.renderComponent(xa,ua);}else ua=la?ka.renderFileLink(ma):ka.renderExtendedFileLink(ma);return {error:ta,content:ua,bubblePreferred:this.isBubblePreferred(ma)};},isBubblePreferred:function(la){return !this.isStickerAttachment(la)&&!this.isGameInviteAttachment(la);},renderError:function(la){var ma=g[':fb:mercury:attachment:error'].build();m.appendContent(ma.getNode('error'),la.error_msg);return ma.getRoot();},renderSocialResolution:function(la){var ma=g[':fb:mercury:attachment:social-resolution'].build();ma.setNodeContent('post',la.share_xhp);return ma.getRoot();},renderChatXHP:function(la){var ma=g[':fb:mercury:attachment:social-resolution'].build();ma.setNodeContent('post',la.chat_xhp);return ma.getRoot();},renderOpenGraph:function(la){var ma=la.share_xhp.cloneNode(true);if(ba.firefox())z.set(ma,'minWidth','180px');return ma;},renderExternalLink:function(la){var ma=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',la.name);la.base_url&&ma.setNodeContent('shortLink',la.base_url);var na=ma.getNode('preview'),oa=ma.getNode('image-link');oa.setAttribute('href',la.url);la.rel&&oa.setAttribute('rel',la.rel);if(la.preview_url){var pa=ma.getNode('preview-image'),qa=la.preview_url;if(s.AnimatedGifsAttachmentGK){var ra=aa(i.getRawUrlFromSafeUrl(qa));if(da(ra.getPath(),'.gif')){qa=aa('/animated.php').setSecure(true).setDomain('www.fbsbx.com').addQueryData('url',ra.toString());if(s.ChatReactUserMessagesGK){k.addClass(na,"_dri");}else k.addClass(na,"_z_i");if(la.name&&la.name.__html==ra.toString())ma.setNodeContent('name','');}}pa.setAttribute('src',qa);k.addClass(na,la.preview_class);k.show(pa);}else{k.addClass(ma.getRoot(),'noMedia');k.hide(na);}ma.getNode('name').setAttribute('href',la.url);d(['LinkshimHandler'],function(sa){sa.setUpLinkshimHandling(ma.getNode('name'));sa.setUpLinkshimHandling(ma.getNode('image-link'));});if(la.rel)ma.getNode('name').setAttribute('rel',la.rel);return ma.getRoot();},renderFileLink:function(la){var ma=null;if(la.url===''){ma=':fb:mercury:attachment:file-name';return ja(la,ma).getRoot();}else{ma=':fb:mercury:attachment:file-link';return ia(la,ma).getRoot();}},renderAudioClip:function(la,ma,na,oa){var pa=la.metadata.duration/1000,qa=200;if(na&&oa)if(pa<5){qa=na;}else qa=(1-Math.pow(10,(pa-5)/-30))*(oa-na)+na;return h({src:la.url,duration:la.metadata.duration/1000,showHelp:false,width:qa});},renderVideo:function(la,ma){var na={height:la.preview_height,width:la.preview_width},oa=ma?{width:160,height:120}:{width:266,height:200};return r({duration:la.metadata.duration,name:la.name,size:oa,thumbnailSize:na,thumbnail:la.thumbnail_url,videoID:la.metadata.fbid});},renderExtendedFileLink:function(la){var ma=null;if(la.url===''){ma=':fb:mercury:attachment:file-name';return ja(la,ma).getRoot();}ma=':fb:mercury:attachment:extended-file-link';var na=ia(la,ma);if(la.open_url){var oa=na.getNode('openLinkContainer');k.show(oa);var pa=na.getNode('openFile');pa.setAttribute('href',la.open_url);}var qa=na.getNode('downloadFile');qa.setAttribute('href',la.url);la.rel&&qa.setAttribute('rel',la.rel);return na.getRoot();},renderMusic:function(la){var ma=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',la.name),na=ma.getNode('link');na.setAttribute('href',la.url);na.setAttribute('target','_blank');la.rel&&na.setAttribute('rel',la.rel);var oa=ma.getNode('image-link');oa.setAttribute('href',la.url);la.rel&&oa.setAttribute('rel',la.rel);var pa=ma.getNode('preview-image');pa.setAttribute('src',la.preview_url);k.show(pa);k.addClass(ma.getNode('icon_link'),'MercuryMusicIcon');return ma.getRoot();},renderGameInvite:function(la){var ma=j(la.metadata),na=m.create('div');x.renderComponent(ma,na);return na;},resizeContain:function(la,ma){var na=la.width/la.height,oa=ma.width/ma.height;if(oa<na){return {width:Math.min(la.height*oa,ma.width),height:Math.min(la.height,ma.height)};}else return {width:Math.min(la.width,ma.width),height:Math.min(la.width/oa,ma.height)};},renderPreview:function(la,ma,na,oa){var pa=g[':fb:mercury:attachment:preview'].build(),qa=pa.getNode('image-link');if(la){if(la.url){var ra=new aa(la.url).getQueryData().uri;if(ra&&la.rel==='async'){qa.setAttribute('href',ra);qa.setAttribute('ajaxify',la.url);}else qa.setAttribute('href',la.url);}la.rel&&qa.setAttribute('rel',la.rel);var sa;if(la.preview_uploading){var ta=pa.getNode('cancel-button-container');k.show(ta);var ua=pa.getNode('cancel-button'),va=n.listen(ua,'click',function(){la.upload_canceled(la.upload_id);k.hide(pa.getRoot());va.remove();});la.on_success(function(event,cb){if(cb.upload_id==la.upload_id){k.hide(ta);va.remove();}});var wa=pa.getNode('progress-bar'),xa=new w(wa),ya=pa.getNode('progress-bar-container');ea(la.upload_id);la.on_progress(function(event,cb){if(cb.upload_id==la.upload_id){k.removeClass(ya,"_395w");k.show(ya);v.updateProgressBar(xa,cb.event);}});if(la.on_resizing_progress)la.on_resizing_progress(function(event,cb){if(cb.upload_id==la.upload_id){k.addClass(ya,"_395w");k.show(ya);xa.setPosition(100*cb.event.written/cb.event.total);}});k.addClass(qa,"_57jm");if(na>=176){sa='/images/photos/dots_large.png';}else if(na>=86){sa='/images/photos/dots_medium.png';}else sa='/images/photos/dots_small.png';z.set(qa,'width',na+'px');z.set(qa,'max-width',na+'px');if(la.preview_width&&la.preview_height)z.set(qa,'padding-bottom',((la.preview_height/la.preview_width)*100)+'%');}else if(la.preview_loading){k.addClass(qa,"_5xdv");if(oa==='contain'&&la.preview_width&&la.preview_height){z.set(qa,'width',la.preview_width+'px');z.set(qa,'height',la.preview_height+'px');}if(oa==='cover'&&!ha)k.addClass(qa,"_55pj");}else if(la.metadata&&la.metadata.fbid){sa=aa('/ajax/mercury/attachments/photo.php').addQueryData({fbid:la.metadata.fbid,request_user_id:la.metadata.pageid,mode:oa,width:na,height:na}).toString();var za=qa.getAttribute('ajaxify');qa.removeAttribute('ajaxify');qa.removeAttribute('rel');n.listen(qa,'click',function(event){u.bootstrapWithConfig({src:sa,endpoint:za,fbid:la.metadata.fbid,dimensions:la.metadata.dimensions,disablePaging:ma.attachments.length==1},qa);event.prevent();});}else sa=aa(la.preview_url).addQueryData({mode:oa,width:na,height:na}).toString();var ab=pa.getNode('preview-image');if(sa){if(oa==='contain'&&la.preview_width&&la.preview_height){var bb=ka.resizeContain({width:na,height:na},{width:la.preview_width,height:la.preview_height});ab.setAttribute('width',bb.width);ab.setAttribute('height',bb.height);}if(la.preview_uploading||(oa==='cover'&&!ha)){k.addClass(qa,"_55pj");z.set(qa,'backgroundImage','url('+sa+')');}else{ab.onload=function(){ab.removeAttribute('width');ab.removeAttribute('height');};ab.setAttribute('src',sa);}}if(ma)this.renderReportRespondLink(pa.getRoot(),la,ma.message_id);}return pa.getRoot();},renderShareLink:function(la,ma,na){var oa=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',la.name),pa=oa.getNode('link');pa.setAttribute('href',la.url);la.rel&&pa.setAttribute('rel',la.rel);return oa.getRoot();},renderVideoThumb:function(la){var ma=g[':fb:mercury:attachment:video-thumb'].build(),na=ma.getNode('thumb');na.setAttribute('href',la.url);na.setAttribute('rel',la.rel);var oa=m.find(ma.getRoot(),'img');oa.src=la.preview_url;return ma.getRoot();},renderShareXHP:function(la,ma){var na=m.create('div');if(la){m.appendContent(na,la.share_xhp);this.renderReportRespondLink(na,la,ma);}return na;},renderSticker:function(la,ma,na,oa){var pa=na?'chatScrolled/':'messengerScrolled/';pa+=ma.thread_id;var qa=m.create('div'),ra=null;if(la.metadata.stickerID)ra=la.metadata.stickerID.toString();var sa=null;if(la.metadata.packID)sa=la.metadata.packID.toString();var ta=y({animationTrigger:'hover',className:'mvs',frameCount:la.metadata.frameCount||1,frameRate:la.metadata.frameRate||83,framesPerCol:la.metadata.framesPerCol||1,framesPerRow:la.metadata.framesPerRow||1,onStickerClick:oa,packID:sa,sourceHeight:la.metadata.height,sourceURI:la.url,sourceWidth:la.metadata.width,spriteURI:la.metadata.spriteURI,stickerID:ra,subscribedThreadID:pa});x.renderComponent(ta,qa);return qa;},renderReportRespondLink:function(la,ma,na){if(!ma.is_social_report_attachment)return null;switch(ma.share_data_type){case l.MercurySupportedShareType.FB_PHOTO:break;case l.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var oa=null;if(na)oa=ga.getMessagesFromIDs([na])[0];if(!oa)return null;if(oa.author===t.user)return null;var pa=null;t.get(oa.author,function(qa){pa=m.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:aa('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:ma.attach_id,post_fbid:ma.shared_object_id,sender_id:t.getUserID(qa.id)}).toString()});m.setContent(pa,fa._("Respond to {name}'s request",{name:qa.name}));m.appendContent(la,pa);});},renderPhotoAttachments:function(la,ma,na,oa){var pa=la.length;if(!pa)return null;var qa=o.div({className:"_55pk"});if(pa===1){var ra=ka.renderPreview(la[0],ma,na,'contain');m.appendContent(qa,ra);return qa;}var sa=(pa==2||pa==4)?2:3,ta=(na-(sa-1)*oa)/sa,ua=Math.ceil(pa/sa),va=ua*ta+(ua-1)*oa,wa=(o.div({className:"_55pm",style:'padding-bottom: '+(va/na*100)+'%;'}));m.appendContent(qa,wa);for(var xa=0;xa<pa;++xa){var ya=ka.renderPreview(la[xa],ma,ta,'cover'),za=xa%sa,ab=Math.floor(xa/sa);k.addClass(ya,"_55pn");z.apply(ya,{width:(ta/na*100)+'%',left:((za*(ta+oa))/na*100)+'%',top:((ab*(ta+oa))/va*100)+'%'});m.appendContent(wa,ya);}return qa;},isPhotoAttachment:function(la){return la.attach_type==q.PHOTO||(la.attach_type==q.FILE&&la.preview_url);},isVideoAttachment:function(la){return la.attach_type==q.VIDEO;},isShareAttachment:function(la){return la.attach_type==q.SHARE;},isFileAttachment:function(la){return la.attach_type==q.FILE;},isErrorAttachment:function(la){return la.attach_type==q.ERROR;},isStickerAttachment:function(la){return la.attach_type==q.STICKER;},isGameInviteAttachment:function(la){var ma=l.MercurySupportedShareType;return this.isShareAttachment(la)&&la.share_data_type==ma.FB_GAME_INVITE;},booleanLexicographicComparator:function(la){return function(ma,na){for(var oa=0;oa<la.length;++oa){var pa=la[oa](ma),qa=la[oa](na);if(pa&&!qa){return -1;}else if(!pa&&qa)return 1;}return 0;};}};e.exports=ka;});
__d("ChatDateBreak.react",["React","ReactPropTypes","Timestamp.react","cx","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.createClass({displayName:'ChatDateBreak',propTypes:{date:h.instanceOf(Date).isRequired},shouldComponentUpdate:function(m){return this.props.date.getTime()!==m.date.getTime();},render:function(){var m=this.props.date,n=k(m,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),o=Math.round(m.getTime()/1000);return this.transferPropsTo(g.DOM.div({className:"_5w-5"},g.DOM.div({className:"_5w-6"},i({time:o,verbose:n,text:n}))));}});e.exports=l;});
__d("ChatAuthorPhotoBlock.react",["DOM","MercuryParticipants","ReactPropTypes","React","Tooltip","cx","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'ChatAuthorPhotoBlock',propTypes:{authorID:i.string.isRequired,hideName:i.bool,hidePhoto:i.bool,timestamp:i.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.componentDidUpdate();},componentDidUpdate:function(){if(this.props.authorID!=this.state.author.id){h.get(this.props.authorID,function(o){this.isMounted()&&this.setState({author:o});}.bind(this));}else if(this.props.timestamp&&!this.props.hidePhoto)k.set(this.refs.link.getDOMNode(),this.createTooltip(),'left');},render:function(){return this.transferPropsTo(j.DOM.div({className:"_5yt9"},this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (j.DOM.div({className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto)return (j.DOM.a({className:"_5ys_",href:this.state.author.href,ref:"link"},j.DOM.img({src:this.state.author.image_src,ref:"image"})));},createTooltip:function(){return g.create('div',{className:"_5yt0"},[g.create('div',{className:"_5yt1"},m(new Date(this.props.timestamp),'g:ia')),g.create('div',{className:"_5yta"},this.state.author.name)]);}});e.exports=n;});
__d("DOMHyperlink",["Env","JSXDOM","TransformTextToDOMMixin","UntrustedLink","URI","URLScraper","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={MAX_ITEMS:40,match:function(p,q){var r=l.match(p);if(!r)return false;var s=p.indexOf(r),t=s+r.length;return {startIndex:s,endIndex:t,element:this._element(r,q)};},_element:function(p,q){var r=p,s=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(p)))s='http://'+s;if(!k.isValidURI(s))return r;var t=h.a({className:"_553k",href:s,target:"_blank",rel:"nofollow"},r);if(q&&!k(s).isFacebookURI())t.onmousedown=function(u){j.bootstrap(this,g.lhsh,u);};return t;}};e.exports=m(o,i);});
__d("MercuryMessageRenderer",["DOM","DOMEmoji","DOMEmote","DOMHyperlink","FBIDEmote","JSXDOM","transformTextToDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={formatMessageBody:function(q,r,s){var t=(q||'').replace(/\s+$/,'');if(!r)return p(t,false,s);var u=Object.keys(r).map(function(x){return window.parseInt(x);}).sort(function(x,y){return x-y;}),v=[],w=0;u.forEach(function(x){var y=t.slice(w,x);if(y)v.push(p(y,false,s));w=x+r[x].length;var z=t.slice(x,w);if(z)v.push(p(z,true,s));});if(w<t.length)v.push(p(t.slice(w),false,s));return v.length===0?null:v.length===1?v[0]:g.create('span',{},v);}};function o(q,r){var s=q.replace(/\r\n?/g,'\n').split(/\n{2,}/);return s.filter(function(t){return t.length;}).map(function(t){return l.p(null,r(t));});}function p(q,r,s){if(q.length===0&&!r)return null;var t=function(u){return m(u,[j.params(true),h,k,i]);};return (l.span({className:r?'highlight':null},s?o(q,t):t(q)));}e.exports=n;});
__d("ChatBubble.react",["DOM","DOMDimensions","MercuryMessageRenderer","ReactPropTypes","React","cx","fbt","startsWith"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=null,p=k.createClass({displayName:'ChatBubble',propTypes:{attachments:j.renderable,body:j.string,maxWidth:j.number.isRequired},getInitialState:function(){return {bubbleWidth:this.props.maxWidth};},componentDidMount:function(){this.renderDOMBody();this.shrinkBubble();},componentWillReceiveProps:function(q){if(q.body!=this.props.body)this.setState({bubbleWidth:this.props.maxWidth});},componentDidUpdate:function(q,r){this.renderDOMBody();if(q.body!=this.props.body)this.shrinkBubble();},render:function(){return this.transferPropsTo(k.DOM.div({className:"_5w1r",ref:"bubble",style:{maxWidth:this.state.bubbleWidth}},k.DOM.div(null,k.DOM.span({className:"_5yl5",ref:"content"},this.renderBody())),this.props.attachments));},renderBody:function(){var q=this.props.body||'';if(n(q,'?OTR'))return (k.DOM.span({className:"_89h"},"[encrypted message]"));return q;},renderDOMBody:function(){var q=this.props.body||'';if(!n(q,'?OTR'))g.setContent(this.refs.content.getDOMNode(),i.formatMessageBody(q));},shrinkBubble:function(){var q=this.refs.bubble.getDOMNode(),r=this.refs.content.getDOMNode(),s=h.getElementDimensions(q).width,t=h.getElementDimensions(r).width;if(this.contentWraps()&&s-t-this.getBoxWidth()>0&&t!=this.state.bubbleWidth)this.setState({bubbleWidth:t});},contentWraps:function(){var q=this.refs.content.getDOMNode(),r=q.getClientRects(),s=h.getElementDimensions(q).height;return (r&&r.length>1&&r[0].height<s);},getBoxWidth:function(){if(!o)o=h.measureElementBox(this.refs.bubble.getDOMNode(),'width',true,true,false);return o;}});e.exports=p;});
__d("arraySort",["invariant"],function(a,b,c,d,e,f,g){function h(i,j){g(Array.isArray(i));var k=i.slice();if(j)return k.sort(j);return k.sort();}e.exports=h;});
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","DOM","Event","ImmutableObject","ReactPropTypes","React","arraySort","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p=176,q=4,r=l.createClass({displayName:'MercuryAttachments',propTypes:{message:k.instanceOf(j).isRequired,attachments:k.array.isRequired,isChat:k.bool,onImageLoad:k.func,onStickerClick:k.func},getDefaultProps:function(){return {isChat:false,onImageLoad:o,onStickerClick:o};},componentDidMount:function(){this.renderAttachments();},componentDidUpdate:function(){this.renderAttachments();},render:function(){var s=this.props.attachments.filter(g.isPhotoAttachment).length>0;return this.transferPropsTo(l.DOM.div({className:(("_5h9y")+(s?' '+"_zl6":''))}));},renderAttachments:function(){var s=this.getDOMNode();h.empty(s);var t=this.props.message,u=m(this.props.attachments,g.booleanLexicographicComparator([g.isPhotoAttachment,g.isShareAttachment,g.isFileAttachment,g.isErrorAttachment])),v=g.renderPhotoAttachments(u.filter(g.isPhotoAttachment),t,p,q);v&&h.appendContent(s,v);for(var w=0;w<u.length;w++){var x=u[w];if(g.isPhotoAttachment(x))continue;var y=g.renderAttachment(this.props.isChat,x,t,null,null,this.props.onStickerClick);y.error&&h.appendContent(s,y.error);y.content&&h.appendContent(s,y.content);}h.scry(s,'img').forEach(function(z){var aa=i.listen(z,'load',function(){this.props.onImageLoad(z);aa.remove();}.bind(this));}.bind(this));}});e.exports=r;});
__d("MercuryMessageError.react",["CurrentUser","ImmutableObject","MercuryErrorInfo","MercuryMessages","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.PropTypes,o=k.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:n.string,message:n.instanceOf(h).isRequired},getDefaultProps:function(){return {authorFBID:g.getID()};},render:function(){var p=this.props.message,q=p.error_data;return this.transferPropsTo(k.DOM.div({className:this._getClassNameFromStatus(p),tabIndex:i.isTransient(q)?0:null,onClick:i.isTransient(q)?this.messageResend:null},k.DOM.div({className:"_2fs1"}),k.DOM.span(null,this._getTextFromStatus(p))));},messageResend:function(){j.getForFBID(this.props.authorFBID).resendMessage(this.props.message);},_getClassNameFromStatus:function(p){if(i.hasErrorStatus(p)){return (("_2fs2")+(' '+"_2fs3")+(i.isTransient(p.error_data)?' '+"_2fs4":'')+(i.isPermanent(p.error_data)?' '+"_2fs5":''));}else return "_2fs6 _2fs2";},_getTextFromStatus:function(p){var q='',r=p.error_data;if(i.hasErrorStatus(p))if(i.isConnectionError(r)){q=("Unable to connect to Facebook. This message failed to send.");if(i.isTransient(r))q=(m._("{message} Check your network connection or click to try again.",[m.param("message",q)]));}else{if(r&&r.description){q=p.error_data.description;}else q=("This message failed to send.");if(i.isTransient(r))q=(m._("{message} Click to send again.",[m.param("message",q)]));}return q;}});e.exports=o;});
__d("MercurySpoofWarning.react",["MercuryParticipants","ReactPropTypes","React","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k=i.createClass({displayName:'MercurySpoofWarning',propTypes:{authorID:h.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(l){g.get(l.authorID,function(m){return this.setState({author:m});}.bind(this));},render:function(){return this.transferPropsTo(i.DOM.div(null,j._("Unable to confirm {name_or_email} as the sender.",[j.param("name_or_email",this.state.author.name)])));}});e.exports=k;});
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryParticipants","PresencePrivacy","React","ReactPropTypes","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:'ChatVideoCallLink',propTypes:{message:l.object.isRequired,onClick:l.func.isRequired},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.DOM.a({className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),'data-gt':JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return ("Retry setup and call back.");}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)return ("Call back.");},shouldHideLink:function(){return !h.isOnline()||!n.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var r;if(this.props.message.log_message_data.event_name=='install_canceled'){r='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)r='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,r);},availabilityChanged:function(){this.forceUpdate();}});e.exports=q;});
__d("MercuryLogMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","HovercardLink","MercuryLogMessageType","MercuryParticipants","React","Image.react","TooltipLink.react","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={renderText:function(la,ma){switch(la.log_message_type){case k.SUBSCRIBE:u(la,ma);break;case k.UNSUBSCRIBE:z(la,ma);break;case k.VIDEO_CALL:aa(la,ma);break;case k.PHONE_CALL:ca(la,ma);break;case k.THREAD_NAME:da(la,ma);break;case k.THREAD_IMAGE:ea(la,ma);break;case k.WALLPAPER:fa(la,ma);break;case k.SERVER_ERROR:ga(la,ma);break;}},renderIcon:function(la){return (n({className:t(la),src:r('images/spacer.gif')}));},renderLegacy:function(la,ma,na,oa){t(oa).split(' ').forEach(function(pa){return pa&&h.addClass(la,pa);});this.renderText(oa,function(pa){m.renderComponent(m.DOM.span(null,pa),ma);});this.renderAttachmentLegacy(na,oa);},renderAttachmentLegacy:function(la,ma){if(ma.log_message_type==k.THREAD_IMAGE){var na=ma.log_message_data.image;if(na){var oa=g.renderPreview(na.preview_url?na:null);i.setContent(la,oa);h.addClass(oa,"_z6a");h.show(la);}}}};e.exports=s;function t(la){var ma=la.log_message_type,na=la.log_message_data;return (("_5wzu")+(ma==k.SUBSCRIBE?' '+"_5wzj":'')+(ma==k.UNSUBSCRIBE?' '+"_5wzk":'')+(ma==k.THREAD_NAME?' '+"_5wzl":'')+(ma==k.THREAD_IMAGE?' '+"_5wzm":'')+(ma==k.VIDEO_CALL&&(na.answered||ka(la))?' '+"_5wzn":'')+(ma==k.VIDEO_CALL&&!(na.answered||ka(la))?' '+"_5wzo":'')+(ma==k.PHONE_CALL&&na.answered?' '+"_5wzp":'')+(ma==k.PHONE_CALL&&!na.answered?' '+"_5wzq":'')+(ma==k.SERVER_ERROR?' '+"_5wzr":''));}function u(la,ma){var na=ja(la.log_message_data.added_participants);switch(na.length){case 1:v(la,ma,na);break;case 2:w(la,ma,na);break;case 3:x(la,ma,na);break;default:y(la,ma,na);break;}}function v(la,ma,na){var oa=[la.author,na[0]];l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1}.",[q.param("subscriber1",ia(pa[na[0]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you.",[q.param("actor",ia(pa[la.author]))]));}else ma(q._("{actor} added {subscriber1}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]]))]));});}function w(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1} and {subscriber2}.",[q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you and {subscriber2}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(pa[na[1]]))]));}else ma(q._("{actor} added {subscriber1} and {subscriber2}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]]))]));});}function x(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you, {subscriber2} and {subscriber3}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));}else ma(q._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));});}function y(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){function qa(sa){var ta=m.DOM.div(null,sa.map(function(ua){return m.DOM.div(null,ua.name);}));return (o({alignH:"center",position:"above",tooltip:ta},q._("{num} more",[q.param("num",sa.length)])));}var ra=na.map(function(sa){return pa[sa];});if(la.author==l.user){ma(q._("You added {subscriber1}, {subscriber2} and {more_people}.",[q.param("subscriber1",ia(ra[0])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));}else if(na[0]==l.user){ma(q._("{actor} added you, {subscriber2} and {more_people}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));}else ma(q._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(ra[0])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));});}function z(la,ma){var na=[la.author],oa=la.log_message_data.removed_participants,pa;if(oa.length===1){pa=oa[0];na.push(pa);}l.getMulti(na,function(qa){var ra=qa[la.author],sa=qa[pa];if(la.author==l.user){if(!pa||pa==la.author){ma("You left the conversation.");}else ma(q._("You removed {name} from the conversation.",[q.param("name",ia(sa))]));}else if(!pa||pa==la.author){ma(q._("{actor} left the conversation.",[q.param("actor",ia(ra))]));}else if(pa==l.user){ma(q._("{actor} removed you from the conversation.",[q.param("actor",ia(ra))]));}else ma(q._("{actor} removed {name} from the conversation.",[q.param("actor",ia(ra)),q.param("name",ia(sa))]));});}function aa(la,ma){if(ka(la)){ba(la,ma);return;}var na=la.log_message_data.caller,oa=la.log_message_data.callee,pa=[na,oa];l.getMulti(pa,function(qa){var ra=ha(qa[oa]);if(na==l.user){if(la.log_message_data.answered){ma(q._("You called {firstname}.",[q.param("firstname",ra)]));}else ma(q._("{firstname} missed a call from you.",[q.param("firstname",ra)]));}else{var sa=ha(qa[na]);if(la.log_message_data.answered){ma(q._("{firstname} called you.",[q.param("firstname",sa)]));}else ma(q._("You missed a call from {firstname}.",[q.param("firstname",sa)]));}});}function ba(la,ma){l.get(la.log_message_data.callee,function(na){var oa=ha(na);switch(la.log_message_data.event_name){case 'installing':ma(q._("{firstname} is setting up video calling...",[q.param("firstname",oa)]));break;case 'installed':ma(q._("{firstname} finished setting up video calling.",[q.param("firstname",oa)]));break;case 'install_canceled':ma("You canceled the video calling installation.");break;}});}function ca(la,ma){var na=la.log_message_data.caller,oa=la.log_message_data.callee,pa=[na,oa];l.getMulti(pa,function(qa){if(na==l.user){var ra=ha(qa[oa]);if(la.log_message_data.answered){ma(q._("You called {firstname}.",[q.param("firstname",ra)]));}else ma(q._("{firstname} missed a call from you.",[q.param("firstname",ra)]));}else{var sa=ha(qa[na]);if(la.log_message_data.answered){ma(q._("{firstname} called you.",[q.param("firstname",sa)]));}else ma(q._("You missed a call from {firstname}.",[q.param("firstname",sa)]));}});}function da(la,ma){var na=la.log_message_data.name;if(la.author==l.user){if(na){ma(q._("You named the conversation: {name}.",[q.param("name",m.DOM.span({className:"_5wzs"},na))]));}else ma("You removed the conversation name.");}else l.get(la.author,function(oa){var pa=ia(oa);if(na){ma(q._("{actor} named the conversation: {name}.",[q.param("actor",pa),q.param("name",m.DOM.span({className:"_5wzs"},na))]));}else ma(q._("{actor} removed the conversation name.",[q.param("actor",pa)]));});}function ea(la,ma){if(la.author==l.user){if(la.log_message_data.image){ma("You changed the conversation picture.");}else ma("You removed the conversation picture.");}else l.get(la.author,function(na){var oa=ia(na);if(la.log_message_data.image){ma(q._("{actor} changed the conversation picture.",[q.param("actor",oa)]));}else ma(q._("{actor} removed the conversation picture.",[q.param("actor",oa)]));});}function fa(la,ma){if(la.author==l.user){ma("You changed the wallpaper.");}else l.get(la.author,function(na){var oa=ia(na);ma(q._("{actor} changed the wallpaper.",[q.param("actor",oa)]));});}function ga(la,ma){ma("We were unable to fetch previous messages in this conversation.");}function ha(la){return ia(la,true);}function ia(la,ma){var na=la.fbid,oa=j.constructEndpoint({id:na});if(la.href)return (m.DOM.a({className:"_5wzt",href:la.href,'data-hovercard':oa},ma?la.short_name:la.name));return la.name;}function ja(la){var ma=la.indexOf(l.user);if(ma>0)return la.splice(ma,1).concat(la);return la;}function ka(la){return la.log_message_data.event_name==='installing'||la.log_message_data.event_name==='installed'||la.log_message_data.event_name==='install_canceled';}});
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","ReactPropTypes","VideoCallCore","cx","emptyFunction","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';var s=m.createClass({displayName:'MercuryLogMessage',propTypes:{message:n.instanceOf(j).isRequired,onImageLoad:n.func,onVideoCallLinkClick:n.func},getDefaultProps:function(){return {onImageLoad:q};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(t){k.renderText(t.message,function(u){this.setState({messageText:u});}.bind(this));},shouldComponentUpdate:function(t,u){return this.state.messageText!=u.messageText;},componentDidUpdate:function(){var t=this.refs.attachment.getDOMNode();k.renderAttachmentLegacy(t,this.props.message);g.scry(t,'img').forEach(function(u){var v=h.listen(u,'load',function(){this.props.onImageLoad(u);v.remove();}.bind(this));}.bind(this));},render:function(){return this.transferPropsTo(m.DOM.div({className:"_5ye6",title:r(new Date(this.props.message.timestamp),'g:ia')},k.renderIcon(this.props.message),m.DOM.div({className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.DOM.div({className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!o.isSupported())return null;return (i({message:this.props.message,onClick:this.props.onVideoCallLinkClick}));}});e.exports=s;});
__d("ChatConversation.react",["ChatDateBreak.react","ChatMessage.react","ImmutableObject","MercuryActionTypeConstants","MercuryLogMessage.react","ReactPropTypes","React","cx","emptyFunction","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q=1000*60*60,r=m.createClass({displayName:'ChatConversation',propTypes:{maxBubbleWidth:l.number.isRequired,messages:l.arrayOf(l.instanceOf(i)).isRequired,onCallLinkClick:l.func,onImageLoad:l.func,onStickerClick:l.func,messagesWillChange:l.func,messagesDidChange:l.func},getDefaultProps:function(){return {messagesWillChange:o,messagesDidChange:o};},componentWillReceiveProps:function(s){p(s.maxBubbleWidth===this.props.maxBubbleWidth);},componentWillUpdate:function(){this.props.messagesWillChange();},componentDidUpdate:function(){this.props.messagesDidChange();},render:function(){var s=this.props.messages,t=[];for(var u=0;u<s.length;u++){var v=s[u],w=(u>0)?s[u-1]:null;if(v.is_cleared)continue;if(!w||w.is_cleared||v.timestamp-w.timestamp>q)t.push(g({date:new Date(v.timestamp),key:'db:'+v.message_id}));if(v.action_type==j.LOG_MESSAGE){t.push(k({className:"_5w0o",key:v.message_id,message:v,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else t.push(h({key:v.message_id,message:v,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));}return m.DOM.div(null,t);}});e.exports=r;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryParticipants","MercuryPayloadSource","TypingDetector","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryServerRequests').get(),p=b('MercuryThreads').get(),q,r={},s=30000,t={};m(t,{'state-changed':true});function u(aa){var ba=r[aa]||{},ca=Object.keys(ba);ca.sort(function(da,ea){return ba[da]-ba[ea];});return ca;}function v(){q=null;var aa=Date.now(),ba={},ca=false;for(var da in r){var ea=false;for(var fa in r[da]||{})if(r[da][fa]<aa-s){delete r[da][fa];ea=true;}else ca=true;if(ea)ba[da]=u(da);}for(var ga in ba){x(ba);break;}if(ca)q=n(v,3000);}function w(aa,ba){if(aa in r)if(ba in r[aa]){delete r[aa][ba];y(aa);}}function x(aa){t.releaseHeldEventType('state-changed');t.emitAndHold('state-changed',aa);}function y(aa){var ba={};ba[aa]=u(aa);x(ba);}function z(aa){if(aa.thread)return o.getClientThreadIDNow(aa.thread);if(aa.type==='typ')return p.getThreadIdForUser(aa.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(aa,ba){var ca=ba.obj,da=z(ca);if(da){var ea=j.getIDForUser(ca.from);if(ca.st==l.TYPING){r[da]=r[da]||{};var fa=r[da][ea];r[da][ea]=Date.now();if(!q)q=n(v,3000);!fa&&y(da);}else if(ca.st==l.INACTIVE)w(da,ea);}});o.subscribe('update-typing-state',function(aa,ba){var ca=ba.payload_source;if(ca!=k.CLIENT_CHANNEL_MESSAGE)return;var da=ba.actions;if(!da||!da.length)return;var ea=i.USER_GENERATED_MESSAGE;da.forEach(function(fa){if(fa.action_type==ea&&fa.author!=j.user)w(fa.thread_id,fa.author);});});e.exports=t;});
__d("ChatTypingIndicators.react",["ChatAuthorPhotoBlock.react","DOM","MercuryIDs","MercuryParticipants","ReactPropTypes","React","SubscriptionsHandler","Tooltip","MercuryTypingReceiver","arraySort","createObjectFrom","cx","emptyFunction","fbt","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryThreadInformer').get(),v=l.createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorsWillShow:k.func,indicatorsDidShow:k.func,threadID:k.string.isRequired},getDefaultProps:function(){return {indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(o.addRetroactiveListener('state-changed',this.typingStateChanged),u.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();j.getMulti(this.state.typingUserIDs,function(w){if(this.isMounted())this.state.typingUserIDs.forEach(function(x){var y=w[x];n.set(this.refs[x].getDOMNode(),this.renderTooltip(y.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=i.isMultichat(this.props.threadID);return (l.DOM.div({className:"_2fsr"},this.state.typingUserIDs.map(function(x){return g({authorID:x,className:(("_gfq")+(w?' '+"_52fu":'')),hideName:!w,key:x},l.DOM.div({className:"_52ft"},l.DOM.div({className:"_gfp",ref:x})));})));},renderTooltip:function(w){var x=h.create('span');l.renderComponent(l.DOM.span(null,t._("{name} is typing...",[t.param("name",w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:p(w[this.props.threadID])});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=q(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:p(this.state.typingUserIDs.filter(function(aa){return !z[aa];}))});}}});e.exports=v;});
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionTypeConstants","MercuryDelayedRoger","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryTypingReceiver","arrayContains","copyProperties","formatDate","removeFromArray","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryThreads').get(),u=[];function v(w){this._threadID=w;this._canonicalUser=t.getCanonicalUserInThread(w);u.push(this);}p(v.prototype,g,{destroy:function(){r(u,this);},setLastMessage:function(w){this._lastMsg=w;this._handleStateChange();},_informStateChanged:function(w){if(w.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&l.isAuthor(this._lastMsg.author))w.self_authored=true;this._currentActivity=w.activity;this.inform('state-changed',w);},_notifySentFrom:function(){var w,x,y=this._lastMsg.location_text,z=this._lastMsg.source_tags||[];if(y){w=s._("Sent from {location}",{location:y});x='sentFromMobile';}else if(o(z,k.MESSENGER)){w=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");x='sentFromMobile';}else if(o(z,k.MOBILE)){w=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");x='sentFromMobile';}else if(o(z,k.EMAIL)){w="Sent from email";x='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:x,text:w});},_notifySeenTimestamp:function(w){var x=m.getSeenTimestamp(this._threadID,w[0])*.001,y=Date.now()*.001,z;if(x<y-518400){z='M j';}else if(x<y-86400){z='D g:ia';}else z='g:ia';this._informStateChanged({activity:'seen-timestamp',text:s._("Seen {timestamp}",{timestamp:q(x,z)})});},_checkNamesForCollision:function(w,x){var y=false;l.getMulti(w,function(z){function aa(da){if(typeof z[da]!=="undefined"){return z[da].short_name.toLowerCase();}else return da;}var ba=x.map(aa),ca=w.map(aa);y=ba.some(function(da){return ca.indexOf(da)!==ca.lastIndexOf(da);});});return y;},_notifySeenBy:function(w){var x=this._lastMsg,y=true;l.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;var aa=t.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca=w.length+(x.author!=l.user),da,ea=false,fa=false,ga=ba>2&&ca>=ba-1;if(!(ga)&&ba>0)fa=this._checkNamesForCollision(aa.participants,w);if(ga){da="Seen by everyone";}else if(w.length==1){da=s._("Seen by {user}",{user:z[w[0]].short_name});}else if(w.length==2){da=s._("Seen by {user1}, {user2}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){da=s._("Seen by {user1}, {user2}, {user3}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var ha=Object.keys(z).length-2,ia=s._("{num} more",{num:ha}),ja=h.create('span',{className:'more'},ia);da=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ja});ea=true;}ea=ea||fa;this._informStateChanged({activity:'seen-by',text:da,seenBy:w,hasNameCollision:fa,tooltip:ea});}.bind(this));y&&this._informStateChanged({activity:'none'});},_notifyTyping:function(w){var x=this._lastMsg,y=true;l.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;var aa=t.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca,da=false;if(ba>2&&w.length>=ba-1){ca="Everyone is typing...";}else if(w.length==1){ca=s._("{name} is typing...",{name:z[w[0]].short_name});}else if(w.length==2){ca=s._("{user1} and {user2} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){ca=s._("{user1}, {user2}, and {user3} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var ea=Object.keys(z).length-2,fa=s._("{num} more",{num:ea}),ga=h.create('a',{href:'#'},fa);ca=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ga});da=true;}this._informStateChanged({activity:'typing',text:ca,typing:w,tooltip:da});}.bind(this));y&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var w=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==w){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=l.user){this._notifySentFrom();return;}var x=j.getSeenBy(this._threadID,true);if(x.length)if(this._canonicalUser){this._notifySeenTimestamp(x);return;}else{this._notifySeenBy(x);return;}this._informStateChanged({activity:'none'});}});n.addRetroactiveListener('state-changed',function(w){u.forEach(function(x){var y=w[x._threadID];if(y!==undefined){x._typing=y;x._handleStateChange();}});});j.subscribe('state-changed',function(w,x){u.forEach(function(y){x[y._threadID]&&y._handleStateChange();});});e.exports=v;});
__d("MercuryLastMessageIndicator.react",["DOM","MercuryIndicatorController","MercuryParticipants","ReactPropTypes","React","Tooltip","cx","emptyFunction","joinClasses","startsWith"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:j.bool,indicatorWillShow:j.func,indicatorDidShow:j.func,lastMessage:j.object,threadID:j.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:n,indicatorDidShow:n};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(r){if(r.threadID!=this.props.threadID){this._destroy();this._setup(r);}else if(r.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(r.lastMessage);},componentWillUpdate:function(r,s){if(this.isVisible(r,s))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.DOM.div({className:this.getRootClass()},k.DOM.div({className:"_510h"}),k.DOM.span({className:"_510f",ref:"text"}," ")));},getRootClass:function(){var r=(("_510g")+(this.state.data.self_authored?' '+"_510e":'')),s=this.state.data.activity,t=null;if(p(s,'seen')){t='seen';}else if(s=='typing'){t=this.props.hideTyping?null:s;}else t=s;return o(r,t,this.props.className);},isVisible:function(r,s){r=r||this.props;s=s||this.state;return (s.data&&s.data.activity!='none'&&!(r.hideTyping&&s.data.activity=='typing'));},setText:function(){if(this.state.data.text)g.setContent(this.refs.text.getDOMNode(),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)i.getMulti(this.state.data.seenBy,function(r){var s=g.create('div',null,this.state.data.seenBy.map(function(t){return g.create('div',null,r[t].name);}));l.set(this.state.data.hasNameCollision?this.getDOMNode():g.find(this.getDOMNode(),'span.more'),s,'above','center');}.bind(this));},_setup:function(r){this._controller=new h(r.threadID);this._subscription=this._controller.subscribe('state-changed',function(s,t){return this.setState({data:t});}.bind(this));r.lastMessage&&this._controller.setLastMessage(r.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(r){this.setProps({lastMessage:r});}});e.exports=q;});
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","Tooltip","copyProperties","cx","tx","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreadInformer').get(),s=[];r.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.addRetroactiveListener('state-changed',function(v){s.forEach(function(w){var x=v[w._threadID];x&&w._handleStateChanged(x);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');n.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=q._("{name} is typing...",{name:v.short_name});n.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.addRetroactiveListener('state-changed',function(y){var z=y[this._threadID];z&&this._handleStateChanged(z);}.bind(this));s.push(this);}o(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;});
__d("OrderedMap",["invariant","mixInto"],function(a,b,c,d,e,f,g,h){"use strict";var i='key:';function j(q,r){var s={};for(var t=0;t<q.length;t++){var u=q[t],v=r(u);l(v);var w=i+v;g(!(w in s));s[w]=u;}return s;}function k(q,r){this._normalizedObj=q;this._computedPositions=null;this.length=r;}function l(q){g(q!==''&&(typeof q==='string'||typeof q==='number'));}function m(q,r,s){g(typeof q==='number'&&typeof r==='number'&&r>=0&&q>=0&&q+r<=s);}function n(q,r){g(q&&q.constructor===Object&&(!r||r.constructor===Object));var s={},t=0,u;for(u in q)if(q.hasOwnProperty(u)){s[u]=q[u];t++;}for(u in r)if(r.hasOwnProperty(u)){if(!(u in s))t++;s[u]=r[u];}return new k(s,t);}var o={has:function(q){l(q);var r=i+q;return r in this._normalizedObj;},get:function(q){l(q);var r=i+q;return this.has(q)?this._normalizedObj[r]:undefined;},merge:function(q){g(q instanceof k);return n(this._normalizedObj,q._normalizedObj);},map:function(q,r){return this.mapRange(q,0,this.length,r);},mapRange:function(q,r,s,t){var u=this._normalizedObj,v={},w=0;m(r,s,this.length);var x=r+s-1;for(var y in u)if(u.hasOwnProperty(y)){if(w>=r){if(w>x)break;var z=u[y];v[y]=q.call(t,z,y.substr(i.length),w);}w++;}return new k(v,s);},filter:function(q,r){return this.filterRange(q,0,this.length,r);},filterRange:function(q,r,s,t){var u={},v=0;this.forEachRange(function(w,x,y){if(q.call(t,w,x,y)){var z=i+x;u[z]=w;v++;}},r,s);return new k(u,v);},forEach:function(q,r){this.forEachRange(q,0,this.length,r);},forEachRange:function(q,r,s,t){m(r,s,this.length);var u=this._normalizedObj,v=0,w=r+s-1;for(var x in u)if(u.hasOwnProperty(x)){if(v>=r){if(v>w)break;var y=u[x];q.call(t,y,x.substr(i.length),v);}v++;}},mapKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);g(u!==undefined&&v!==undefined);g(v>=u);return this.mapRange(q,u,(v-u)+1,t);},forEachKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);g(u!==undefined&&v!==undefined);g(v>=u);this.forEachRange(q,u,(v-u)+1,t);},keyAtIndex:function(q){var r=this._getOrComputePositions(),s=r.keyByIndex[q];return s?s.substr(i.length):undefined;},keyAfter:function(q){return this.nthKeyAfter(q,1);},keyBefore:function(q){return this.nthKeyBefore(q,1);},nthKeyAfter:function(q,r){var s=this.indexOfKey(q);g(s!==undefined);return this.keyAtIndex(s+r);},nthKeyBefore:function(q,r){return this.nthKeyAfter(q,-r);},indexOfKey:function(q){l(q);var r=i+q,s=this._getOrComputePositions(),t=s.indexByKey[r];return t===undefined?undefined:t;},toArray:function(){var q=[],r=this._normalizedObj;for(var s in r)if(r.hasOwnProperty(s))q.push(r[s]);return q;},_getOrComputePositions:function(){var q=this._computedPositions;if(!q)this._computePositions();return this._computedPositions;},_computePositions:function(){this._computedPositions={keyByIndex:{},indexByKey:{}};var q=this._computedPositions.keyByIndex,r=this._computedPositions.indexByKey,s=0,t=this._normalizedObj;for(var u in t)if(t.hasOwnProperty(u)){q[s]=u;r[u]=s;s++;}}};h(k,o);var p={from:function(q){g(q instanceof k);return n(q._normalizedObj,null);},fromArray:function(q,r){g(Array.isArray(q));g(typeof r==='function');return new k(j(q,r),q.length);}};e.exports=p;});
__d("MercuryMessageList",["ImmutableObject","LogHistory","OrderedMap","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=h.getInstance('mercury_message_list');function l(q){this.$MercuryMessageList0=n(q?m(q):[]);}l.prototype.append=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q)));p('append',q);};l.prototype.prepend=function(q){this.$MercuryMessageList0=n(m(q)).merge(this.$MercuryMessageList0);p('prepend',q);};l.prototype.update=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q)));p('update',q);};l.prototype.reorder=function(q){this.$MercuryMessageList0=n(q.map(function(r){var s=this.$MercuryMessageList0.get(r.message_id);if(!s||s.timestamp!=r.timestamp||s.is_cleared!=r.is_cleared)return new g(r);return s;}.bind(this)));p('reorder',q);};l.prototype.hasReachedClearedMessages=function(){return this.messageAt(0).is_cleared;};l.prototype.messageAt=function(q){return this.$MercuryMessageList0.get(this.$MercuryMessageList0.keyAtIndex(q));};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toOrderedMap=function(){return this.$MercuryMessageList0;};function m(q){return q.map(function(r){return new g(r);});}function n(q){return i.fromArray(q,o);}function o(q){return q.message_id;}function p(event,q){j(function(){k.debug(event,{messageIDs:q.map(function(r){return r.message_id;})});},0);}e.exports=l;});
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryMessageList","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=b('MercuryMessages').get(),p=b('MercuryThreads').get(),q=b('MercuryThreadInformer').get(),r=h.getInstance('mercury_message_store');function s(u){this.$MercuryMessageStore0=u;this.$MercuryMessageStore1=new i();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=new j();this.$MercuryMessageStore5.addSubscriptions(q.subscribe('messages-received',function(v,w){return this.$MercuryMessageStore6(w);}.bind(this)),q.subscribe('messages-updated',function(v,w){return w[this.$MercuryMessageStore0]&&this.$MercuryMessageStore7(w[this.$MercuryMessageStore0]);}.bind(this)),q.subscribe('messages-reordered',function(v,w){return w[this.$MercuryMessageStore0]&&this.$MercuryMessageStore8();}.bind(this)));this.$MercuryMessageStore9();}s.prototype.setNewThreadID=function(u){this.$MercuryMessageStorea=u;};s.prototype.destroy=function(){this.$MercuryMessageStore5&&this.$MercuryMessageStore5.release();};s.prototype.subscribe=function(u){return this.addRetroactiveListener('updated',u);};s.prototype.fetchMoreMessages=function(){if(o.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&o.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(p.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;if(this.$MercuryMessageStore1.hasReachedClearedMessages())return false;return this.$MercuryMessageStore9();};s.prototype.$MercuryMessageStore9=function(){var u=this.$MercuryMessageStore4+k.RECENT_MESSAGES_LIMIT*this.$MercuryMessageStore2;o.getThreadMessagesRange(this.$MercuryMessageStore0,0,u,this.$MercuryMessageStoreb.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(o.hasLoadedNMessages(this.$MercuryMessageStore0,u)){this.$MercuryMessageStore8();return false;}return true;};s.prototype.$MercuryMessageStoreb=function(u){if(u&&u.length){this.$MercuryMessageStore3=u[0].timestamp;this.$MercuryMessageStore4=u.length;}};s.prototype.$MercuryMessageStore6=function(u){var v=u[this.$MercuryMessageStore0];if(v&&v.length){this.$MercuryMessageStore1.append(v);this.$MercuryMessageStore4+=v.length;}if(this.$MercuryMessageStorea){var w=u[this.$MercuryMessageStorea];if(w&&w.length){this.$MercuryMessageStore1.append(w);this.$MercuryMessageStore4+=w.length;this.$MercuryMessageStorea=null;}}this.$MercuryMessageStorec(s.MESSAGES_RECEIVED);};s.prototype.$MercuryMessageStore7=function(u){this.$MercuryMessageStore1.update(o.getMessagesFromIDs(Object.keys(u)));this.$MercuryMessageStore3=this.$MercuryMessageStore1.messageAt(0).timestamp;this.$MercuryMessageStorec(s.MESSAGES_CHANGED);};s.prototype.$MercuryMessageStore8=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(o.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStore3=this.$MercuryMessageStore1.messageAt(0).timestamp;this.$MercuryMessageStorec(s.MESSAGES_REORDERED);};s.prototype.$MercuryMessageStorec=function(u){var v=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',{messages:v,eventType:u});t(this.$MercuryMessageStore0,u,v);};function t(u,v,w){n(function(){r.debug('updated',{threadID:u,eventType:v,messageIDs:w.map(function(x){return x.message_id;})});},0);}l(s,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered'});m(s,{updated:true});e.exports=s;});
__d("ChatTabMessagesView",["Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","BanzaiLogger","ChannelConstants","ChatAnimatedGifs","ChatConfig","ChatConversation.react","ChatDateBreak.react","ChatTypingIndicators.react","CSS","CurrentUser","DOM","Event","ImmutableObject","MercuryLastMessageIndicator.react","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryErrorInfo","MercuryLogMessage.react","MercuryLogMessageType","MercurySourceType","MercuryMessageError.react","MercuryThreadlistConstants","MercuryTypingIndicator","MercuryMessageRenderer","MercuryMessageStore","Parent","MercuryParticipants","React","ServerTime","MercurySpoofWarning.react","MercuryStatusTemplates","StickerState","StickerStoreController","Style","SubscriptionsHandler","ChatTabTemplates","Tooltip","UserAgent","arrayContains","copyProperties","createArrayFrom","csx","cx","extendArray","formatDate","getElementPosition","isRTL","removeFromArray","shield","throttle","tx","MercuryMessages","MercuryServerRequests","MercuryThreadMetadataRenderer","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb){'use strict';var kb=b('MercuryMessages').get(),lb=b('MercuryServerRequests').get(),mb=b('MercuryThreadMetadataRenderer').get(),nb=b('MercuryThreads').get(),ob=b('MercuryThreadInformer').get(),pb,qb=34,rb=1000*60*60,sb=70,tb=null,ub=20;function vb(dc){return db(new Date(dc),'g:ia');}function wb(dc){var ec=ua[':fb:chat:conversation:message-group'].build(),fc=ec.getNode('profileLink'),gc=la.isAuthor(dc.author),hc=lb.tokenizeThreadID(dc.thread_id),ic=hc.type!=='user',jc=!gc;s.conditionClass(ec.getRoot(),"_50kd",!gc);s.conditionClass(ec.getRoot(),"_50x4",ic&&!gc);s.conditionShow(fc,jc);la.get(dc.author,function(kc){if(jc){fc.href=kc.href;var lc="You";if(!gc)lc=u.create('div',{className:"_522l"},[u.create('div',{className:"_522m"},vb(dc.timestamp)),kc.name]);va.set(fc,lc,'left');if(!gc&&ic)ec.setNodeContent('profileName',kc.name);ec.setNodeProperty('profilePhoto','src',kc.image_src);}});return ec;}function xb(dc,ec){if(!s.hasClass(dc,"_kso")){var fc=u.scry(dc,"._kso");if(fc.length===1){dc=fc[0];}else return;}sa.set(dc,'max-width',yb(ec)+'px');var gc,hc,ic=dc.firstChild;if(dc.childNodes.length===1&&ic.getAttribute('data-measureme')){gc=ic.getClientRects();var jc=ic.offsetHeight;if(gc&&gc.length>1&&gc[0].height<jc){hc=true;if(!pb){u.remove(ic);pb=dc.offsetWidth;u.appendContent(dc,ic);}var kc=ic.offsetWidth,lc=dc.offsetWidth-kc-pb;if(lc>0)sa.set(dc,'max-width',kc+'px');}}var mc=ka.byClass(dc,"_50x4");if(mc)s.conditionClass(mc,"_51lo",gc?!hc:dc.offsetHeight<qb);}function yb(dc){if(tb===null){var ec=dc.childNodes[0];sa.set(dc,'overflow','scroll');tb=ec.clientWidth-sb;sa.set(dc,'overflow','');}return tb;}function zb(dc){var ec=ua[':fb:mercury:chat:message:forward'].build(),fc=ec.getNode('forwardText');if(fc){s.hide(ec.getRoot());mb.renderWebMessengerLink(dc.thread_id,ec.getNode('forwardLink'),s.show.bind(s,ec.getRoot()));if(dc.forward_count>1){u.appendContent(fc,jb._("{count} forwarded messages",{count:dc.forward_count}));}else u.appendContent(fc,"1 forwarded message");}return ec.getRoot();}var ac=[];function bc(dc,ec,fc,gc,hc,ic,jc,kc){this.loadingIcon=hc;this.threadID=dc;this.sheetController=ec;this.scrollContainer=fc;this.conversationElem=gc;this.messageElements={};this.tabView=kc;this.messageGroup=null;this.prevMessage=null;y.restart(na.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var lc=ga.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-lc;ac.push(this);function mc(){bc.inform('interaction-with-tab',dc);}this._subscriptions=new ta();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),v.listen(this.scrollContainer,'mousedown',mc));if(wa.firefox()){var nc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(nc,mc,false);}else this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'mousewheel',mc));this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'scroll',ib(this.scrolling,50,this)));if(o.get('chat_react')){var oc;ma.renderComponent(r({threadID:this.threadID,indicatorsWillShow:function(){return oc=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return oc&&this.scrollToBottom(true);}.bind(this)}),jc);}else this.typingIndicator=new ha(this.threadID,jc,this);var pc;this.lastMessageIndicatorNode=ic;this.lastMessageIndicator=ma.renderComponent(x({threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return pc=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return pc&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);if(o.get('chat_react_user_messages')){this.initializeConversation();}else{kb.getThreadMessagesRange(this.threadID,0,ga.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}}ya(bc,i);ya(bc.prototype,{initializeConversation:function(){var dc,ec,fc,gc;this._store=new ja(this.threadID);this._conversation=ma.renderComponent(p({maxBubbleWidth:yb(this.scrollContainer),messages:[],onImageLoad:function(hc){var ic=this.scrollContainer,jc=ic.scrollTop+ic.clientHeight;if(jc+hc.offsetHeight>=ic.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(hc,ic,jc){bc.inform('video-call-clicked',{userID:hc,threadID:ic,clickSource:jc});},messagesWillChange:function(){dc=this.isScrolledToBottom();ec=this._getLoadingHeight();fc=this.scrollContainer.scrollHeight;gc=this.scrollContainer.scrollTop;}.bind(this),messagesDidChange:function(){if(dc){this.scrollToBottom();}else this.scrollToPosition(this.scrollContainer.scrollHeight-fc-ec+gc);}.bind(this)}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(function(hc){if(hc.eventType==ja.MESSAGES_REORDERED){this._loadingMoreMessages=false;s.hide(this.loadingIcon);}var ic=hc.messages;this._conversation.setProps({messages:ic});this.lastMessageIndicator.setProps({lastMessage:ic.length>0?ic[ic.length-1]:null});}.bind(this)));},scrolling:function(){this._checkToAnimateSticker();if(o.get('chat_react_user_messages')){if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){s.show(this.loadingIcon);this._loadingMoreMessages=true;}}else if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages&&!this.tabView._isDragDropActive)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){u.empty(this.conversationElem);this._subscriptions&&this._subscriptions.release();gb(ac,this);ma.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;if(o.get('chat_react_user_messages'))this._store&&this._store.destroy();this.destroyed=true;},_appendMessage:function(dc){if(dc==this.prevMessage)return;if(dc.is_cleared){this._hasReachedClearedMessages=true;return;}this._appendDateBreak(dc);if(dc.action_type===z.LOG_MESSAGE){this._appendLogMessage(dc);}else this._appendUserMessageXHP(dc);this.prevMessage=dc;},_appendUserMessageXHP:function(dc){var ec=ga.GROUPING_THRESHOLD,fc=this._renderMessageWithStatus(dc);if(!this.messageGroup||dc.author!==la.user||this.prevMessage.author!=dc.author||this.prevMessage.timestamp<dc.timestamp-ec){this.messageGroup=wb(dc);u.appendContent(this.conversationElem,this.messageGroup.getRoot());}u.appendContent(this.messageGroup.getNode('messages'),fc);xb(fc,this.scrollContainer);},_appendDateBreak:function(dc){if(dc.action_type===z.LOG_MESSAGE&&dc.log_message_type===da.SERVER_ERROR)return;var ec=this.prevMessage!==null?dc.timestamp-this.prevMessage.timestamp:Infinity;if(ec>=rb){var fc=new Date(dc.timestamp),gc=u.create('div',{className:"_5xjf"});ma.renderComponent(q({date:fc}),gc);u.appendContent(this.conversationElem,gc);this.messageGroup=null;}},_appendLogMessage:function(dc){var ec=u.create('div',{className:"_5ye9"}),fc=fa({message:new w(dc)}),gc=ca({className:"_5w0o",message:new w(dc),onCallLinkClick:function(hc,ic,jc){bc.inform('video-call-clicked',{userID:hc,threadID:ic,clickSource:jc});}});if(ba.hasErrorStatus(dc))gc=ma.DOM.div({className:"clearfix _542q"},ma.DOM.div({className:"_5pi7"},gc),ma.DOM.div({className:"_5pi6"},fc));ma.renderComponent(gc,ec);u.appendContent(this.conversationElem,ec);this.messageGroup=null;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var dc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,ec=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,fc=this.isScrolledToBottom();u.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var gc=kb.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(gc,dc,ec,fc);this._finishedFetchingMoreMessages=false;},update:function(dc){for(var ec in dc){var fc=this.messageElements[ec];if(fc){var gc=this.isScrolledToBottom(),hc=kb.getMessagesFromIDs([ec])[0],ic=this._renderMessageWithStatus(hc);u.replace(fc,ic);xb(ic,this.scrollContainer);if(gc)this.scrollToBottom();}}if(this.scrollContainer.scrollTop===0)this._checkToAnimateSticker();},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(dc){var ec=this.scrollContainer.style.overflowY;sa.set(this.scrollContainer,'overflow-y','scroll');dc.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);sa.set(this.scrollContainer,'overflow-y',ec);},_appendNewMessages:function(dc){var ec=this.isScrolledToBottom(),fc=this._messagesOnlySentFromSelf(dc);this._appendMessages(dc);if(ec){this.scrollToBottom();}else if(!fc){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_messagesOnlySentFromSelf:function(dc){for(var ec=0;ec<dc.length;ec++)if(dc[ec].author!==la.user)return false;return true;},_renderOlderMessages:function(dc,ec,fc,gc){if(!dc)return;this._appendMessages(dc);if(gc){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-ec-this.loadingHeight+fc);},_updateTimestamp:function(dc){if(dc&&dc.length){this._oldestMessageDisplayedTimestamp=dc[0].timestamp;this._currentMessageCount=dc.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;s.hide(this.loadingIcon);},isScrolledToBottom:function(dc){var ec=this.scrollContainer;dc=dc||ub;return ec.scrollTop+ec.clientHeight>=ec.scrollHeight-dc;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(dc){this.scrollToPosition(this.scrollContainer.scrollHeight,dc);},scrollToPosition:function(dc,ec){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(ec===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',dc).ease(g.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=dc;},loadMoreMessages:function(){if(kb.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&kb.hasLoadedAllMessages(this.threadID))return;if(nb.isNewEmptyLocalThread(this.threadID))return;s.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var dc=ga.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,ec=this._currentMessageCount+dc,fc=kb.hasLoadedNMessages(this.threadID,ec);kb.getThreadMessagesRange(this.threadID,0,ec,this._updateTimestamp.bind(this),null,aa.CHAT);if(fc)this.rerender();},_renderMessageWithStatus:function(dc){var ec=this._makeSingleMessage(dc),fc=fa({message:new w(dc)});if(ba.hasErrorStatus(dc)){var gc=ua[':fb:chat:conversation:message:status'].build();s.addClass(gc.getRoot(),"_542q");u.appendContent(gc.getNode('message'),ec);ma.renderComponent(fc,gc.getNode('status'));ec=gc.getRoot();}this.messageElements[dc.message_id]=ec;return ec;},_makeSingleMessage:function(dc){var ec=this._renderSingleMessage(dc);s.addClass(ec,"_55r0");return ec;},_renderSingleMessage:function(dc){var ec=ua[':fb:chat:conversation:message'].render();ec.setAttribute('title',vb(dc.timestamp));if(dc.subject){var fc=ua[':fb:chat:conversation:message:subject'].render();u.setContent(fc,dc.subject);u.appendContent(ec,fc);}function gc(nc){return u.create('span',{'data-measureme':1},nc);}if(dc.is_filtered_content){var hc=pa[':fb:mercury:filtered-message'].build();u.appendContent(ec,gc(hc.getRoot()));return ec;}var ic=dc.body||'';if(n.shouldHideBody(dc))ic='';if(ic.substr(0,4)=='?OTR'){u.setContent(ec,gc("[encrypted message]"));s.addClass(ec,"_542c");}else{s.addClass(ec,fb(ic)?'direction_rtl':'direction_ltr');var jc=ia.formatMessageBody(ic);u.appendContent(ec,gc(jc));}if(dc.has_attachment){var kc=u.create('div'),lc=this._appendMessageAttachments(kc,dc);if(!dc.body&&!lc)return kc;u.appendContent(ec,za(kc.childNodes));}if(dc.forward_count)u.appendContent(ec,zb(dc));if(dc.is_spoof_warning){var mc=u.create('div',{className:"_5wdb"});ma.renderComponent(oa({authorID:dc.author}),mc);return u.create('div',null,[u.create('div',null,ec),mc]);}return ec;},_appendMessageAttachments:function(dc,ec){var fc=0,gc=ec.attachments;gc.sort(k.booleanLexicographicComparator([k.isPhotoAttachment,k.isShareAttachment,k.isFileAttachment,k.isErrorAttachment]));if(ec.raw_attachments&&ec.raw_attachments.length>0)gc=j.convertRaw(ec.raw_attachments);if(ec.attachments.length===0&&ec.preview_attachments&&ec.preview_attachments.length>0)cb(gc,ec.preview_attachments);var hc=k.renderPhotoAttachments(gc.filter(k.isPhotoAttachment),ec,176,4);if(hc)u.appendContent(dc,u.create('div',{className:"_55pl"},hc));for(var ic=0;ic<gc.length;ic++){if(k.isPhotoAttachment(gc[ic])){fc=1;continue;}var jc=k.renderAttachment(true,gc[ic],ec,null,null,this._onStickerClick.bind(this));jc.error&&u.appendContent(dc,jc.error);jc.content&&u.appendContent(dc,jc.content);fc|=jc.bubblePreferred;}var kc=u.scry(dc,'img');kc.forEach(function(lc){this._subscriptions.addSubscriptions(v.listen(lc,'load',hb(this._thumbLoaded,this,lc)));}.bind(this));return !!fc;},_onStickerClick:function(dc,ec){if(!dc)return;l.log('StickersLoggerConfig',{event:'click_sticker',packid:dc,stickerid:ec});var fc=this.tabView;qa.onTrayDataReady(function(){if(xa(qa.getPackIDsInTray(),dc)){fc.setStickersFlyoutPackID(dc);}else ra.showStore(dc);});},_thumbLoaded:function(dc){var ec=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(ec+dc.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();},_checkToAnimateSticker:function(){var dc=eb(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:dc.y,viewHeight:dc.height});},setNewThreadID:function(dc){if(o.get('chat_react_user_messages')){this._store.setNewThreadID(dc);}else this._newThreadID=dc;}});if(!o.get('chat_react_user_messages')){ob.subscribe('messages-reordered',function(dc,ec){ac.forEach(function(fc){ec[fc.threadID]&&fc.rerender();});});ob.subscribe('messages-updated',function(dc,ec){ac.forEach(function(fc){ec[fc.threadID]&&fc.update(ec[fc.threadID]);});});ob.subscribe('messages-received',function(dc,ec){ac.forEach(function(fc){var gc=ec[fc.threadID];if(gc&&gc.length){fc._currentMessageCount+=gc.length;fc._appendNewMessages(gc);}if(fc._newThreadID){var hc=ec[fc._newThreadID];if(hc&&hc.length){fc._currentMessageCount+=hc.length;fc._appendNewMessages(hc);fc._newThreadID=null;}}});});h.subscribe(m.getArbiterType('chat_event'),function(dc,ec){if(cc(ec.obj)){var fc=(t.getID()==ec.obj.from)?ec.obj.to:ec.obj.from,gc=nb.getThreadIdForUser(fc),hc=ac.filter(function(kc){return kc.threadID===gc;});if(hc.length>0){var ic=hc[0],jc=kb.constructLogMessageObject(ea.CHAT_WEB,gc,da.VIDEO_CALL,ec.obj);jc.author='fbid:'+ec.obj.from;ic._appendNewMessages([jc]);}}});}function cc(dc){return (dc.event_name==='installing'||dc.event_name==='install_canceled');}e.exports=bc;});
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable())this._tokenizer.removeToken(t);}else this._typeahead.getCore().reset();return false;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;});
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new g('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);h.openThread(p,'MultiChatController');},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","ChatOpenTab","MercuryLogMessageType","MercurySourceType","MultiChatController","Style","copyProperties","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryMessages').get(),p=b('MercuryThreads').get();function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;this._typeahead=null;}n(q.prototype,g,{render:function(){p.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;this._typeahead=h.render(this,this._sheetView,this._rootElement,t,u.bind(null,t),p.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('tokens-changed',function(){this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return m.get(this._rootElement,'height');}});function r(t,u){var v=t.participants;l.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(p.isEmptyLocalThread(v)){p.addParticipantsToThreadLocally(v,u);}else o.sendMessage(o.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));i.openThread(v,'ChatAddFriendsTabSheet');}e.exports=q;});
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;});
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.bind(null,r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;});
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","copyProperties","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;l.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}k(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){m.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!m.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.DOM.a({href:"/help/224049364288051"},"Learn more"))]));}else return ("You cannot reply to this conversation.");},getEarlyWarning:function(j){if(!j.has_email_participant)return null;return (h._("We're sorry, but soon you won't be able to reply to this conversation because it includes email addresses. Please message these people through their Facebook accounts or switch over to your email account to keep this conversation going. {Learn more}.",[h.param("Learn more",g.DOM.a({href:"/help/703286543026907"},"Learn more"))]));}};e.exports=i;});
__d("ChatReadOnlyTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyTabSheet0=l;this.$ChatReadOnlyTabSheet1=m;this.$ChatReadOnlyTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getReason(j.getThreadMetaNow(this.$ChatReadOnlyTabSheet0));g.renderComponent(g.DOM.div({className:"_87-"},l),this.$ChatReadOnlyTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};e.exports=k;});
__d("ChatReadOnlyEarlyWarningTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet0=l;this.$ChatReadOnlyEarlyWarningTabSheet1=m;this.$ChatReadOnlyEarlyWarningTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getEarlyWarning(j.getThreadMetaNow(this.$ChatReadOnlyEarlyWarningTabSheet0));g.renderComponent(g.DOM.div({className:"_87-"},l),this.$ChatReadOnlyEarlyWarningTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getCloseTimeout=function(){"use strict";return 20000;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only-early-warning';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};e.exports=k;});
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryParticipants","ChatTabTemplates","copyProperties","cx","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreads').get();function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=r.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=n[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=q._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=q._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;m.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatReadOnlyEarlyWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryThreads').get(),t=function(u,v,w){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);this._readOnlyEarlyWarningTabSheet=new n(u,v,this._sheetView);if(!s.getCanonicalUserInThread(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};q(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openReadOnlyEarlyWarningSheet:function(){this._readOnlyEarlyWarningTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;});
__d("AbstractTextFieldMixin.react",["React","Keys","cx","invariant","joinClasses","mergeInto"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={propTypes:{value:g.PropTypes.string,placeholder:g.PropTypes.string,tabIndex:g.PropTypes.string,maxLength:g.PropTypes.number,onBackspace:g.PropTypes.func,onBackTab:g.PropTypes.func,onBlur:g.PropTypes.func,onChange:g.PropTypes.func,onDownArrow:g.PropTypes.func,onEnter:g.PropTypes.func,onFocus:g.PropTypes.func,onKeyDown:g.PropTypes.func,onLeftArrow:g.PropTypes.func,onNoShiftEnter:g.PropTypes.func,onRightArrow:g.PropTypes.func,onShiftEnter:g.PropTypes.func,onShiftDownArrow:g.PropTypes.func,onShiftUpArrow:g.PropTypes.func,onTab:g.PropTypes.func,onUpArrow:g.PropTypes.func,type:g.PropTypes.string},getInitialState:function(){return {focused:false,value:this.props.defaultValue||''};},getValue:function(){return this.props.value!=null?''+this.props.value:this.state.value;},onInputKeyDown:function(n){var o=this.props,p=n.keyCode,q=n.shiftKey;if(p===h.BACKSPACE&&!q&&o.onBackspace){o.onBackspace(n);}else if(p===h.TAB&&!q&&o.onTab){o.onTab(n);}else if(p===h.TAB&&q&&o.onBackTab){o.onBackTab(n);}else if(p===h.UP){if(q){if(o.onShiftUpArrow)o.onShiftUpArrowAttempt(n);}else if(o.onUpArrow)o.onUpArrow(n);}else if(p===h.DOWN&&o.onDownArrow){if(q){if(o.onShiftDownArrow)o.onShiftDownArrow(n);}else if(o.onDownArrow)o.onDownArrow(n);}else if(p===h.LEFT&&o.onLeftArrow){o.onLeftArrow(n);}else if(p===h.RIGHT&&o.onRightArrow){o.onRightArrow(n);}else if(p===h.RETURN){if(o.onEnter)o.onEnter(n);if(q){if(o.onShiftEnter)o.onShiftEnter(n);}else if(o.onNoShiftEnter)o.onNoShiftEnter(n);}if(o.onKeyDown)o.onKeyDown(n);},onInputChange:function(n){if(this.props.onChange)this.props.onChange(n);this.setState({value:n.target.value});},focusInput:function(){this.getTextFieldDOM().focus();},blurInput:function(){this.getTextFieldDOM().blur();},onInputBlur:function(event){if(this.props.onBlur)this.props.onBlur(event);if(!event.isDefaultPrevented())this.setState({focused:false});},onInputFocus:function(event){if(this.props.onFocus)this.props.onFocus(event);if(!event.isDefaultPrevented())this.setState({focused:true});},getTextFieldDOM:function(){return this.refs[this.getTextFieldRef()].getDOMNode();},getTextFieldRef:function(){return 'textField';},setTextFieldPropsOn:function(n){l(n.props,{'aria-activedescendant':this.props['aria-activedescendant'],'aria-autocomplete':this.props['aria-autocomplete'],'data-testid':this.props['data-testid'],ref:this.getTextFieldRef(),onKeyDown:this.onInputKeyDown,onBlur:this.onInputBlur,onFocus:this.onInputFocus,onChange:this.onInputChange,disabled:this.props.disabled,defaultValue:this.props.defaultValue,name:this.props.name,value:this.getValue(),id:this.props.id,maxLength:this.props.maxLength,min:this.props.min,max:this.props.max,type:this.props.type||n.props.type});return n;},render:function(){var n=null;if(!this.getValue()){var o=(("_58ai")+(this.state.focused?' '+"_58aj":''));n=g.DOM.span({className:o},this.props.placeholder);}var p=k(this.props.className,"_58ak");j(this.renderTextField);return (g.DOM.label({className:p},{placeholder:n,textField:this.renderTextField()}));}};e.exports=m;});
__d("ContextualLayer.react",["ContextualLayer","React","ReactLayer","Style"],function(a,b,c,d,e,f,g,h,i,j){var k=h.PropTypes,l=i.createClass({propTypes:{contextRef:k.string,context:function(m,n,o){if((m.context==null)==(m.contextRef==null))return new Error(("Exactly one of `context` or `contextRef` must be set on `")+(o+"`."));var p=m[n];if(p!=null){if(typeof p!=='object')return new Error(("Invalid `"+n+"` supplied to `"+o+"`, ")+("expected a React component."));if(h.isValidComponent(p))return new Error(("Invalid `"+n+"` supplied to `"+o+"`, ")+("expected a React component instance. You're passing a React ")+("descriptor."));}}},immutableProps:{modal:null},createLayer:function(m){var n=this._getContextNode(),o={context:n,contextBounds:this.props.contextBounds,position:this.props.position,alignment:this.props.alignment,offsetX:this.props.offsetX,offsetY:this.props.offsetY,addedBehaviors:this.enumerateBehaviors(this.props.behaviors),shouldSetARIAProperties:this.props.shouldSetARIAProperties},p=new g(o,m);this._node=m;this._matchContextSize(this.props);p.conditionShow(this.props.shown);return p;},receiveProps:function(m){this.updateBehaviors(m.behaviors);var n=this._getContextNode();if(m.contextBounds){this.layer.setContextWithBounds(n,m.contextBounds);}else this.layer.setContext(n);this._matchContextSize(m);this.layer.setPosition(m.position);this.layer.setAlignment(m.alignment);this.layer.setOffsetX(m.offsetX);this.layer.setOffsetY(m.offsetY);this.layer.conditionShow(m.shown);},_getContextNode:function(){var m;if(this.props.context){m=this.props.context.getDOMNode();}else if(this.props.contextRef)m=this.getNodeForOwnerRef(this.props.contextRef);return m;},_matchContextSize:function(m){var n=this._node,o=this._getContextNode();if(m.containerWidthMatchContext)j.set(n,'width',o.offsetWidth+'px');if(m.containerHeightMatchContext)j.set(n,'height',o.offsetHeight+'px');}});e.exports=l;});
__d("AbstractTextInput.react",["AbstractTextFieldMixin.react","React","ReactDOMInput","cx"],function(a,b,c,d,e,f,g,h,i,j){var k=h.createClass({displayName:'AbstractTextInput',mixins:[g],renderTextField:function(){return this.setTextFieldPropsOn(i({type:"text",className:"_58al",tabIndex:this.props.tabIndex,onClick:this.props.onClick,onKeyUp:this.props.onKeyUp,onPaste:this.props.onPaste}));}});e.exports=k;});
__d("SearchableTextInput.react",["EventListener","React","AbstractTextFieldMixin.react","AbstractTextInput.react","getActiveElement","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.createClass({displayName:'SearchableTextInput',propTypes:l(i.propTypes,{queryString:h.PropTypes.string,searchSource:h.PropTypes.object,searchSourceOptions:h.PropTypes.object,onEntriesFound:h.PropTypes.func.isRequired,searchOnFocus:h.PropTypes.bool,searchOnUpdate:h.PropTypes.bool,onPaste:h.PropTypes.func,onFocus:h.PropTypes.func,onChange:h.PropTypes.func}),componentDidMount:function(){if(this.props.onPaste)this._listener=g.listen(this.refs.input.getTextFieldDOM(),'paste',this.props.onPaste);},componentDidUpdate:function(n){if(this.props.searchOnUpdate)if(n.queryString!==this.props.queryString)this.search(this.props.queryString);},componentWillUnmount:function(){if(this._listener){this._listener.remove();this._listener=null;}},_onInputFocus:function(){this.props.searchSource.bootstrap(function(){if(this.props.searchOnFocus)this.search(this.props.queryString);}.bind(this));this.props.onFocus&&this.props.onFocus();},_onSearchCallback:function(n,o){if(this.props.queryString===o)this.props.onEntriesFound(n);},_onChange:function(event){this.props.onChange&&this.props.onChange(event);var n=event.target.value;setTimeout(function(){this.search(n);}.bind(this));},search:function(n){this.props.searchSource.search(n,this._onSearchCallback,this.props.searchSourceOptions);},focusInput:function(){var n=this.getTextFieldDOM();if(k()===n){this._onInputFocus();}else n.offsetHeight&&n.focus();},blurInput:function(){var n=this.getTextFieldDOM();n.offsetHeight&&n.blur();},getTextFieldDOM:function(){return this.refs.input.getTextFieldDOM();},render:function(){return this.transferPropsTo(j({ref:"input",value:this.props.queryString||'',onFocus:this._onInputFocus,onChange:this._onChange}));}});e.exports=m;});
__d("TypeaheadNavigation",[],function(a,b,c,d,e,f){var g={moveUp:function(h,i,j){var k=h.indexOf(i),l=k==-1?h.length-1:k-1;j(l==-1?null:h[l]);},moveDown:function(h,i,j){var k=h.indexOf(i)+1;j(k==h.length?null:h[k]);}};e.exports=g;});
__d("TypeaheadView.react",["React","cx","merge"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:'TypeaheadView',propTypes:{entries:g.PropTypes.array.isRequired,extraRendererProps:g.PropTypes.object,highlightedEntry:g.PropTypes.object,isVisible:g.PropTypes.bool,queryString:g.PropTypes.string,Renderer:g.PropTypes.func.isRequired,selectedEntry:g.PropTypes.object},_onSelect:function(k){if(this.props.onSelect)this.props.onSelect(k);},_onHighlight:function(k){this.props.onHighlight(k);},render:function(){var k=((!this.props.isVisible?"hidden_elem":'')),l=i({highlightedEntry:this.props.highlightedEntry,selectedEntry:this.props.selectedEntry,entries:this.props.entries,onSelect:this._onSelect,onHighlight:this._onHighlight,onRenderHighlight:this.props.onRenderHighlight,queryString:this.props.queryString},this.props.extraRendererProps);return (g.DOM.div({className:k},this.props.Renderer(l)));}});e.exports=j;});
__d("AbstractTypeahead.react",["AbstractTextFieldMixin.react","ContextualLayer.react","InputSelection","React","ReactLayeredComponentMixin","SearchableTextInput.react","TypeaheadNavigation","TypeaheadView.react","cx","getOrCreateDOMID","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=10,s=j.createClass({displayName:'AbstractTypeahead',mixins:[k],propTypes:q(g.propTypes,{inputClassName:j.PropTypes.string,placeholder:j.PropTypes.string,queryString:j.PropTypes.string,searchSource:j.PropTypes.object.isRequired,searchSourceOptions:j.PropTypes.object,excludedEntries:j.PropTypes.object,presenter:j.PropTypes.object.isRequired,onSelectAttempt:j.PropTypes.func,autoHighlight:j.PropTypes.bool,showEntriesOnFocus:j.PropTypes.bool,selectOnBlur:j.PropTypes.bool,selectOnTab:j.PropTypes.bool,focusedOnInit:j.PropTypes.bool,hideViewWithEntries:j.PropTypes.bool,disabled:j.PropTypes.bool,entriesWidthMatchContext:j.PropTypes.bool,selectedEntry:j.PropTypes.object,onTypeaheadVisibilityChanged:j.PropTypes.func,onPaste:j.PropTypes.func}),getDefaultProps:function(){return {selectOnBlur:false,selectOnTab:true,hideViewWithEntries:true,entriesWidthMatchContext:true};},getInitialState:function(){return {highlightedEntry:null,isAutoHighlight:this.props.autoHighlight,activeDescendant:null,activeEntries:[],focused:!!this.props.focusedOnInit,viewIsVisible:!!this.props.focusedOnInit};},_onRenderHighlight:function(t){var u=p(t);this.setState({activeDescendant:u});},_onEntriesFound:function(t){if(this.props.excludedEntries){var u=this.props.excludedEntries;t=t.filter(function(ba){return !u.hasOwnProperty(ba.getUniqueID());});}var v=this.props.presenter,w=typeof v.sortEntries=='function'?v.sortEntries(t):t,x=w.slice(0,v.maxEntries||r);if(!x.length){this.setState({activeDescendant:null,activeEntries:x,highlightedEntry:null,isAutoHighlight:this.props.autoHighlight});this._setViewIsVisible(false);return;}var y=this.state.highlightedEntry,z=y&&x.indexOf(y)!==-1;if(!this.props.autoHighlight){this.setState({activeEntries:x,highlightedEntry:z?y:null});this._setViewIsVisible(true);return;}var aa=this.state.isAutoHighlight;if(aa){y=x[0];}else{y=z?y:x[0];aa=!z;}this.setState({activeEntries:x,highlightedEntry:y,isAutoHighlight:aa});if(this.state.focused&&this.props.showEntriesOnFocus||this.props.queryString.length>0)this._setViewIsVisible(true);},_onInputFocus:function(){if((this.state.activeEntries.length&&this.state.queryString)||this.props.showEntriesOnFocus)this._setViewIsVisible(true);this.setState({focused:true});this.props.onFocus&&this.props.onFocus();},_onInputBlur:function(){if(this.props.hideViewWithEntries){this._setViewIsVisible(false);this.clearActiveEntries();}if(this.props.selectOnBlur&&this.state.highlightedEntry)this.props.onSelectAttempt(this.state.highlightedEntry);this.setState({focused:false});this.props.onBlur&&this.props.onBlur();},_onInputClick:function(){var t=this.getTextFieldDOM(),u=i.get(t);if(u.start==u.end)t.select();this.props.onClick&&this.props.onClick();},_onEnter:function(event){if(!this.state.viewIsVisible)return;if(!this.state.highlightedEntry){event.preventDefault();return;}if(this.props.hideViewWithEntries)this._setViewIsVisible(false);if(this.props.onSelectAttempt)this.props.onSelectAttempt(this.state.highlightedEntry);event.preventDefault();},_onTab:function(event){if(this.selectOnTab&&this.state.viewIsVisible&&this.props.onSelectAttempt&&this.state.highlightedEntry){if(this.props.hideViewWithEntries){this._setViewIsVisible(false);event.preventDefault();}this.props.onSelectAttempt(this.state.highlightedEntry);}},_onDownArrow:function(event){event.preventDefault();m.moveDown(this.state.activeEntries,this.state.highlightedEntry,this._setHighlight);},_onUpArrow:function(event){event.preventDefault();m.moveUp(this.state.activeEntries,this.state.highlightedEntry,this._setHighlight);},_setHighlight:function(t){this.setState({highlightedEntry:t,isAutoHighlight:!t});},_onInputChange:function(event){if(this.props.onChange)this.props.onChange(event);this._setViewIsVisible(this.state.focused&&(this.props.showEntriesOnFocus||event.target.value.length>0)&&this.state.activeEntries.length>0);},_onViewHighlight:function(t){this.setState({highlightedEntry:t,isAutoHighlight:false});},_getView:function(){return (n({Renderer:this.props.presenter.ViewRenderer,extraRendererProps:this.props.presenter.extraRendererProps,highlightedEntry:this.state.highlightedEntry,selectedEntry:this.props.selectedEntry,isVisible:this.state.viewIsVisible,onHighlight:this._onViewHighlight,onRenderHighlight:this._onRenderHighlight,onSelect:this.props.onSelectAttempt,entries:this.state.activeEntries,queryString:this.props.queryString}));},_setViewIsVisible:function(t){if(t!==this.state.viewIsVisible){this.props.onTypeaheadVisibilityChanged&&this.props.onTypeaheadVisibilityChanged(t);this.setState({viewIsVisible:t});}},componentWillReceiveProps:function(t){if(!t.queryString&&!this.props.showEntriesOnFocus)this.clearActiveEntries();},renderLayers:function(){if(!this.props.presenter.useLayer)return {};var t=null,u=null;if(this.props.context){t=this.props.context;}else u='input';return {typeaheadView:h({containerWidthMatchContext:this.props.entriesWidthMatchContext,contextRef:u,context:t,position:"below",shown:this.state.viewIsVisible,shouldSetARIAProperties:false},this._getView())};},render:function(){var t=l({'aria-activedescendant':this.state.activeDescendant,'aria-autocomplete':"list",ref:"input",className:this.props.inputClassName,queryString:this.props.queryString,placeholder:this.props.placeholder,searchSource:this.props.searchSource,searchSourceOptions:this.props.searchSourceOptions,searchOnFocus:!!this.props.showEntriesOnFocus,disabled:this.props.disabled,onEntriesFound:this._onEntriesFound,onBlur:this._onInputBlur,onFocus:this._onInputFocus,onChange:this._onInputChange,onDownArrow:this._onDownArrow,onUpArrow:this._onUpArrow,onTab:this._onTab,onEnter:this._onEnter,onBackspace:this.props.onBackspace,onPaste:this.props.onPaste,onClick:this._onInputClick}),u=null;if(!this.props.presenter.useLayer)u=this._getView();return this.transferPropsTo(j.DOM.span({className:"_58ah"},{searchableInput:t,view:u}));},componentDidMount:function(){if(this.props.focusedOnInit)this.refs.input.focusInput();},clearActiveEntries:function(){this.setState({activeDescendant:null,activeEntries:[],highlightedEntry:null});},focusInput:function(){this.refs.input.focusInput();},blurInput:function(){this.refs.input.blur();},getTextFieldDOM:function(){return this.refs.input.getTextFieldDOM();}});e.exports=s;});
__d("AbstractSearchSource",["Deferred","emptyFunction","mixInto"],function(a,b,c,d,e,f,g,h,i){function j(){}var k={bootstrap:function(l){l=l||h;if(this._bootstrapped){l();return;}if(this._bootstrapDeferred)return this._bootstrapDeferred.addCallback(l);this._bootstrapDeferred=new g();this._bootstrapDeferred.addCallback(l);this.bootstrapImpl(function(){this._bootstrapped=true;this._bootstrapDeferred.succeed();this._bootstrapDeferred=null;}.bind(this));return this._bootstrapDeferred;},search:function(l,m,n){this.searchImpl(l,m,n);},bootstrapImpl:function(l){l();},searchImpl:function(l,m,n){throw new Error('Abstract method #searchImpl is not implemented.');}};i(j,k);j.Mixin=k;e.exports=j;});
__d("SearchSourceCallbackManager",["createObjectFrom","invariant"],function(a,b,c,d,e,f,g,h){function i(k){"use strict";this.$SearchSourceCallbackManager0=k.parseFn;h(typeof this.$SearchSourceCallbackManager0==='function');this.$SearchSourceCallbackManager1=k.matchFn;h(typeof this.$SearchSourceCallbackManager1==='function');this.$SearchSourceCallbackManager2=k.alwaysPrefixMatch||false;this.$SearchSourceCallbackManager3=k.indexFn||j;this.reset();}i.prototype.search=function(k,l,m){"use strict";var n=this.$SearchSourceCallbackManager4(k,l,m);if(n)return 0;this.$SearchSourceCallbackManager5.push({queryString:k,callback:l,options:m});var o=this.$SearchSourceCallbackManager5.length-1;this.$SearchSourceCallbackManager6.push(o);return o;};i.prototype.$SearchSourceCallbackManager4=function(k,l,m){"use strict";var n=this.$SearchSourceCallbackManager7(k),o=!!this.$SearchSourceCallbackManager8[k];if(!n.length){l([],k);return o;}var p=n.map(function(q){return this.$SearchSourceCallbackManager9[q];},this);l(p,k);return o;};i.prototype.$SearchSourceCallbackManagera=function(){"use strict";var k=this.$SearchSourceCallbackManager6;this.$SearchSourceCallbackManager6=[];k.forEach(this.$SearchSourceCallbackManagerb,this);};i.prototype.$SearchSourceCallbackManagerb=function(k){"use strict";var l=this.$SearchSourceCallbackManager5[k];if(!l)return;var m=this.$SearchSourceCallbackManager4(l.queryString,l.callback,l.options);if(m){delete this.$SearchSourceCallbackManager5[k];return;}this.$SearchSourceCallbackManager6.push(k);};i.prototype.reset=function(){"use strict";this.$SearchSourceCallbackManager9={};this.$SearchSourceCallbackManagerc={};this.$SearchSourceCallbackManagerd={};this.$SearchSourceCallbackManagere={};this.$SearchSourceCallbackManager8={};this.$SearchSourceCallbackManager6=[];this.$SearchSourceCallbackManager5=[undefined];};i.prototype.addLocalEntries=function(k){"use strict";k.forEach(function(l){var m=l.getUniqueID(),n=this.$SearchSourceCallbackManager3(l);this.$SearchSourceCallbackManager9[m]=l;this.$SearchSourceCallbackManagerc[m]=n;var o=this.$SearchSourceCallbackManager0(n);o.tokens.forEach(function(p){if(!this.$SearchSourceCallbackManagerd.hasOwnProperty(p))this.$SearchSourceCallbackManagerd[p]={};this.$SearchSourceCallbackManagerd[p][m]=true;},this);},this);this.$SearchSourceCallbackManagera();};i.prototype.addQueryEntries=function(k,l){"use strict";var m=this.$SearchSourceCallbackManager7(l),n=this.$SearchSourceCallbackManager0(l).flatValue;this.$SearchSourceCallbackManagere[n]=g(m,true);k.forEach(function(o){var p=o.getUniqueID();this.$SearchSourceCallbackManager9[p]=o;this.$SearchSourceCallbackManagerc[p]=this.$SearchSourceCallbackManager3(o);this.$SearchSourceCallbackManagere[n][p]=true;},this);this.$SearchSourceCallbackManagera();};i.prototype.unsubscribe=function(k){"use strict";delete this.$SearchSourceCallbackManager5[k];};i.prototype.removeEntry=function(k){"use strict";delete this.$SearchSourceCallbackManager9[k];};i.prototype.getAllEntriesMap=function(){"use strict";return this.$SearchSourceCallbackManager9;};i.prototype.setQueryStringAsExhausted=function(k){"use strict";this.$SearchSourceCallbackManager8[k]=true;};i.prototype.unsetQueryStringAsExhausted=function(k){"use strict";delete this.$SearchSourceCallbackManager8[k];};i.prototype.$SearchSourceCallbackManager7=function(k){"use strict";var l=this.$SearchSourceCallbackManagerf(k,this.$SearchSourceCallbackManagerg(k)),m=this.$SearchSourceCallbackManagerf(k,this.$SearchSourceCallbackManagerh(k)),n=l.concat(m),o={},p=[];n.forEach(function(q){if(!o[q]&&this.$SearchSourceCallbackManager9[q]!==undefined){p.push(q);o[q]=true;}},this);return p;};i.prototype.$SearchSourceCallbackManagerf=function(k,l){"use strict";var m=this.$SearchSourceCallbackManageri(k,l),n=this.$SearchSourceCallbackManager9;function o(p,q){if(m[p]!==m[q])return m[p]?-1:1;var r=n[p],s=n[q];if(r.getOrder()!==s.getOrder())return r.getOrder()-s.getOrder();var t=r.getTitle().length,u=s.getTitle().length;if(t!==u)return t-u;return r.getUniqueID()-s.getUniqueID();}return l.sort(o).slice();};i.prototype.$SearchSourceCallbackManageri=function(k,l){"use strict";var m={};l.forEach(function(n){m[n]=this.$SearchSourceCallbackManager1(k,this.$SearchSourceCallbackManagerc[n]);},this);return m;};i.prototype.$SearchSourceCallbackManagerg=function(k){"use strict";var l=this.$SearchSourceCallbackManager0(k,this.$SearchSourceCallbackManager2),m=this.$SearchSourceCallbackManager2?l.sortedTokens:l.tokens,n=m.length,o=l.isPrefixQuery?n-1:null,p={},q={},r={},s=false,t={},u=0;m.forEach(function(w,x){if(t.hasOwnProperty(w))return;u++;t[w]=true;for(var y in this.$SearchSourceCallbackManagerd){var z=(y===w&&!p.hasOwnProperty(y)),aa=false;if(!z)aa=((this.$SearchSourceCallbackManager2||o===x)&&y.indexOf(w)===0);if(!z&&!aa)continue;if(y===w){if(q.hasOwnProperty(y))s=true;p[y]=true;}else{if(p.hasOwnProperty(y)||q.hasOwnProperty(y))s=true;q[y]=true;}for(var ba in this.$SearchSourceCallbackManagerd[y])if(x===0||(r.hasOwnProperty(ba)&&r[ba]==u-1))r[ba]=u;}},this);var v=Object.keys(r).filter(function(w){return r[w]==u;});if(s||u<n)v=this.$SearchSourceCallbackManagerj(k,v);return v;};i.prototype.$SearchSourceCallbackManagerh=function(k){"use strict";var l=this.$SearchSourceCallbackManager0(k).flatValue,m=this.$SearchSourceCallbackManagerk(l);if(this.$SearchSourceCallbackManagere.hasOwnProperty(l))return m;return this.$SearchSourceCallbackManagerj(k,m);};i.prototype.$SearchSourceCallbackManagerk=function(k){"use strict";var l=0,m=null,n=this.$SearchSourceCallbackManagere;Object.keys(n).forEach(function(o){if(k.indexOf(o)===0&&o.length>l){l=o.length;m=o;}});return (n.hasOwnProperty(m)?Object.keys(n[m]):[]);};i.prototype.$SearchSourceCallbackManagerj=function(k,l){"use strict";return l.filter(function(m){return this.$SearchSourceCallbackManager1(k,this.$SearchSourceCallbackManagerc[m]);},this);};function j(k){return [k.getTitle(),k.getKeywordString()].join(' ');}e.exports=i;});
__d("AbstractAsyncSearchSource",["AbstractSearchSource","SearchSourceCallbackManager","SearchableEntry","TokenizeUtil","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in g)if(g.hasOwnProperty(m))o[m]=g[m];var n=g===null?null:g.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=g;function o(p,q,r){"use strict";this.$AbstractAsyncSearchSource0=p.bootstrapRequests;this.$AbstractAsyncSearchSource1=p.queryRequests;this.$AbstractAsyncSearchSource2=p.auxiliaryFields;this.$AbstractAsyncSearchSource3=p.asyncErrorHandler||l;this.$AbstractAsyncSearchSource4=p.packageFn||this.$AbstractAsyncSearchSource5;this.$AbstractAsyncSearchSource6=p.getAllForEmptyQuery;this.$AbstractAsyncSearchSource7=[];this.$AbstractAsyncSearchSource8=new h({parseFn:j.parse,matchFn:j.isQueryMatch,indexFn:p.indexFn});this.$AbstractAsyncSearchSource9=q;this.$AbstractAsyncSearchSourcea=r;}o.prototype.bootstrapImpl=function(p){"use strict";if(!this.$AbstractAsyncSearchSource0||!this.$AbstractAsyncSearchSource0.length){p();return;}var q=this.$AbstractAsyncSearchSource0.length,r=0;this.$AbstractAsyncSearchSource0.forEach(function(s){this.$AbstractAsyncSearchSourceb({},s,function(t){this.$AbstractAsyncSearchSource8.addLocalEntries(t);this.$AbstractAsyncSearchSource7=this.$AbstractAsyncSearchSource7.concat(t);r++;if(r===q){p();p=null;}}.bind(this));}.bind(this));};o.prototype.searchImpl=function(p,q,r){"use strict";if(this.$AbstractAsyncSearchSource6&&p===''){this.getBootstrappedEntries(function(x){q(x,p);});return;}var s=null,t={},u=this.$AbstractAsyncSearchSource8.search(p,function(x){if(!s){s=x;s.forEach(function(y){t[y.getUniqueID()]=true;});}else x.forEach(function(y){var z=y.getUniqueID();if(!t[z]){s.push(y);t[z]=true;}});q(s,p);},r);if(!u||!this.$AbstractAsyncSearchSource1||!this.$AbstractAsyncSearchSource1.length)return;var v={value:p,existing_ids:s&&s.map(function(x){return x.getUniqueID();}).join(',')},w=this.$AbstractAsyncSearchSource1.length;this.$AbstractAsyncSearchSource1.forEach(function(x){this.$AbstractAsyncSearchSourceb(v,x,function(y){this.$AbstractAsyncSearchSourcec(y,p);w--;if(!w)this.$AbstractAsyncSearchSource8.setQueryStringAsExhausted(p);}.bind(this));},this);};o.prototype.getBootstrappedEntries=function(p){"use strict";return this.bootstrap(function(){return p(this.$AbstractAsyncSearchSource7||[]);}.bind(this));};o.prototype.getAllEntriesMap=function(){"use strict";return this.$AbstractAsyncSearchSource8.getAllEntriesMap();};o.prototype.$AbstractAsyncSearchSourceb=function(p,q,r){"use strict";this.$AbstractAsyncSearchSource9(p,q,function(s){return r(this.$AbstractAsyncSearchSourcea(s,this.$AbstractAsyncSearchSource4));}.bind(this),this.$AbstractAsyncSearchSource3);};o.prototype.$AbstractAsyncSearchSourced=function(p){"use strict";this.$AbstractAsyncSearchSource8.addLocalEntries(p);};o.prototype.$AbstractAsyncSearchSourcec=function(p,q){"use strict";if(p.length)this.$AbstractAsyncSearchSource8.addQueryEntries(p,q);};o.prototype.$AbstractAsyncSearchSource5=function(p,q){"use strict";return new i({uniqueID:p.uniqueID||p.uid,order:p.index||q,title:p.title||p.text,subtitle:p.subtitle||p.category||p.subtext,keywordString:p.keywordString||p.tokens,type:p.type,photo:p.photo,uri:p.path,auxiliaryData:this.$AbstractAsyncSearchSourcee(p)});};o.prototype.$AbstractAsyncSearchSourcee=function(p){"use strict";var q;if(this.$AbstractAsyncSearchSource2){q={};for(var r in this.$AbstractAsyncSearchSource2){var s=this.$AbstractAsyncSearchSource2[r];q[r]=p[s];}}if(p.aux_data){q=q||{};k(q,p.aux_data);}return q;};e.exports=o;});
__d("WebAsyncSearchSource",["AbstractAsyncSearchSource","AbstractSearchSource","AsyncRequest","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n){"use strict";this.$WebAsyncSearchSource0=new g(n,this.$WebAsyncSearchSource1,this.$WebAsyncSearchSource2);}m.prototype.bootstrapImpl=function(n){"use strict";this.$WebAsyncSearchSource0.bootstrap(n);};m.prototype.searchImpl=function(n,o,p){"use strict";this.$WebAsyncSearchSource0.search(n,o,p);};m.prototype.getBootstrappedEntries=function(n){"use strict";return this.$WebAsyncSearchSource0.getBootstrappedEntries(n);};m.prototype.getAllEntriesMap=function(){"use strict";return this.$WebAsyncSearchSource0.getAllEntriesMap();};m.prototype.$WebAsyncSearchSource1=function(n,o,p,q){"use strict";new i(o.uri).setData(j({},n,o.data)).setMethod('GET').setReadOnly(true).setHandler(p).setErrorHandler(q).send();};m.prototype.$WebAsyncSearchSource2=function(n,o){"use strict";var p=n.getPayload().entries||n.getPayload()||[];return p.map(o,this);};e.exports=m;});
__d("getDOMImageSize",["URI"],function(a,b,c,d,e,f,g){function h(m){m.onload=null;m.onerror=null;m.onreadystatechange=null;m._callback=null;m._thisObj=null;m._srcStr=null;m.parentNode&&m.parentNode.removeChild(m);}function i(){var m=this;if(m._callback)m._callback.call(m._thisObj,m.naturalWidth||m.width,m.naturalHeight||m.height,m._srcStr);h(m);}function j(){var m=this;if(m.readyState==='complete')i.call(m);}function k(){var m=this;if(m._callback)m._callback.call(m._thisObj,0,0,m._srcStr);h(m);}function l(m,n,o){o=o||null;if(!m){n.call(o,0,0,'');return;}var p=document.body;if(!p){setTimeout(l.bind(this,m,n,o),500);return;}var q;if(typeof m==='string'){q=m;}else if(typeof m==='object')if(typeof m.width==='number'&&typeof m.height==='number'){if(typeof m.src==='string'){q=m.src;if(m.naturalWidth&&m.naturalHeight){n.call(o,m.naturalWidth,m.naturalHeight,q);return;}}if(typeof m.uri==='string'){q=m.uri;if(m.width&&m.height){n.call(o,m.width,m.height,q);return;}}}else if(m instanceof g)q=m.toString();if(!q){n(0,0,m);return;}var r=document.createElement('img');r.onreadystatechange=j;r.onload=i;r.onerror=k;r._callback=n;r._thisObj=o;r._srcStr=q;r.src=q;r.style.cssText='position:absolute;left:0;top:0;width:auto;height:auto;clip:rect(0 0 0 0);';p.insertBefore(r,p.firstChild);}e.exports=l;});
__d("CachedDOMImageSizePool",["debounce","getDOMImageSize"],function(a,b,c,d,e,f,g,h){function i(j,k){"use strict";this.$CachedDOMImageSizePool0={};this.$CachedDOMImageSizePool1=k;this.$CachedDOMImageSizePool2=0;this.$CachedDOMImageSizePool3=j;this.$CachedDOMImageSizePool4=g(this.$CachedDOMImageSizePool5,5000,this);this.$CachedDOMImageSizePool6={};this.$CachedDOMImageSizePool7={};}i.prototype.get=function(j,k,l){"use strict";if(!j){k.call(l,0,0,j);return;}var m=this.$CachedDOMImageSizePool0[j];if(m){m.lastAccessTime=Date.now();k.call(l,m.width,m.height,m.src);}else if(this.$CachedDOMImageSizePool6[j]){this.$CachedDOMImageSizePool6[j].push(k);this.$CachedDOMImageSizePool7[j].push(l);}else{this.$CachedDOMImageSizePool6[j]=[k];this.$CachedDOMImageSizePool7[j]=[l];h(j,this.$CachedDOMImageSizePool8,this);}};i.prototype.set=function(j,k,l){"use strict";if(this.$CachedDOMImageSizePool2>this.$CachedDOMImageSizePool3)this.$CachedDOMImageSizePool4();var m=this.$CachedDOMImageSizePool0;if(j&&!m[j]){var n={width:k,height:l,src:j,lastAccessTime:Date.now()};m[j]=n;this.$CachedDOMImageSizePool2++;}};i.prototype.$CachedDOMImageSizePool8=function(j,k,l){"use strict";this.set(l,j,k);var m=this.$CachedDOMImageSizePool6[l],n=this.$CachedDOMImageSizePool7[l];for(var o=0,p=m.length;o<p;o++)m[o].call(n[o],j,k,l);delete this.$CachedDOMImageSizePool6[l];delete this.$CachedDOMImageSizePool7[l];};i.prototype.$CachedDOMImageSizePool5=function(){"use strict";var j=Date.now(),k=this.$CachedDOMImageSizePool0,l=this.$CachedDOMImageSizePool2,m=this.$CachedDOMImageSizePool1;for(var n in k){var o=k[n];if((j-o.lastAccessTime)>m){delete k[n];l--;}}this.$CachedDOMImageSizePool2=l;};e.exports=i;});
__d("BackgroundImage.react",["CachedDOMImageSizePool","React","ReactPropTypes","XUISpinner.react","cx","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='(-?(\\d+\\.)?\\d+(px|\\%))',o=new RegExp('^'+n+'?(\\s'+n+')?$','g'),p=new g(50,10*60*1000),q=h.createClass({displayName:'BackgroundImage',propTypes:{src:i.string,width:i.number.isRequired,height:i.number.isRequired,backgroundSize:i.oneOf(['contain','cover','containinside','coverinside']),loadingIndicatorStyle:i.oneOf(['none','large','small']),backgroundPosition:function(r,s,t){var u=r[s];if(u){l(typeof u==='string');l(u.match(o));}},onImageLoad:i.func,optimizeResizeSpeed:i.bool,onContextMenu:i.func},getInitialState:function(){return {imageWidth:null,imageHeight:null,imageSrc:this.props.src,loading:true};},getDefaultProps:function(){return {optimizeResizeSpeed:false,loadingIndicatorStyle:'none'};},componentDidMount:function(){this._resolveImageSize();},componentDidUpdate:function(r){if(this.props.src!==this.state.imageSrc)this.setState({imageWidth:0,imageHeight:0,imageSrc:this.props.src,loading:true},this._resolveImageSize);},_resolveImageSize:function(){var r=this.state.imageSrc;if(r)p.get(r,this._onImageSizeResolved,this);},render:function(){var r={width:this.props.width+'px',height:this.props.height+'px'},s=m(this.props.className,"_5f0d");return this.transferPropsTo(h.DOM.div({className:s,style:r,onContextMenu:this.props.onContextMenu},this._renderImage(),this._renderContent(),this._renderLoadingIndicator()));},_renderLoadingIndicator:function(){if(!this.state.loading||this.props.loadingIndicatorStyle==='none')return null;return (h.DOM.div({className:"_5laq _5lar"},h.DOM.div({className:"_5las"},h.DOM.div({className:"_5lat"},j({size:this.props.loadingIndicatorStyle})))));},_renderContent:function(){if(this.props.children)return (h.DOM.div({className:"_5laq"},h.DOM.div({className:"_5las"},h.DOM.div({className:"_5lat"},this.props.children))));},_renderImage:function(){if(!this.state.imageWidth||!this.state.imageHeight)return;var r=this.props.width,s=this.props.height,t,u;switch(this.props.backgroundSize){case 'cover':t='cover';u=false;break;case 'coverinside':t='cover';u=true;break;case 'contain':t='contain';u=false;break;case 'containinside':t='contain';u=true;}var v=this.state.imageWidth,w=this.state.imageHeight,x=r/s,y=v/w;if(t==='contain')if((v>r||!u)&&y>=x){v=r;w=v/y;}else if(w>s||!u){w=s;v=w*y;}if(t==='cover')if((v>r||!u)&&y>=x){w=s;v=w*y;}else if(w>s||!u){v=r;w=v/y;}var z=this._getImageStyle(v,w);return (h.DOM.img({alt:"",className:(("_5i4g")+(this.props.optimizeResizeSpeed?' '+"_5sjv":'')),style:z,src:this.state.imageSrc}));},_getImageStyle:function(r,s){var t;if(this.props.backgroundPosition){t=this.props.backgroundPosition.split(' ');}else t=['50%','50%'];return {width:Math.round(r)+'px',height:Math.round(s)+'px',left:this._getBackgroundPositionPxValue('left',t[0],r,s),top:this._getBackgroundPositionPxValue('top',t[1]||t[0],r,s)};},_getBackgroundPositionPxValue:function(r,s,t,u){var v=parseFloat(s),w=s.substr(v.toString().length);if(w==='px')return s;if(r==='left'){return Math.round((this.props.width-t)*(v/100))+'px';}else return Math.round((this.props.height-u)*(v/100))+'px';},_onImageSizeResolved:function(r,s,t){if(!this.isMounted()||this.state.imageSrc!==t)return;var u=this.props.onImageLoad?this.props.onImageLoad.bind(null,r,s):null;this.setState({imageWidth:r,imageHeight:s,loading:false},u);}});e.exports=q;});
__d("ContentRollTypeaheadView.react",["BackgroundImage.react","ImageBlock.react","LegacyScrollableArea.react","React","TypeaheadViewItem","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'ContentRollTypeaheadViewItem',mixins:[k.Mixin],propTypes:k.propTypes,render:function(){var p=this.props.entry,q=p.getSubtitle()?j.DOM.div({className:"_599q"},p.getSubtitle()):null;if(q&&p.getAuxiliaryData()&&p.getAuxiliaryData().icon)q=h({spacing:"small"},g({width:16,height:16,src:p.getAuxiliaryData().icon}),q);var r=p.getPhoto()?g({width:32,height:32,backgroundSize:"cover",src:p.getPhoto()}):j.DOM.span(null),s=(("_5yww")+(!q?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''));return (j.DOM.li({className:s,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight},h({spacing:"medium"},r,j.DOM.div(null,j.DOM.div({className:"_599p"},p.getTitle()),q))));}}),o=j.createClass({displayName:'ContentRollTypeaheadView',propTypes:{highlightedEntry:j.PropTypes.object,entries:j.PropTypes.array.isRequired,onSelect:j.PropTypes.func.isRequired,onHighlight:j.PropTypes.func,onRenderHighlight:j.PropTypes.func,scrollableAreaHeight:j.PropTypes.number.isRequired,scrollableAreaWidth:j.PropTypes.number.isRequired},_renderItem:function(p){var q=p===this.props.highlightedEntry;return (n({key:p.getUniqueID(),entry:p,highlighted:q,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var p=(("_2072")+(!this.props.entries.length?' '+"_599s":'')),q=this.props.entries,r={};q.forEach(function(v){r[v.getType()]=r[v.getType()]||[];r[v.getType()].push(v);});var s=[];for(var t in r){var u=null;switch(t){case 'recent':u="Recently Viewed Links";break;case 'saved':u="Saved Links";break;case 'bing':u="Bing Results";break;}if(u)s.push(j.DOM.div({className:"_1opo"},u));r[t].forEach(function(v){s.push(this._renderItem(v));},this);}return (j.DOM.div({className:p},i({height:this.props.scrollableAreaHeight,width:this.props.scrollableAreaWidth},j.DOM.ul(null,s))));}});e.exports=o;});
__d("ContentRollTypeahead.react",["AbstractTypeahead.react","React","ReactPropTypes","WebAsyncSearchSource","ContentRollTypeaheadView.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=20,o='/ajax/metacomposer/attachment/og/typeahead/content_roll',p=h.createClass({displayName:'ContentRollTypeahead',propTypes:{className:i.string,onSelection:i.func.isRequired,scrollableAreaHeight:h.PropTypes.number.isRequired,scrollableAreaWidth:h.PropTypes.number.isRequired,userID:i.string.isRequired,useLayer:i.bool},getInitialState:function(){return {query:''};},_handleChange:function(event){this.setState({query:event.target.value});},_handleSelectAttempt:function(q){this.setState({query:''});var r={object_id:q.getUniqueID(),url:q.getURI(),source:q.getType(),query:q.getAuxiliaryData().query,subindex:q.getAuxiliaryData().subindex,subtotal:q.getAuxiliaryData().subtotal,index:q.getAuxiliaryData().index,total:q.getAuxiliaryData().total};this.props.onSelection(r);},_getSearchSource:function(){if(!this._searchSource)this._searchSource=new j({bootstrapRequests:[{uri:o,data:{viewer:this.props.userID}}],queryRequests:[{uri:o,data:{viewer:this.props.userID}}],getAllForEmptyQuery:true});return this._searchSource;},_getPlaceholder:function(){if(!this._placeholder)this._placeholder="Search for articles, videos, music, and more";return this._placeholder;},focusInput:function(){this.refs.typeahead.focusInput();},render:function(){var q={ViewRenderer:k,maxEntries:n,useLayer:this.props.useLayer,extraRendererProps:{scrollableAreaHeight:this.props.scrollableAreaHeight,scrollableAreaWidth:this.props.scrollableAreaWidth}};return (g({autoHighlight:true,className:this.props.className,focusedOnInit:true,inputClassName:"_55r1",onChange:this._handleChange,onSelectAttempt:this._handleSelectAttempt,placeholder:this._getPlaceholder(),presenter:q,queryString:this.state.query,ref:"typeahead",searchSource:this._getSearchSource(),showEntriesOnFocus:true}));}});e.exports=p;});
__d("ContentRollFlyout.react",["ContentRollTypeahead.react","Parent","React","ReactPropTypes","Toggler","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:'ContentRollFlyout',propTypes:{onSelection:j.func.isRequired,userID:j.string.isRequired},getInitialState:function(){return {showFlyout:false};},componentDidMount:function(){var n=this._getParentToggler();if(n)k.listen('show',n,function(){this.setState({showFlyout:true});}.bind(this));},_getParentToggler:function(){return h.byClass(this.getDOMNode(),'uiToggle');},_hideParentToggler:function(){var n=this._getParentToggler();if(n)k.hide(n);},_handleSelection:function(n){this._hideParentToggler();this.props.onSelection(n);},render:function(){if(!this.state.showFlyout)return i.DOM.div(null);return (g({className:"_5j11",onSelection:this._handleSelection,scrollableAreaHeight:288,scrollableAreaWidth:256,userID:this.props.userID,useLayer:false}));}});e.exports=m;});
__d("EmoticonUtils",["EmoticonsList","Parent","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j){var k='emoticon_',l=g.symbols,m={getEmoteFromTarget:function(n){var o=h.byClass(n,'emoticon');if(!o)return null;var p=null;o.className.split(' ').forEach(function(q){if(j(q,k))p=q.substring(k.length);});return l[p]||null;},insertEmoticon:function(n,o,p){var q=o.substring(0,p.start),r=o.substring(p.end);if(p.start>0&&!i(q,' '))n=' '+n;if(!j(r,' '))n+=' ';var s=q+n+r;p.start+=n.length;p.end=p.start;return {result:s,start:p.start,end:p.end};}};e.exports=m;});
__d("TextInputControl",["DOMControl","Event","Input","copyProperties","debounce"],function(a,b,c,d,e,f,g,h,i,j,k){for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(o){"use strict";g.call(this,o);var p=this.getRoot(),q=k(this.update.bind(this),0);h.listen(p,{input:q,keydown:q,paste:q});}n.prototype.setMaxLength=function(o){"use strict";i.setMaxLength(this.getRoot(),o);return this;};n.prototype.getValue=function(){"use strict";return i.getValue(this.getRoot());};n.prototype.isEmpty=function(){"use strict";return i.isEmpty(this.getRoot());};n.prototype.setValue=function(o){"use strict";i.setValue(this.getRoot(),o);this.update();return this;};n.prototype.clear=function(){"use strict";return this.setValue('');};n.prototype.setPlaceholderText=function(o){"use strict";i.setPlaceholder(this.getRoot(),o);return this;};e.exports=n;});
__d("TextAreaControl",["Arbiter","ArbiterMixin","CSS","DOMControl","Event","Style","TextInputControl","TextMetrics","classWithMixins","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(v,w){return l.getFloat(v,w)||0;}var r=o(m,p(h));for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v){"use strict";this.autogrow=i.hasClass(v,'uiTextareaAutogrow');r.call(this,v);this.width=null;k.listen(v,'focus',this._handleFocus.bind(this));}u.prototype.setAutogrow=function(v){"use strict";this.autogrow=v;return this;};u.prototype.onupdate=function(){"use strict";t.onupdate.call(this);if(this.autogrow){var v=this.getRoot();if(!this.metrics)this.metrics=new n(v);if(typeof this.initialHeight==='undefined'){this.isBorderBox=l.get(v,'box-sizing')==='border-box'||l.get(v,'-moz-box-sizing')==='border-box'||l.get(v,'-webkit-box-sizing')==='border-box';this.borderBoxOffset=q(v,'padding-top')+q(v,'padding-bottom')+q(v,'border-top-width')+q(v,'border-bottom-width');this.initialHeight=v.offsetHeight-this.borderBoxOffset;}var w=this.metrics.measure(),x=Math.max(this.initialHeight,w.height);if(this.isBorderBox)x+=this.borderBoxOffset;if(x!==this.height){this.height=x;l.set(v,'height',x+'px');g.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}};u.prototype.resetHeight=function(){"use strict";this.height=-1;this.update();};u.prototype._handleFocus=function(){"use strict";this.width=null;};u.getInstance=function(v){"use strict";return j.getInstance(v)||new u(v);};e.exports=u;});
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","UserAgent","copyProperties","cx","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=h.symbols;function w(z){return m.byClass(z,"_5r8h");}function x(z,aa,ba,ca){var da=m.byClass(z,'emoticon');if(!da)return;var ea='emoticon_',fa=null;da.className.split(' ').forEach(function(ma){if(u(ma,ea))fa=ma.substring(ea.length);});if(!v[fa])return;if(!ca)return true;var ga=o.getInstance(aa),ha=ga.getValue(),ia=v[fa],ja=ha.substring(0,ba.start),ka=ha.substring(ba.end);if(ba.start>0&&!t(ja,' '))ia=' '+ia;if(!u(ka,' '))ia+=' ';var la=ja+ia+ka;ba.start+=ia.length;ba.end=ba.start;ga.setValue(la);k.set(aa,ba.start,ba.end);return true;}function y(z,aa){var ba={start:0,end:0};function ca(){ba=k.get(aa);}var da=g.find(z,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ea,fa){if(fa.active&&g.contains(z,fa.active)){k.set(aa,ba.start,ba.end);var ga=g.scry(da,'a.emoticon')[0];ga&&j.setWithoutOutline(ga);}}),i.listen(da,'click',function(event){var ea=x(event.getTarget(),aa,ba,true);ea&&p.hide(z);}),i.listen(da,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(z);k.set(aa,ba.start,ba.end);}}),i.listen(aa,'keyup',ca),i.listen(aa,'click',ca));if(q.chrome()||q.ie()||q.opera())this._subscriptions.addSubscriptions(i.listen(da,'mousedown',function(event){var ea=i.listen(document.documentElement,'click',function(event){var fa=event.getTarget(),ga=x(fa,aa,ba,false),ha=w(fa);!ga&&!ha&&p.show(z);ea.remove();});}.bind(this)));}r(y.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});r(y,{create:function(z,aa){return new y(z,aa);}});e.exports=y;});
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;});
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;});
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(v){if(!k.isOnline())return false;if(v){var w=n.getNow(v);return w&&w.type=="friend"&&m.allows(v);}return true;}function u(v,w,x,y,z){"use strict";this.userID=v;this.input=w;this.source=x;this.threadID=z;this.remoteState=o.INACTIVE;this.notifyTimer=null;y=y||{};this.notifyDelay=y.notifyDelay||this.notifyDelay;this._typingDetector=new o(w);this._typingDetector.init(y);this._typingDetector.subscribe('change',this._stateChange.bind(this));}u.prototype.setUserAndThread=function(v,w){"use strict";if(this.userID!==v||this.threadID!==w){this.resetState();this.userID=v;this.threadID=w;}};u.prototype.setIgnoreEnter=function(v){"use strict";var w=v?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(w);};u.prototype.resetState=function(){"use strict";this.remoteState=u.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};u.prototype._stateChange=function(v,w){"use strict";if(w!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,w),this.notifyDelay);}else this._notifyState(w,true);};u.prototype._notifyState=function(v,w){"use strict";if(!this.userID&&!this.threadID)return;var x=this.userID,y=t(x);if(y&&v!=this.remoteState){this.remoteState=v;if(j.disconnected())return;var z={typ:v,to:x,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,x)).setErrorHandler(q).setData(z).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!w).send();}};u.prototype._onTypResponse=function(v,w){"use strict";var x=w.getPayload()||{};if(x.offline)h.set(v,i.OFFLINE,'typing_response');};p(u.prototype,{notifyDelay:1000});e.exports=u;});
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatFileUploader.react","ChatOpenTab","ChatPhotoEditorContextualDialog","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatTabMenu.react","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","MercuryConstants","ContentRollFlyout.react","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","EmoticonsList","EmoticonUtils","Event","Focus","Input","Keys","Locale","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","SelectionPosition","StickerMacros","StickersFlyout.react","StickerState","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","copyProperties","cx","fbt","isEmpty","setIntervalAcrossTransitions","tx","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc){"use strict";var cc=b('MercuryMessages').get(),dc=b('MercuryServerRequests').get(),ec=b('MercuryThreadInformer').get(),fc=b('MercuryThreadMetadataRenderer').get(),gc=b('MercuryThreads').get(),hc=/^\s*$/,ic={},jc=null,kc,lc,mc=10;function nc(id,jd){var kd=ia.create('div');jd=jd&&jd.filter(function(nd){return nd!=ua.user;});if(zb(jd))return qb.remove(id);var ld=jd.length,md=ld-mc;if(md>1)jd=jd.slice(0,mc);ua.getMulti(jd,function(nd){for(var od in nd){var pd=nd[od],qd=nb[':fb:mercury:chat:multichat-tooltip-item'].build();ia.setContent(qd.getNode('name'),pd.name);var rd=ua.getUserID(od),sd=rd&&eb.get(rd)==l.ACTIVE;ea.conditionShow(qd.getNode('icon'),sd);ea.conditionClass(qd.getNode('name'),'tooltipItemWithIcon',sd);ia.appendContent(kd,qd.getRoot());}if(md>1){var td=yb._("and {number of hidden chat participants} more.",[yb.param("number of hidden chat participants",md)]);ia.appendContent(kd,ia.create('div',{},td));}qb.set(id,kd,'above');});}var oc={},pc=null,qc=false;function rc(id,jd,kd){if(kd){oc[id]=jd;if(!pc)pc=ac(sc,600);}else{ea.removeClass(jd,'highlightTitle');delete oc[id];}}function sc(){for(var id in oc){var jd=oc[id];if(jd.parentNode){ea.conditionClass(jd,'highlightTitle',qc);}else delete oc[id];}qc=!qc;if(!Object.keys(oc).length){clearInterval(pc);pc=null;}}function tc(id){var jd=dc.tokenizeThreadID(id);switch(jd.type){case 'user':return nb[':fb:mercury:chat:user-tab'].build();}return nb[':fb:mercury:chat:multichat-tab'].build();}function uc(id){var jd=id._tabTemplate.getNode('input').value||'',kd=id._fileUploader.getAttachments();if(ad(id))wc(id,jd,kd,function(ld){var md=id._fileUploader.getImageFiles();if(md.length>0){ld.image_ids=md;ld.has_attachment=true;}var nd=id._fileUploader.getVideoFiles();if(nd.length>0){ld.video_ids=nd;ld.has_attachment=true;}cc.sendMessage(ld);id._fileUploader.removeAttachments();id._shareLinkUploader.clear();id._getNode('input').value='';id._lastMessageIndicator&&id._lastMessageIndicator.resetState();id._messagesView&&id._messagesView.scrollToBottom();});}function vc(id,jd){if(jd===0)return;dd(id,cb.POST_PUBLISHED,{count:jd});id._waterfallID=vb.generate();}function wc(id,jd,kd,ld){gc.getThreadMeta(id._threadID,function(md){var nd=cc.constructUserGeneratedMessageObject(jd,va.CHAT_WEB,id._threadID);if(kd.length>0){nd.has_attachment=true;nd.raw_attachments=kd;}var od=id._shareLinkUploader.getAttachData();if(od){nd.has_attachment=true;nd.content_attachment=od;}if(gc.isNewEmptyLocalThread(id._threadID)){var pd=id._sheetController.getAddFriendsParticipants();if(pd===null||pd.length===0){return;}else if(pd.length===1){var qd='user:'+ua.getUserID(pd[0]);nd.thread_id=qd;}else gc.addParticipantsToThreadLocally(id._threadID,pd);}if(gc.isEmptyLocalThread(id._threadID)){var rd=dc.tokenizeThreadID(id._threadID);nd.message_id=rd.value;nd.specific_to_list=md.participants;}if(typeof nd!='undefined')nd.signatureID=id._signatureID;nd.ui_push_phase=ba.UIPushPhase;ld(nd);if(id._threadID!==nd.thread_id&&!id._photoUploader.isUploading()){ed.inform('closed-tab',id._threadID);q.openThread(nd.thread_id,'ChatTabView');}});}function xc(id){id._blocked=true;id._sheetController.openUploadWarningTabSheet();}function yc(id){return (id._fileUploader.isUploading()||id._photoUploader.isUploading());}function zc(id){return id._fileUploader.isUploading();}function ad(id){var jd=id._tabTemplate.getNode('input').value||'';if(!hc.test(jd))return true;if(id._fileUploader.getAttachments().length>0||id._fileUploader.getImageFiles().length>0||id._fileUploader.getVideoFiles().length>0)return true;if(id._shareLinkUploader.getAttachData())return true;return false;}function bd(id){if(id._blocked){if(zc(id))return;id._blocked=false;uc(id);id._sheetController.closeUploadWarningTabSheet();}}function cd(id){id._nubController.flyoutContentChanged();id._attachmentsDiv.scrollTop=id._attachmentsDiv.scrollHeight;}function dd(id,jd,kd){cb.sendSignal(wb({qn:id._waterfallID,step:jd,uploader:cb.APP_CHAT},kd||{}));}function ed(id,jd,kd){if(jd)dc.ensureThreadIsFetched(jd);this._threadID=id;this._signatureID=kd;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=tc(id);this._tabElem=this._tabTemplate.getRoot();this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=vb.generate();this._subscriptionsHandler=new mb();this._initializeAutoSendPhotoUploader();this._attachmentsDiv=this._getNode('attachmentShelf');this._shareLinkUploader=new v(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'),this.focus.bind(this));this._initializeUploader(this._shareLinkUploader);this._sheetController=new z(this._threadID,this._getNode('sheet'),this._tabElem);if(n.get('chat_react_option_menu')){this._initializeReactMenu(this._tabTemplate.getNode('attachmentShelf'));}else{this._fileUploader=new sa(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);}this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();ed.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){gc.updateThreadMuteSetting(this._threadID,0);this.focus();}.bind(this));this._nubController=new ab().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(xd,yd){gc.getThreadMeta(this._threadID,function(zd){this._updateControls(zd,yd.token_count);}.bind(this));}.bind(this));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));if(jc===null)jc=!n.get('seen_autosend_photo_nux');this._messagesView=null;var ld=this._getNode('titlebarText'),md=function(xd){ld.setAttribute('href',xd);ld.removeAttribute('rel');ea.removeClass(ld,'noLink');};if(n.get('chat_react_option_menu')){fc.getWebMessengerURL(id,function(xd){return md(xd);});}else{var nd=this._getNode('conversationLink');ea.hide(nd);fc.renderWebMessengerLink(id,nd,function(){ea.show(nd);md(nd.href);});}if(!gc.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var od=this._getCanonicalUserID();if(this._getCanonicalUserID()){ua.get(ua.getIDForUser(od),function(xd){if(xd.href)md(xd.href);});}else if(n.get('chat_react_option_menu')&&this._reactChatTabMenu.props.fullURL){md(this._reactChatTabMenu.props.fullURL);}else if(nd&&nd.href)md(nd.href);var pd=this._inputContainerNode.clientHeight;ob.getInstance(this._getNode('input')).subscribe('resize',function(){var xd=this._inputContainerNode.clientHeight;if(xd!=pd)this._nubController.flyoutContentChanged();pd=xd;}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('muteThreadLink','click',xa.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){gc.updateThreadMuteSetting(this._threadID,0);pb.hide();}.bind(this),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===oa.TAB){this._getNode('input').focus();event.kill();}}.bind(this));var qd=this._getNode('emoticons');this._emoticonView=null;if(qd){this._emoticonView=new za(qd,this._getNode('input'));this._stickersFlyoutToggler=qd;}this._stickersFlyoutPackID=null;if(n.get('chat_react_sticker_button')){this._selectionPosition=new hb(this._getNode('input'));this._stickerButton=fb.renderComponent(w({onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));if(qa.ShowLastSelectedPackTab)this._eventListeners.push(kb.addListener(kb.PACK_SELECTED,function(xd){if(this._stickerButton&&this._stickerButton.isMounted())this._stickerButton.setProps({packID:xd});}.bind(this)));}else{var rd=this._getNode('stickers');if(rd){this._stickersFlyout=fb.renderComponent(jb({onPackSelect:function(xd){this._packSelected(xd);}.bind(this),onStickerSelect:function(xd){this._stickerSelected(xd);}.bind(this)}),rd);var sd=this._getNode('stickersFlyout');if(sd&&qa.WebBigStickerTray)ea.addClass(sd,"_5la5");}if(qa.ShowLastSelectedPackTab)this._eventListeners.push(kb.addListener(kb.PACK_SELECTED,function(xd){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:xd});}.bind(this)));}var td=this._getNode('contentRoll');if(td)fb.renderComponent(ca({onSelection:function(xd){this._shareLinkUploader&&this._shareLinkUploader.loadShare(xd.url,{content_roll_entry:xd});this.focus();}.bind(this),userID:da.getID()}),td);if(tb.firefox()&&fa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new t(od,this._updatePrivacyLink.bind(this));this._eventListeners.push(la.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}gc.getThreadMeta(this._threadID,function(xd){dc.getServerThreadID(this._threadID,function(zd){this._lastMessageIndicator=new rb(od,this._getNode('input'),'mercury-chat',null,zd);}.bind(this));this._setUpMutingSettings(xd);if(qa.PicassoWebChatGK){var yd=this._tabTemplate.getNode('photoAttachmentMenu');new r(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),yd,this._threadID);}}.bind(this));var ud=this._getNode('muteGroupLink');if(ud){var vd=gc.getCanonicalGroupInThread(this._threadID);if(vd)ud.setAttribute('ajaxify',sb(ud.getAttribute('ajaxify')).addQueryData({id:vd}));}u.removeEmptyHrefs(this._tabElem);ic[id]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var wd={threadID:id,userID:od,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',wd).send();gb.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(cc.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);gb.onUnload(function(){fd(this);}.bind(this));}function fd(id){if(id._photoUploader.isUploading())dd(id,cb.CANCEL_DURING_UPLOAD);}function gd(){for(var id in ic){ic[id].updateAvailableStatus();ic[id].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],gd);db.subscribe(['privacy-changed','privacy-availability-changed'],gd);m.subscribe(m.ON_CHANGED,function(){for(var id in ic)gc.getThreadMeta(id,function(jd){ic[id]._updateUnreadCount(jd);});});ya.addRetroactiveListener('state-changed',function(id){for(var jd in id){var kd=id[jd]&&id[jd].length,ld=ic[jd];ld&&ld.showTypingIndicator(kd);}});ec.subscribe('threads-updated',function(id,jd){for(var kd in ic){var ld=ic[kd];jd[kd]&&ld.updateTab();if(ld._newThreadIDFromPhotoUpload&&!ld._photoUploader.isUploading()&&jd[ld._newThreadIDFromPhotoUpload]){ed.inform('closed-tab',ld._threadID);q.openThread(ld._newThreadIDFromPhotoUpload,'ChatTabView');ld._newThreadIDFromPhotoUpload=null;}}});ec.subscribe('threads-deleted',function(id,jd){for(var kd in ic)jd[kd]&&ed.inform('thread-deleted',kd);});wb(ed,h,{get:function(id){return ic[id];}});wb(ed.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(id){setTimeout((function(){this._sheetController.openNameConversationSheet(id);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return ea.shown(this._tabElem);},setVisibleState:function(id,jd){var kd=ea.shown(this._tabElem),ld=ea.hasClass(this._tabElem,'opened');ea.conditionShow(this._tabElem,id);ea.conditionClass(this._tabElem,'opened',jd);if(!(kd&&ld)&&id&&jd){if(!this._messagesView)this._messagesView=new y(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(kd&&ld&&!(id&&jd))this._contextualDialogController.tabNotActive();},focus:function(){var id=ea.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(id).focus();},isFocused:function(){var id=document.activeElement;return bb.byClass(id,"_50mz")===this._tabElem;},hasEmptyInput:function(){return hc.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(id){this._getNode('input').value=id;},setStickersFlyoutPackID:function(id){if(this._stickerButton){this._setPackIDReact(id);}else this._setPackIDLegacy(id);},_setPackIDLegacy:function(id){var jd=this._stickersFlyout,kd=this._stickersFlyoutToggler;if(!kd||!jd||!jd.isMounted())return;if(qa.ShowLastSelectedPackTab){kb.setTrayPackID(id);}else jd.setProps({packID:id});pb.show(kd);},_setPackIDReact:function(id){var jd=this._stickerButton;if(!jd.isMounted())return;if(qa.ShowLastSelectedPackTab){kb.setTrayPackID(id);jd.setProps({shown:true});}else jd.setProps({shown:true,packID:id});},insertBefore:function(id){ia.insertBefore(id._tabElem,this._tabElem);},appendTo:function(id){ia.appendContent(id,this._tabElem);},nextTabIs:function(id){var jd=id&&id._tabElem;return this._tabElem.nextSibling==jd;},getScrollTop:function(){return ia.find(this._tabElem,'.scrollable').scrollTop;},setScrollTop:function(id){ia.find(this._tabElem,'.scrollable').scrollTop=id;},destroy:function(){ia.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();if(n.get('chat_react_option_menu')){fb.unmountComponentAtNode(this._getNode('menuContainer'));}else this._fileUploader&&this._fileUploader.destroy();fb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete ic[this._threadID];ha.unregisterNubController(this._nubController);na.reset(this._getNode('input'));},updateAvailableStatus:function(){gc.getThreadMeta(this._threadID,function(id){var jd=l.OFFLINE,kd=this._getCanonicalUserID();if(kd){jd=eb.get(kd);}else{var ld=id.participants.map(function(nd){return ua.getUserID(nd);});jd=eb.getGroup(ld);}if(!aa.isOnline())jd=l.OFFLINE;if(kd)this._updateCallLink(jd);ea.conditionClass(this._tabElem,"_5238",jd===l.ACTIVE);ea.conditionClass(this._tabElem,"_5239",jd===l.MOBILE);var md=this._getNode('presenceIndicator');switch(jd){case l.ACTIVE:md.setAttribute('alt',"Online");break;case l.MOBILE:md.setAttribute('alt',"Mobile");break;default:md.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();gc.getThreadMeta(this._threadID,function(id){fc.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:wa.renderShortNames,check_length:true});this._updateControls(id);this._updateMutingSettings(id);this._updateUnreadCount(id);this.updateMultichatTooltip();this._updateArchiveWarning(id);this._updateNewThread(id);this._updateNameConversationSheet(id);this._updateReadOnlySheet(id);}.bind(this));},_setNameConversationLink:function(){var id=this._getNode('nameConversationLink');if(id)gc.isEmptyLocalThread(this._threadID)?ea.hide(id):ea.show(id);},_updateNameConversationSheet:function(id){if(gc.canReply(id.thread_id)&&!id.name&&!id.is_canonical&&!id.name_conversation_sheet_dismissed&&!id.has_email_participant&&!id.read_only&&!gc.isEmptyLocalThread(id.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(id){var jd=gc.canReply(id.thread_id),kd=gc.isEmptyLocalThread(id.thread_id);if(!jd&&!kd){this._sheetController.openReadOnlySheet();}else if(jd&&!kd&&qa.ReadOnlyEmailThreadsEarlyWarning&&id.has_email_participant)this._sheetController.openReadOnlyEarlyWarningSheet();},updateSignatureID:function(id){this._signatureID=id;},_showPhotoNUXIfNecessary:function(){if(jc){jc=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoAttachLink')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(id){var jd=xa.isThreadMuted(id);if(jd)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(jd);},_updateMutingSettings:function(id){var jd=xa.isThreadMuted(id),kd;if(n.get('chat_react_option_menu')){kd=this._reactChatTabMenu.props.isMuted;}else kd=ea.shown(this._getNode('unmuteThreadLink').parentNode);if(jd&&!kd){this._sheetController.openThreadIsMutedTabSheet();}else if(!jd&&kd)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(jd);},_updateActionMenu:function(id){if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({isMuted:id});}else{ea.conditionShow(this._getNode('muteThreadLink').parentNode,!id);ea.conditionShow(this._getNode('unmuteThreadLink').parentNode,id);}},_updateArchiveWarning:function(id){var jd=false;ua.get(ua.user,function(kd){jd=kd.employee;if(jd)ua.getMulti(id.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateControls:function(id,jd){var kd=gc.canReply(id.thread_id)&&(!zb(id.participants)||jd);ea.conditionShow(this._inputContainerNode,kd);ea.conditionShow(this._iconsContainerNode,kd);if(!n.get('chat_react_option_menu')){ea.conditionShow(this._getNode('dropdown'),kd);}else this._reactChatTabMenu.setProps({show:kd});ea.conditionShow(this._getNode('addToThreadLink'),kd);this._resizeInputContainer();},_resizeInputContainer:function(){var id=this._tabElem.clientWidth,jd=2,kd=id-(this._inputContainerNode.clientWidth+jd),ld=pa.isRTL()?'left':'right';lb.set(this._iconsContainerNode,ld,kd+'px');ob.getInstance(this._getNode('input')).update();},_updateNewThread:function(id){if(gc.isNewEmptyLocalThread(id.thread_id))this.showAddFriend();},_showArchiveWarningIfAllParticipantsAreEmployees:function(id){var jd=true;for(var kd in id)jd=jd&&id[kd].employee;var ld=this._getNode('titanArchiveWarning');if(ld){if(this._titlebarTooltipAnchor)ea.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',jd);ea.conditionShow(ld,jd);}},updateMultichatTooltip:function(){gc.getThreadMeta(this._threadID,function(id){if(!id.is_canonical)nc(this._titlebarTooltipAnchor,id.participants);}.bind(this));},_getNode:function(id){return this._tabTemplate.getNode(id);},_getCanonicalUserID:function(){return gc.getCanonicalUserInThread(this._threadID);},_listen:function(id,event,jd,kd){var ld=this._getNode(id);if(ld){this._eventListeners.push(la.listen(ld,event,jd.bind(this)));}else if(!kd)throw new Error('Could not find node "'+id+'"');},_closePreClicked:function(id){this._closeMouseDown=true;},_closeClicked:function(id){fd(this);ed.inform('closed-tab',this._threadID);id.kill();},_closeEnter:function(id){if(id.keyCode===oa.RETURN)this._closeClicked(id);},_nubClicked:function(id){if(!this._isDragDropActive){id.kill();return ed.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===oa.RETURN||event.keyCode===oa.SPACE){ed.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===oa.ESC){this._handleEscape();event.kill();}else if(event.keyCode===oa.TAB&&!event.ctrlKey){var id=ed.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!id&&event.kill();}},_handleEscape:function(){fd(this);if(this.hasEmptyInput()){ed.inform('esc-pressed',this._threadID);}else{var id="Are you sure you want to close this chat window?",jd="You haven't sent your message.",kd=new ga().setTitle(id).setBody(jd).setButtons([ga.CLOSE,ga.CANCEL]).setHandler(ed.inform.bind(ed,'esc-pressed',this._threadID,null)).setModal(true).show(),ld=kd.getButtonElement('yes');ld&&ma.set(ld);}},_titleClicked:function(event){var id=event.getTarget();if(!bb.byClass(id,'titlebarText')&&!bb.byClass(id,'uiSelector')&&!bb.byClass(id,'addToThread')&&!bb.byClass(id,'optionMenu')&&!this._isDragDropActive){ed.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(id){var jd=this._getCanonicalUserID();if(ub.availableForCall(jd)){var kd='chat_tab_icon';if(id.target&&ea.hasClass(id.target,'video_call_promo')){kd='chat_tab_icon_promo';}else if(id.target&&ea.hasClass(id.target,'video_call_tour'))kd='chat_tab_icon_tour';ed.inform('video-call-clicked',{threadID:this._threadID,userID:jd,clickSource:kd});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_clearHistory:function(){var id=gc.getThreadMetaNow(this._threadID);if(id){var jd=this._getCanonicalUserID();dc.clearChat(this._threadID,jd,id.timestamp);}},_unsubscribeLinkClicked:function(){var id=[];id.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});id.push(ga.CANCEL);new ga().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(id).show();},_reportSpamClicked:function(){var id=this._getCanonicalUserID(),jd=sb('/ajax/chat/report.php').addQueryData({id:id}).addQueryData({src:'top_report_link'});i.send(new j(jd));},_focusTab:function(){ea.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!kc&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){kc=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);ed.inform('focus-tab',this._threadID);},_blurTab:function(){ea.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(id){var jd=this._getNode('titlebarCloseButton'),kd=id?"Press Esc to close":"Close tab";qb.set(jd,kd,'above');},_inputKeyDown:function(event){if(ib.passesGK()){var id=Date.now();lc=id;var jd=this._tabTemplate.getNode('input');setTimeout(function(){if(id==lc){var kd=(jd.value||'');if(ib.isStickerKey(kd.trim())){jd.style.fontWeight='bold';}else jd.style.fontWeight='normal';}},50);}this.tryMarkAsRead();if(event.keyCode===oa.RETURN&&!event.shiftKey){if(zc(this)){xc(this);event.kill();return;}uc(this);event.kill();return;}if(event.keyCode===oa.DOWN&&event.shiftKey&&this._getNode('input').value===''){ed.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_hasUnfinishedPost:function(){return ad(this)||yc(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){ed.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(id){this.tryMarkAsRead();if(bb.byTag(id.getTarget(),'a')||ia.getSelection())return;this.focus();},_inputContainerClicked:function(id){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(id){ea.conditionClass(this._tabElem,'typing',id);},_updateUnreadCount:function(id){var jd=id.unread_count;if(typeof jd!='undefined'){var kd=!!jd&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),ld=this._getNode('numMessages');ea.conditionShow(ld,kd);ea.conditionClass(this._tabElem,'highlightTab',kd);rc(this._threadID,this._tabElem,kd);ia.setContent(ld,jd);}},_updateCallLink:function(id){var jd=this._getNode('videoCallLink');if(aa.isOnline()){var kd=this._getCanonicalUserID(),ld='fbid:'+kd;ua.get(ld,function(md){if(ub.availableForCall(kd)){qb.set(jd,bc._("Start a video call with {firstname}",{firstname:md.short_name}));}else{qb.set(jd,bc._("{firstname} is currently unavailable for video calling",{firstname:md.short_name}));this._hideVideoCallouts();}}.bind(this));}else{qb.set(jd,"You must be online to make a call.");this._hideVideoCallouts();}},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(id){var jd;if(id==t.OFFLINE){jd="Go online";if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:jd});}else ia.setContent(this._privacyLink,jd);return;}var kd=this._getCanonicalUserID();if(!kd)return;var ld='fbid:'+kd;ua.get(ld,function(md){if(id==t.BLOCKED){jd=bc._("Turn On Chat for {name}",{name:md.short_name});}else jd=bc._("Turn Off Chat for {name}",{name:md.short_name});if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:jd});}else ia.setContent(this._privacyLink,jd);}.bind(this));},_unsubscribeToThread:function(){if(!gc.isEmptyLocalThread(this._threadID)){var id=cc.constructLogMessageObject(va.CHAT_WEB,this._threadID,ta.UNSUBSCRIBE,{removed_participants:[ua.user]});cc.sendMessage(id);}ed.inform('unsubscribed',this._threadID);return true;},_initializeUploader:function(id){this._subscriptionsHandler.addSubscriptions(id.subscribe(['all-uploads-completed','upload-canceled'],function(){bd(this);}.bind(this)),id.subscribe('dom-updated',function(){cd(this);}.bind(this)),id.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeReactMenu:function(id){var jd=this._getNode('menuContainer'),kd=ra.isMultichat(this._threadID),ld=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(jd){this._reactChatTabMenu=fb.renderComponent(x({onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),clearHistoryFunc:this._clearHistory.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),isMultichat:kd,showAddFriend:ld,threadID:this._threadID,attachmentsShelf:id,onUploadFinished:bd.bind(this,this),onUpdateAttachmentsShelf:cd.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this)}),jd);this._fileUploader=this._reactChatTabMenu.fileUploader;}},_initializeReactFileUploader:function(id){this._fileUploader=fb.renderComponent(p({onFileUploaderMount:this.setFileUploader.bind(this),attachmentsShelf:id,onUploadFinished:bd.bind(this,this),onUpdateAttachmentsShelf:cd.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this)}),this._getNode('fileUploaderContainer'));},setFileUploader:function(id){this._fileUploader=id;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=fb.renderComponent(s({onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_handlePUSubmit:function(id,jd){dd(this,cb.UPLOAD_START,jd);wc(this,'',[],function(kd){if(this._threadID!==kd.thread_id){this._newThreadIDFromPhotoUpload=kd.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(kd.thread_id);}cc.updateNewMessage(kd,jd.upload_id,jd);cc.sendMessage(kd);}.bind(this));this._getNode('input').focus();},_handlePULastUploadFailed:function(id,jd){dd(this,cb.CLIENT_ERROR,jd);hd(jd);var kd="Photo Upload Failed",ld="Please try again. Make sure you are uploading a valid photo.";new ga().setTitle(kd).setBody(ld).setButtons(ga.OK).show();},_handlePULastUploadCanceled:function(id,jd){dd(this,cb.CANCEL_DURING_UPLOAD,jd);hd(jd);},_handlePUAllUploadsCompleted:function(id,jd){dd(this,cb.ALL_UPLOADS_DONE,jd);var kd=cc.updateMessageAfterUpload(jd.upload_id,jd);cc.clearUploadedMessage(jd.upload_id);cc.sendMessage(kd);var ld=jd.image_ids.length||jd.attachments.length;vc(this,ld);},_packSelected:function(id){if(qa.ShowLastSelectedPackTab){kb.setTrayPackID(id);}else if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:id});},_stickerSelected:function(id){wc(this,'',[],function(jd){jd.has_attachment=true;jd.sticker_id=id;cc.sendMessage(jd);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(id){var jd=ja.symbols[id];if(!jd)return;var kd=ob.getInstance(this._getNode('input')),ld=kd.getValue(),md=ka.insertEmoticon(jd,ld,this._selectionPosition.getPos());kd.setValue(md.result);this._selectionPosition.setPos(md.start,md.end);}});function hd(id){var jd=cc.updateMessageAfterUpload(id.upload_id,id);cc.clearUploadedMessage(id.upload_id);cc.deleteMessages(jd.thread_id,[jd.message_id]);cc.deleteLocalMessage(jd.thread_id);}e.exports=ed;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","tx","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryMessages').get(),k=b('MercuryThreads').get();function l(m,n){g.isThreadID(m);k.getThreadMeta(m,function(o){j.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=h.user){h.get(q.author,function(r){if(o.name){n(i._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(i._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)k.doSync();}}var t={blink:function(x,y){if(!o&&p<y)j.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=k.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}k.registerStateStorer(w);k.registerStateLoader(v);l.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=k.getInitial();if(x)p=u(x)||0;})();e.exports=t;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryParticipants","MercuryThreadMuter","MessagingTag","Sound","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreads').get();o.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))o.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(t.author==l.user||!t.is_unread||(t.folder!=n.INBOX&&t.folder!=n.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}q.getThreadMeta(u,function(x){var y=m.isThreadMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=p(s,g);});
__d("ChatNewMessageHandler",["ArbiterMixin","ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.create('chat_new_message'),q={_raiseNewMessageTab:function(r,s){var t=i.getTab(r),u=false;if(t){u=t.raised;}else u=true;q.inform('chat/new-message-from-server',{thread_id:r});s.to_new_tab=!t;s.to_raised_tab=!!u;},_notify:function(r,s,t){var u=j.get(r);t.view_is_visible=u&&u.isVisible();t.view_is_focused=u&&u.isFocused();if(!t.view_is_visible)p.log('message_to_hidden');t.is_active=h.isActive();m.messageReceived(s);},newMessage:function(r,s,t){l.isThreadID(r);var u={thread_id:r,message_id:s.message_id};this._raiseNewMessageTab(r,u);this._notify(r,s,u);p.log('message',u);}};o(q,g);m.subscribe('before-alert',function(r,event){var s=event.threadID,t=j.get(s),u=i.getTab(s);if(u&&u.raised&&t&&t.isVisible()&&t.isFocused()&&n.isActive()){t.tryMarkAsRead();event.cancelAlert();}});e.exports=q;});
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;});
__d("MercuryUnseenState",["TimestampConverter","KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=l.MAX_UNSEEN_COUNT,v='unseen_thread_hash',w='unseen_thread_list',x=i.getInstance('mercury_unseen_state');function y(la){this._fbid=la;this._serverRequests=o.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=0;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(ma,na){da(this,na);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ma,na){ja(this,na);}.bind(this));}s(y.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){x.error('unguarded_unseen_count_fetch',{});return 0;}return ca(this);},exceedsMaxCount:function(){return this._maxCount||(ca(this)>u);},markAsSeen:function(){if(ca(this)>0||this._maxCount){this._serverRequests.markSeen();ea(this,g.convertActionIDToTimestamp(this._serverRequests.getLastActionID()),[]);}},markThreadSeen:function(la,ma){var na={};na[la]=null;ga(this,na,ma);}});s(y,k);function z(la,ma){la._unseenResources.setResource(v,ma);la._unseenResources.setResource(w,Object.keys(ma));}function aa(la,ma){var na=la._unseenResources.executeOrEnqueue(v,ma),oa=la._unseenResources.getUnavailableResources(na);if(oa.length)la._serverRequests.fetchUnseenThreadIDs();}function ba(la){return la._unseenResources.getResource(v);}function ca(la){var ma=la._unseenResources.getResource(w);if(ma){return ma.length;}else return la._initialUnseenCount;}function da(la,ma){var na=ka(ma);if(ma.unseen_thread_ids){ma.unseen_thread_ids.forEach(function(ya){if(ya.folder!=m.INBOX)return;var za=ia(la,ya.thread_ids),ab=la._lastSeenTimestamp;if(na&&na.seen_timestamp)ab=na.seen_timestamp;ea(la,ab,za);if(na&&na.unseen_count>u)la._maxCount=true;});}else if(na&&na.seen_timestamp){la._lastSeenTimestamp=na.seen_timestamp;if(na.unseen_count>u){la._maxCount=true;z(la,{});}else{la._initialUnseenCount=na.unseen_count;if(la._initialUnseenCount===0)z(la,{});}}else{if(la._maxCount)return;var oa=ma.actions;if(!oa||!(oa.length))return;var pa={},qa={};for(var ra=0;ra<oa.length;ra++){var sa=oa[ra];if(sa.is_forward)continue;var ta=sa.action_type,ua=sa.action_id,va=sa.thread_id?sa.thread_id:sa.server_thread_id,wa=sa.folder===undefined||sa.folder==m.INBOX;if(!wa)continue;if(ta==j.USER_GENERATED_MESSAGE||ta==j.LOG_MESSAGE){var xa=g.isGreaterThan(ua,pa[va]);if(sa.is_unread&&(!pa[va]||xa))la._threads.getThreadMeta(va,function(ya){var za=false;if(ya&&ya.last_read_timestamp)if(ya.last_read_timestamp>=sa.timestamp)za=true;if(!q.isThreadMuted(ya)&&!za)pa[va]=ua;});}else if(ta==j.CHANGE_READ_STATUS&&sa.mark_as_read)qa[va]=ua;}fa(la,pa);ga(la,qa);}}function ea(la,ma,na){var oa=ba(la);if(oa===undefined||ma>la._lastSeenTimestamp||la._maxCount){la._lastSeenTimestamp=ma;na=na||[];if(na.length<=u)la._maxCount=false;var pa={},qa=ba(la)||{};for(var ra in qa)if(qa[ra]!==true){var sa=qa[ra];if(ha(la,sa))pa[ra]=sa;}var ta=s(t(na,true),pa);z(la,ta);la._threadInformer.updatedUnseenState();}}function fa(la,ma){if(la._maxCount)return;var na={},oa=false;for(var pa in ma){var qa=ma[pa];if(ha(la,qa)){na[pa]=qa;oa=true;}}if(!oa)return;aa(la,function(ra){for(var sa in na){var ta=na[sa];if(!ra[sa]&&ha(la,ta))ra[sa]=na[sa];}z(la,ra);la._threadInformer.updatedUnseenState();});}function ga(la,ma,na){var oa=false;for(var pa in ma){oa=true;break;}if(oa)aa(la,function(qa){var ra=false;for(var sa in ma){var ta=ma[sa],ua=g.isGreaterThan(ta,qa[sa]);if(qa[sa]&&(!ta||ua)){delete qa[sa];ra=true;}}if(ra){z(la,qa);la._threadInformer.updatedUnseenState();if(na&&ca(la)===0)la._serverRequests.markSeen();}});}function ha(la,ma){var na=g.convertActionIDToTimestamp(ma);return na>la._lastSeenTimestamp;}function ia(la,ma){return ma.map(la._serverRequests.convertThreadIDIfAvailable.bind(la._serverRequests));}function ja(la,ma){var na=ba(la);if(!na)return;for(var oa in ma){var pa=ma[oa];if(na[oa]){na[pa]=na[oa];delete na[oa];}}z(la,na);}function ka(la){var ma=(la.message_counts||[]);for(var na=0;na<ma.length;na++)if(ma[na].folder==m.INBOX)return ma[na];return null;}n.registerCallback('mercury-unseen-state',function(){var la={};la.unseen={};la.unseen_max_count={};la.unseen_time={};var ma=y._getInstances();for(var na in ma){la.unseen[na]=s({},ba(ma[na]));la.unseen_max_count[na]=ma[na]._maxCount;la.unseen_time[na]=ma[na]._lastSeenTimestamp;}return la;});e.exports=y;});
__d("ChatTabPolicy",["ChatBehavior","JSLogger","MercuryActionTypeConstants","MercuryLogMessageType","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MessagingTag","PresencePrivacy","ShortProfiles","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryUnseenState').get(),u=h.create('tab_policy');function v(w,x){t.markThreadSeen(w,x);}e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(p.isThreadMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};u.log('message_thread_muted',ba);return;}if(w.mode==o.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};u.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};u.log('message_source_not_allowed',ba);return;}var ca=l.getUserID(x.author);if(!ca){u.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=i.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(x,w)){ba={thread_id:z,message_id:aa,type:x.action_type};u.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){u.log('message_jabber',{thread_id:z,message_id:aa});v(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){u.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(w.folder!=q.INBOX){u.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserID(l.user);s.getMulti([ca,da],function(ea){if(!r.allows(ca)){u.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&ea[ca].type!==m.FRIEND){u.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});},_messageIsNewlyCreatedGroup:function(w,x){return w.action_type===i.LOG_MESSAGE&&w.log_message_type===j.THREAD_NAME&&x.message_count===1;}};});
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreadInformer').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadMetadataRenderer').get();function t(u){var v=n[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new m().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=r.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=n[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');s.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);o.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));o.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});o.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});q.subscribe('threads-updated',ba);}p(t,new h());e.exports=t;});
__d("ChatTabController",["Arbiter","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabLRUManager","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryParticipants","Style","UserAgent","VideoCallCore","ChatTabPresence","ChatTypeaheadBehavior","MercuryThreadInformer","MercuryThreads","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b('ChatTabPresence');b('ChatTypeaheadBehavior');var v=b('MercuryThreadInformer').get(),w=b('MercuryThreads').get(),x=b('MercuryUnseenState').get(),y=i.get('tab_auto_close_timeout')||7200000,z=q.create('tab_controller');function aa(oa){w.changeThreadReadStatus(oa,true);ba(oa);}function ba(oa){x.markThreadSeen(oa);}function ca(oa,pa,qa){var ra=m.get().tabs;oa+=pa?1:-1;while(oa>=0&&oa<ra.length){var sa=ra[oa],ta=o.get(sa.id);if(ta&&ta.isVisible()&&(!qa||sa.raised)){ta.focus();return true;}oa+=pa?1:-1;}return false;}function da(oa,pa){var qa=pa&&pa.getRightmostHiddenTab();if(qa===oa)return null;return qa;}function ea(){return Math.floor(Math.random()*2147483648).toString(16);}function fa(oa,pa,qa,ra){m.raiseTab(oa,true,qa);var sa=pa&&pa.getLeftmostVisibleTab(),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa){m.promoteThreadInPlaceOfThread(oa,sa,da(oa,pa),true);}else m.setPromotedTab(oa);g.inform('chat/open-tab',oa);var ua=o.get(oa);ua&&ua.focus();}function ga(oa,pa,qa){var ra=qa.forceDrop();if(!m.getTab(oa))m.raiseTab(oa,false);if(ra)return;var sa=pa&&k.getLRUVisibleTab(pa),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa)m.promoteThreadInPlaceOfThread(oa,sa,da(oa,pa));}function ha(oa,pa){var qa=m.indexOf(oa);m.closeTab(oa,pa);return qa;}function ia(oa,pa){j.subscribe('chat/new-message-from-server',function(ra,sa){ga(sa.thread_id,oa,pa);});p.subscribe('selected',function(ra,sa){fa(sa,oa);});g.subscribe('chat/tabs-order-changed',function(ra,sa){m.changeShowingTabs(sa);});g.subscribe('page_transition',function(ra,sa){m.closeFragileTabs();});g.subscribe('chat/close-all-tabs',function(){m.closeAllTabs();});if(i.get('chat_close_all_tabs_when_offline'))g.subscribe('chat-visibility/go-offline',function(){m.closeAllTabs();});o.subscribe('read',function(event,ra){aa(ra);});h.subscribe('idle',function(ra,sa){if(sa>y){var ta=m.get().tabs;ta.forEach(function(ua){var va=ua.id;w.getThreadMeta(va,function(wa){if(!wa.unread_count){z.log('autoclose_idle_seen',{thread_id:va,idleness:sa});m.closeTab(va,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(ra,sa){fa(sa,oa);});o.subscribe('lower-activated',function(ra,sa){m.lowerTab(sa);var ta=o.get(sa);ta&&ta.focus();});o.subscribe('focus-tab',function(ra,sa){var ta=m.getTab(sa);if(ta&&ta.raised)fa(sa,oa,ta.signatureID,true);});function qa(ra,sa){u.showOutgoingCallDialog(sa.userID,sa.clickSource);m.lowerTab(sa.threadID);}o.subscribe('video-call-clicked',qa);l.subscribe('video-call-clicked',qa);l.subscribe('interaction-with-tab',function(ra,sa){var ta=m.getTab(sa);ta&&ta.raised&&ba(sa);});o.subscribe('closed-tab',function(ra,sa){z.log('close_view',{thread_id:sa});ha(sa,'close_view');return false;});o.subscribe('thread-deleted',function(ra,sa){z.log('close_thread_deleted',{thread_id:sa});ha(sa,'close_thread_deleted');return false;});o.subscribe('unsubscribed',function(ra,sa){z.log('close_view_unsubscribed',{thread_id:sa});ha(sa,'close_view_unsubscribed');return false;});o.subscribe('esc-pressed',function(ra,sa){z.log('close_esc',{thread_id:sa});var ta=ha(sa,'close_esc');setTimeout(function(){ca(ta-1,true,true)||ca(ta,false,true);},0);});p.subscribe('selector/close-tab',function(ra,sa){z.log('close_chat_from_selector',{thread_id:sa});ha(sa,'close_chat_from_selector');});v.subscribe('messages-received',function(ra,sa){for(var ta in sa){var ua=sa[ta];for(var va=0;va<ua.length;va++){var wa=ua[va];if(wa.author!=r.user){if(!wa.is_unread){z.log('message_already_read',{action_id:wa.action_id,thread_id:wa.thread_id});continue;}w.getThreadMeta(ta,function(xa){n.messageIsAllowed(xa,wa,function(){j.newMessage(ta,wa,oa);});});}}}});v.subscribe('thread-read-changed',function(ra,sa){for(var ta in sa)if(!sa[ta].mark_as_read){z.log('autoclose_marked_unread',{thread_id:ta});m.closeTab(ta,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(ra,sa){return !ca(m.indexOf(sa.id),sa.shiftPressed);});g.subscribe(q.DUMP_EVENT,function(ra,sa){sa.chat_controller={auto_close_timeout:y};});this.openTab=function(ra,sa){fa(ra,sa,ea());};}if(t.firefox()){var ja=function(){return s.get(document.body,'overflowX')+' '+s.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}e.exports=ia;});
__d("ChatTabViewCoordinator",["Arbiter","BanzaiODS","Bootloader","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallCore","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=n.create('chat_tab_coordinator'),t,u;function v(w,x){var y=new l(w),z={},aa={},ba=false;function ca(){var oa=j.get(),pa={};oa.tabs.forEach(function(ra){pa[ra.id]=1;});s.log('process_tab_changed',{model_tabs:Object.keys(pa),view_tabs:Object.keys(z)});for(var qa in z)if(!pa[qa]){s.log('remove_tab',{tab_id:qa});z[qa].destroy();delete(z[qa]);}da(oa);ma(oa);if(oa.tabNeedsFocus&&!oa.tabNeedsFocus.isFocused())oa.tabNeedsFocus.focus();}function da(oa){var pa=null;oa.tabs.forEach(function(qa){var ra=qa.id,sa=false;if(!z[ra]){s.log('add_tab',{tab_id:ra});z[ra]=new k(ra,qa.server_id,qa.signatureID);sa=true;}else z[ra].updateSignatureID(qa.signatureID);if(z[ra].isFocused())oa.tabNeedsFocus=z[ra];if(sa||!z[ra].nextTabIs(pa)){var ta=z[ra].getScrollTop();if(pa){z[ra].insertBefore(pa);}else z[ra].appendTo(w);if(ta)z[ra].setScrollTop(ta);}pa=z[ra];});}function ea(){var oa=x.getShowingTabsOrder();if(!oa||!oa.length)return;var pa=z[oa[0].id]._tabElem,qa=z[oa[oa.length-1].id]._tabElem,ra=parseInt(o.get(qa,'margin-left'),10)||0,sa=p.getElementBounds(qa).l-2*ra;sa=sa>0?sa:0;t&&t.setBoundingBox(new p(0,p.getElementBounds(pa).r,0,sa));}function fa(oa,pa){var qa=false;pa.forEach(function(ta){if(ta.raised){if(aa[ta.id]){qa=true;delete aa[ta.id];}}else if(!aa[ta.id]){qa=true;aa[ta.id]=true;}});if(qa)return true;if(!t)return true;var ra=ga()||[];if(ra.length!==oa.length)return true;for(var sa=0;sa<oa.length;sa++)if(ra[sa]!==oa[sa].id)return true;return false;}function ga(){var oa=t&&t.getOrder();oa&&oa.reverse();return oa;}function ha(){var oa=ga();if(oa){h.bumpEntityKey('chat.web','tab.drag_order_changed');g.inform('chat/tabs-order-changed',oa);}}function ia(oa,pa,qa){if(z[qa]._scrollTop!=null)z[qa].setScrollTop(z[qa]._scrollTop);}function ja(oa,pa){u=pa;z[pa]._isDragDropActive=true;z[pa]._scrollTop=z[pa].getScrollTop();o.set(z[pa]._tabElem,'z-index',1);ea();h.bumpEntityKey('chat.web','tab.drag_started');}function ka(oa){o.set(z[oa]._tabElem,'z-index','');if(z[oa]._scrollTop!=null)z[oa].setScrollTop(z[oa]._scrollTop);z[oa]._scrollTop=null;u=null;setTimeout(function(){z[oa]._isDragDropActive=false;},0);}function la(oa){i.loadModules(["SortableGroup"],function(pa){var qa=x.getShowingTabsOrder(),ra=fa(qa,oa);if(qa.length<=1){t&&t.removeAllSortables();return;}if(ra){if(t){t.removeAllSortables();}else t=new pa().setBeforeGrabCallback(ja).setDragOverCallback(ia).setDropCallback(ka).setOrderChangeHandler(ha).setUseScroller(false).setDragOverHorizontally();for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];t.addSortable(ta.id,z[ta.id]._tabElem,aa[ta.id]?null:z[ta.id]._titlebar);}}});}function ma(oa){var pa=x.getTabsToShow(oa),qa=[],ra=false;oa.tabs.forEach(function(sa){if(!pa[sa.id]){z[sa.id].setVisibleState(false,sa.raised);qa.push(sa);}});oa.tabs.forEach(function(sa){if(pa[sa.id]){z[sa.id].setVisibleState(true,sa.raised);ra|=sa.raised;}});y.setTabData(qa);na(ra);la(oa.tabs);}function na(oa){if(!oa&&ba){g.inform('layer_hidden',{type:'ChatTab'});ba=false;}else if(oa&&!ba){g.inform('layer_shown',{type:'ChatTab'});ba=true;}}if(q.isSupported())m.addClass(w,'videoCallEnabled');x.subscribe('tabs-changed',ca);ca();}r(v.prototype,{forceDrop:function(){if(t&&u){t.forceDrop(u);u=null;return true;}return false;}});e.exports=v;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryGlobalActionType","MercuryPayloadSource","MercurySendLogger","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","copyProperties","MercuryMessages","MercuryServerRequests","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryMessages').get(),t=b('MercuryServerRequests').get(),u=b('MercuryThreadInformer').get();function v(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.message){m.addEntry('channel_receive','invalid_data');return;}var ma=la.obj.message,na={author:ma.mercury_author_id,author_email:ma.mercury_author_email,body:ma.body,subject:ma.subject,has_attachment:ma.has_attachment,attachments:ma.attachments,html_body:ma.html_body,thread_id:ma.tid,message_id:ma.mid,coordinates:ma.mercury_coordinates,is_spoof_warning:ma.is_spoof_warning,source:ma.mercury_source,source_tags:ma.mercury_source_tags,threading_id:ma.threading_id,timestamp:ma.timestamp,timestamp_absolute:ma.timestamp_absolute,timestamp_relative:ma.timestamp_relative,timestamp_time_passed:ma.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ma.is_unread,action_id:ma.action_id,is_forward:false,forward_count:ma.forward_count||ma.forward,forward_message_ids:ma.forward_msg_ids,location_text:ma.location_text,folder:la.obj.folder},oa=[r({},na)];oa=oa.concat(ma.forward_actions||[]);var pa=k.CLIENT_CHANNEL_MESSAGE;t.handleUpdateWaitForThread({actions:oa,payload_source:pa},ma.tid);if(!ma.is_unread&&ma.mercury_author_id===p.user){var qa={};qa[ma.tid]=la.obj.folder;w(h.getArbiterType('messaging'),{obj:{event:n.READ,tids:[ma.tid],folder_info:qa,timestamp:ma.timestamp}});}if(ma.mercury_author_id===p.user)if(s.getMessagesFromIDs([ma.threading_id]).length)l.log(l.CLIENT_CHANNEL_ECHO,ma.threading_id,{canonical:!ma.group_thread_info});m.addEntry('channel_receive','success',[na.thread_id,na.message_id,q.getSessionID()]);}function w(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids)return;var ma=[],na=la.obj.event==n.READ;la.obj.tids.forEach(function(oa){ma.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:oa,mark_as_read:na,timestamp:la.obj.timestamp||0,folder:la.obj.folder_info[oa]});});t.handleUpdate({actions:ma,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function x(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids)return;var ma=[];la.obj.tids.forEach(function(na){ma.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:na});});t.handleUpdate({actions:ma,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function y(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids||!la.obj.mids)return;var ma=la.obj.tids[0],na={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:ma,message_ids:la.obj.mids};t.handleUpdate({actions:[na],threads:[la.obj.updated_thread],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function z(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.folder)return;var ma={action_type:j.MARK_ALL_READ,action_id:la.obj.action_id,folder:la.obj.folder};t.handleUpdate({global_actions:[ma]});}function aa(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tids)return;var ma=k.CLIENT_CHANNEL_MESSAGE;la.obj.tids.forEach(function(na){var oa={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:na,archived:la.obj.state};t.handleUpdateWaitForThread({actions:[r({},oa)],payload_source:ma},na);});}function ba(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tids)return;var ma=k.CLIENT_CHANNEL_MESSAGE,na;la.obj.tids.forEach(function(oa){if(la.obj.event==n.TAG){na=la.obj.tag;}else na=la.obj.marked_as_spam?o.SPAM:o.INBOX;var pa={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:oa,new_folder:na};t.handleUpdateWaitForThread({actions:[r({},pa)],payload_source:ma},oa);});}function ca(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tag)return;switch(la.obj.tag){case o.ACTION_ARCHIVED:aa(ka,la);break;case o.INBOX:case o.OTHER:ba(ka,la);break;}}function da(ka,la){if(ka!=h.getArbiterType('inbox')||!la.obj||!la.obj.seen_timestamp)return;t.handleUpdate({message_counts:[{seen_timestamp:la.obj.seen_timestamp,folder:o.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:o.INBOX}],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function ea(ka,la){if(ka!=h.getArbiterType('mercury')||!la.obj)return;u.synchronizeInforms(function(){var ma=la.obj,na=[];(ma.actions||[]).forEach(function(oa){var pa=i.USER_GENERATED_MESSAGE;if(oa.action_type==i.LOG_MESSAGE){var qa=k.CLIENT_CHANNEL_MESSAGE;t.handleUpdateWaitForThread({actions:[r({},oa)],payload_source:qa},oa.thread_id);}else if(oa.action_type!=pa)na.push(oa);});ma.actions=na;ma.payload_source=k.CLIENT_CHANNEL_MESSAGE;t.handleUpdate(ma);});}function fa(ka,la){t.handleRoger(la.obj);}function ga(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||la.obj.mute_settings===undefined||!la.obj.thread_id)return;var ma=i.CHANGE_MUTE_SETTINGS,na=[{action_type:ma,action_id:null,thread_id:la.obj.thread_id,mute_settings:la.obj.mute_settings}];t.handleUpdate({actions:na,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function ha(ka,la){switch(la.obj.event){case n.DELIVER:v(ka,la);break;case n.READ:case n.UNREAD:w(ka,la);break;case n.READ_ALL:z(ka,la);break;case n.DELETE:x(ka,la);break;case n.DELETE_MESSAGES:y(ka,la);break;case n.TAG:ca(ka,la);break;case n.REPORT_SPAM:ba(ka,la);break;case n.READ_RECEIPT:fa(ka,la);break;case n.CHANGE_MUTE_SETTINGS:ga(ka,la);break;}}var ia=[],ja={turnOn:function(){if(!ia.length){var ka={mercury:ea,messaging:ha,inbox:da};for(var la in ka)ia.push(g.subscribe(h.getArbiterType(la),ka[la]));}},turnOff:function(){if(ia.length){ia.forEach(g.unsubscribe);ia=[];}}};ja.turnOn();e.exports=ja;});
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryFolders","MessagingTag","URI","copyProperties","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=l(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(k.getRequestURI().getPath().search(/messages/)!==-1){p=i.getSupportedFolders();}else p=[j.INBOX];m.fetchMissedMessages(p);}n.initialize();e.exports=n;});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f,g,h){var i={init:function(j,k,l){if(this._isInitialized){h.create('chat_app').error('repeated_init');return;}this._rootElem=j;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(m,n,o,p,q,r){p.get().handleUpdate(l);this.tabsViewport=new m(k);this.tabViewCoordinator=new o(k,this.tabsViewport);this.tabController=new n(this.tabsViewport,this.tabViewCoordinator);this._isInitialized=this._isLoaded=true;}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(j){j.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};e.exports=i;});
__d("ChatOpenTab",["Event","ChatApp","ContextualThing","cx","Parent"],function(a,b,c,d,e,f,g,h,i,j,k){var l=716,m='messaging_tracking';function n(s){d(['LogHistory','MercuryThreads','WebMessengerPermalinkConstants','goURI'],function(t,u,v,w){u.get().getThreadMeta(s,function(x){if(h.isInitialized()){h.tabController.openTab(s,h.tabsViewport);}else w(v.getURIPathForThreadID(s));if(!r.canOpenTab())t.getInstance('mercury').error('Unable to open chat tab',x);});});if(document.documentElement.clientHeight<=l)d(['Toggler'],function(t){if(t.getActive()&&t.getActive().id==='fbMessagesJewel')t.hide();});}function o(s,t,u,v){g.listen(s,'click',function(w){if(r.canOpenTab()){v(t,u);return w.kill();}});}function p(s,t,u,v){var w={referrer:s||'',message_thread_id:t,message_view:'chat',timestamp_send:Date.now()};if(u!==undefined)w.message_target_ids=[u];d(['ChatImpressionLogger'],function(x){x.logImpression(s,u,v);});d(['Banzai'],function(x){x.post(m,w,{delay:0,retry:true});});}function q(s){var t=i.getContext(s);return (t&&k.byClass(t,"_3qw")!==null);}var r={canOpenTab:function(){return !h.isHidden();},openEmptyTab:function(s,t,u){if(r.canOpenTab())d(['ChatTabModel'],function(v){var w=v.getEmptyTab();n(w);p(t,w,null,u);});},listenOpenEmptyTab:function(s,t){o(s,null,t,r.openEmptyTab);},openThread:function(s,t,u){d(['MercuryIDs','MercuryServerRequests'],function(v,w){if(v.isValid(s)){n(s);}else w.get().getClientThreadID(s,n);p(t,s,null,u);});},listenOpenThread:function(s,t,u){o(s,t,u,r.openThread);},openUserTab:function(s,t,u){d(['MercuryThreads'],function(v){var w=v.get().getCanonicalThreadToUser(s);n(w.thread_id);p(t,w.thread_id,s,u);});return true;},listenOpenUserTab:function(s,t,u){if(!q(s))o(s,t,u,r.openUserTab);},openTabByType:function(s,t,u){d(['ChatTypeaheadConstants','MercuryParticipantTypes'],function(v,w){if(t===v.THREAD_TYPE){if(s){r.openThread(s,u);}else r.openEmptyTab(null,u);}else if(!t||t===w.FRIEND||t===v.FRIEND_TYPE||t===v.USER_TYPE)r.openUserTab(s,u);});}};e.exports=r;});
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;});